 
causality plays an important role in qualitative reasoning about physical systems. in this paper we show that the bond-graph method can be fruitfully applied to represent and generate causal order on a formal basis. both physical and computational aspects of bond-graph causality are discussed. in particular we show that it provides a  inner physical foundation for a causal order along the lines of iwasaki and simon. bond-graph causality also generates more information than does the causal ordering theory  including better causal resolution  an improved definition of exogeneity in terms of parameters and sources  automatic checking of self containment  and a more detailed  physical treatment of feedback. 
1 	introduction 
 in previous work we have discussed how the bond graph approach provides a solid basis for the formalisation of expert reasoning about physical systems i top and akkermans  1a; top and akkermans  1b; top et a/.  1 . it is based on the identification of a small set of physical mechanisms grounded in the energetic aspects of physical systems behaviour: storage processes  storage of energy  capacitor c and inertia i ; dissipative processes  resistor r ; sources and sinks  se and sf ; and distribution processes  1- and 1 -junction  transformer tf and gyrator gy . these mechanisms are represented as nodes in a labelled digraph  linked through energy flows. thus  the representation embodies energy conservation as a first principle of physics. each energy flow is decomposed into an effort and a flow variable. each physics domain has its own instantiation of effort and flow variables  for example  force and velocity in mechanics   but the generic notion of effort and flow makes it possible to reason across multiple domains  including mechanics  electrical engineering  hydrodynamics  acoustics and thermodynamics. thus  bond graphs cover es sentially all classical macrophysical domains in an integrated fashion. they are based upon a 'mechanism' ontology. since the identification of physical mechanisms  which actually arc elementary processes  is done on a local basis  this ontology combines attractive features of both the device and process ontologies ftop and akkermans  1bl. it is incorrect to say  e.g. in  weld  1  that system dynamics  from which the bond-graph method originates  corresponds to the device ontology. the topology of the bond graph can be employed to obtain important qualitative physical information  top and akkermans  1ai. thus  bond graphs provide a formal and generic language for modelling and representing physical systems. 
   in this paper we will deal with the topic of causality. according to studies of human reasoning about technical devices iforbus and gentner  1  causal explanations are based on elementary mechanisms that relate individual variables in a directed way. we propose that bond graphs formalise these intuitive ideas in a physically appropriate way  and can be fruitfully employed to obtain causal information based on expert knowledge about physical systems theory. in particular we show that bond-graph causality yields a causal ordering method for physical systems that is similar to but more powerful than the theory of iwasaki and simon i iwasaki and simon  1ai. 
1 	bond graph causality 
we will now describe causality from the physical point of view  in terms of bond-graph theory. for an extensive introduction to bond graphs wc refer to ikarnopp and rosenberg  1. 
1 	causality in physical systems 
physical models arc usually described at a mathematical level  where variables are interrelated through mathematical relations  even if these relations arc sometimes called confluences ide kleer and brown  1 or influences and qualitative proportionalities iforbus  1 . in contrast  bond graphs are based on physical primitives: generic physical mechanisms  linked through energy flows. causality in bond graphs is rooted in physical intuitions in two ways. first  it is physically impossible to impose or control both effort and flow simultaneously for a single energy link ibreedvcld  1. this means that each energy bond defines a bilateral signal flow. in other words  every path of energy exchange is associated with information flow in both directions along that path. second  causal directions are constrained by the mechanisms that link individual quantities. this is based on the following physical arguments: 
sources. sources have fixed causality since they externally impose effort  se  or flow  sf . for example  the room 
	top and akkermans 	1 
atmosphere determines the temperature at the boundary of an experiment  and this temperature is not influenced by the experiment itself. so  the causal direction of bonds connected to sources is determined a priori. 
storage processes. storage processes have preferred causality. this means that these processes have a priori causal directions at the bonds connected to them  unless the system requires otherwise. a capacitive process prefers to produce effort and an inertial process generates flow  if allowed to. mathematically speaking  a storage  capacitive or inertial  process defines a relation between one variable and the derivative of another. although this relation is in itself undirected  in simulations preference is given to causality corresponding to integration rather than differentiation for reasons of numerical stability. this has in itself no meaning for intuitive causality. in  weld and de k leer  1 williams concludes from causal explanations given by engineers that 'causality always flows along the direction of integration'. why this is physically adequate follows from a closer inspection of the intuitive understanding of dynamic processes themselves  as we will argue here. 
   the first argument for integral causality is based on the role that a storage process plays. the 'amounts of stuff stored by the individual storage processes characterise the present state of a system. these amounts  the state quantities  result from accumulation of flow  or effort . as a result from this accumulation effort  flow  develops. for example  accumulation of liquid due to liquid flow into a container causes the pressure in the container to rise: the slate quantity  amount of fluid  is conceived as the cause of the resulting effort  pressure . the reverse statement 'the pressure determines the amount of fluid' is unphysical. hence  the latter form  corresponding to derivative causality  is avoided if possible; its presence in a model indicates that some dynamic process is  deliberately  being neglected. 
   the second argument in support of integral causality is based on the fact that causality is conceived as a temporal order of assignment of values. mathematically  a storage process is represented by  quantity q is a 
   result of the amount of / that was accumulated over the past period. this is also reflected in the elementary discrete representation of integration: 
on the other hand the action of differentiation is intuitively in conflict with causality  since it needs a future value of q: 
 several mathematical methods 
have been developed to facilitate numerical differentiation  but these have no physical interpretation. 
resistive processes. causality at resistive processes is in principle context dependent  i.e.  determined by other causal assignments within the model. however  if causality at any such process is not determined by sources or storage processes it remains indeterminate. in that case causality can be assigned indifferently in either of two directions. we will return to this when discussing feedback. 
distribution processes. distribution processes impose constraints on the causal directions of the connected energybonds. a 1-junction must have exactly one effort input  all other bonds generate effort. consider for example a node in an electrical network: there is only a single voltage level at 
1 	qualitative reasoning 
such a point  imposed from one of the connected lines. on the other hand  a 1-junction may have several input efforts  but has exactly one output effort. finally  the conversion process tf must have one effort input and one effort output; gy has either effort or flow at both inputs. since these distribution processes only constrain causal assignment they act as propagators of causality. for instance  if an effort source imposes effort on any of the bonds of a 1-junction  all other bonds must have opposite causality. this in turn may determine causality at other junctions. 
1 	generation of causal directions 
now we will turn to the generation of causal directions within a bond-graph model. this is done following the sequential causality assignment procedure 
 scap   karnopp and rosenberg  1; breed veld  1; rosenberg  1 which is one of the most beautiful and powerful tools of the bond-graph method. this procedure is applied to the graph representation of the model and no reference to any mathematical equation is required. given the local restrictions on causal directions  causality assignment to a complete structure proceeds as follows ibreedveld  1 : 
1. choose any source  se or sf  and assign its required causality. propagate the causal implications through the graph as far as possible through distribution processes. repeat this until all sources have been used. 
1. choose any storage process  c or i  and assign its preferred causality. propagate causality as far as possible through the distribution processes. repeat this until all storage processes have been used. 
1. choose any unassigned resistive process  r  and assign arbitrary causality. propagate causality as far as possible through the distribution processes. repeat this until all resistive processes have been used. 
1. choose any remaining unassigned bond and assign arbitrary causality. propagate causality as far as possible through the distribution processes. repeat this until all bonds have been assigned. 
   after causality assignment has been completed  which can be the case after any of these four steps  every process mathematically represents a directed relation. thus  propagation of information is completely specified. 

figure 1: bathtub and its bond-graph model 
1 	an example 
consider for example the bathtub llwasaki  1  as shown in figure 1. the bond-graph model is given on the right. source of flow sf represents the incoming flow from the tap  capacitor c represents the storage of fluid in the bathtub and resistor r stands for the action of the outlet. these processes are connected through energy flows to a single 1-junction  representing the fact that they all act on a single pressure p. energy flows are represented by half arrows  the energybonds. 
in the figure it is indicated to which  effort and flow  variables each bond is related at the signal level. represents the net flow into the bathtub. 
   causality in bond graphs refers to a two-way signal flow. for example  the capacitive process c either must have as its input to produce  compute  p as an output or p must be the input and the output. if the effort is produced at one side of an energybond  then flow is produced at the other side. the actual direction of the causal relation is graphically indicated by a causal stroke at the side of effort production. this results in a very elegant and compact representation of causality  as can be seen in figure 1  for which the associated mathematical decomposition is given on the right in terms of a block diagram. the incoming flow qio is integrated by c to cause an increase of fluid volume l  which causes a rise in pressure p. note that causal directedness is not restricted to linear systems  as p may depend on v in a non-linear way. 

figure 1: decomposition of a capacitive process 
　in figure 1 the bond graph of figure 1 is augmented with causal directions and figure 1 shows the equivalent block diagram. the bond graph can be read as follows: at sf a flow enters the system. on the other hand  at outlet r flow leaves the system as a consequence of pressure p. the resulting net flow  into the container causes an increase of pressure in c. 

figure 1: causally augmented bond graph of bathtub 

figure 1: block diagram of the bathtub model 
   in order to illustrate how a causal order is generated we use a slightly extended version of the bathtub model. suppose that the flow is leaving through a long pipe  such that the mass of the fluid contained in it cannot be neglected. this situation is modelled in figure 1  where i represents the inertial effect of the fluid mass. 
   according to the above procedure  first causality is assigned to the bond connected to a source of flow. since this does not yet determine causality at the 1-junction no propagation is possible. next  effort-producing causality is assigned to the bond connected to c  being one of the storage processes. this immediately determines causality at the 1-junction  which can have only one effort input. the result is shown in figure 1. no further propagation is possible  because the 1-junction is not yet causally determined. 

figured: extended bathtub model 
   next  preferred causality is assigned to the bond connected to inertial process i. as a consequence  the 1-junction is causally determined  as it can have only one flow input  and the causal direction of the bond connected to r is set. this completes the causal order  since every effort or flow is now an input or an output of some mathematical function  or in other words: it has become a cause or an effect. 

figure 1: extended bathtub model after assigning partial and full causality 
1 	comparison with the causal ordering theory 
the method of causal ordering  iwasaki and simon  1a; lwasaki and simon  1b; iwasaki  1; simon and rescher  1 starts off with a self-contained set of equations. exogenous variables are those variables that appear as the only unknown in one of the equations. the values of these variables are substituted in the remaining equations. this results in some other unknowns being determined  which are said to be caused by the exogenous variables. next  the newly found values are in turn used to determine other unknowns. this is repeated until all variables are causally ordered. 
   causal ordering and bond graphs will produce identical causal order if the underlying mathematical models are equal. from the mathematical point of view a bond graph can be considered as a organisational framework that arranges equations and variables in such a way that substitutions are represented by graphical links  viz.  the energybonds. the fundamental difference between both methods is that causal 
	top and akkermans 	1 
ordering is based on abstract mathematical relations and the bond-graph method on formal physical principles. thus the causal ordering theory may perhaps also be applied to nonphysical systems. in the realm of physical systems  however  the bond-graph method constitutes a richer representation of knowledge  is better suited for physical explanation  and generates more causal information. in the following paragraphs this will be elucidated. 
1 	causal resolution 
a causal explanation is acceptable only if  i  the mechanisms on which it is built are intuitively acceptable and  ii  these mechanisms are fully resolved  i.e.  two or more mechanisms should not be combined or mixed. that point  i  is satisfied by the bond-graph method has already been discussed in sec. 
 1. the second issue points to a problem in the causal ordering theory. since bond-graphs are based on an exhaustive set of primitive physical mechanisms  they guarantee a maximum causal resolution for a given model '. this is not the case for the causal ordering theory. the causal ordering theory does not preclude to produce maximum causal resolution  but leaves it up to the personal skills of the modeller. in contrast  bond graphs generate this as an automated part of the method. for example  in a situation where there is a balance of energy flows in the system  the bond-graph method automatically decomposes this into the mechanisms that create that balance. in the causal ordering theory this decomposition may be easily overlooked by the modeller since it is not necessarily obvious from the mathematical structure of the system. 
as an example we consider an evaporator as described by 
iwasaki and simon in llwasaki and simon  1ai. their model consists of 1 unknowns in 1 equations  1 of which are assumed to be exogenous. the resulting causal order is given in figure 1. on the other hand  the bond-graph model that is based on the same physical description generates 1 variables and 1 equations  of which 1 arc exogenous . the corresponding causal order  figure 1  shows a much more detailed structure. 

figure 1: causal order for an evaporator according to llwasaki and simon  1a  
　this lack of resolution in the first diagram is partly due to one of their mechanisms  based on the balance of energy flows in the refrigerant  which should have been decomposed further into local mechanisms. as a consequence  the causal order of figure 1 does not show that and influence  in  iwasaki and simon  1bj a difference 
     1 of course  it is a modelling problem to find out into what detail mechanisms must he distinguished in the real system. however  given a certain detail of modelling it is necessary to preserve that detail in the modelling language. 
1 	qualitative reasoning 

figure 1: causal order for an evaporator from the bond-graph model 
variable like  is called a 'defined' quantity  an artifact of the modelling method that should be avoided since it has no physical meaning. however  every effort  such as temperature or pressure  is defined relative to some reference. hence  is no more an artifact than the so-called 'rear quantities and are. in fact  every effort difference across some path of energy exchange can be the cause of a flow along that path and thus must be considered separately. consequently  it makes sense to split up  the total heat absorbed by the refrigerant  into  heat absorbed by the refrigerant liquid  and  heat absorbed due to evaporation of the refrigerant . for a causal explanation it is definitely relevant to distinguish between all of these quantities. 
1 	exogeneity 
determining exogeneity is essentially a matter of modelling and certainly not a syntactical issue  iwasaki and simon  1a|. it is based on assumptions of possible interactions between the system under consideration and the rest of the world. a modeller uses his or her experience and general knowledge of the world to make these assumptions. the theory of causal ordering simply refers to those variables in the system that are not influenced by the system. bond graphs however provide a more refined approach to exogeneity in the context of physical systems  thus supporting the modeller. 
   two types of exogeneity can be distinguished  viz.  direct and indirect exogeneity. direct exogeneity is related to processes or influences from outside the system that directly determine certain dynamic variables within the system. these influences are represented by sources in a bond graph. in fact  iwasaki's suggestion that exogeneity is related to processes which involve 'infinite1 amounts of energy llwasaki and simon  1a  is given a formal basis in the definition of a source. it delivers or consumes energy without being influenced. a battery in an electrical circuit is usually modelled as an ideal source of voltage. 
   indirect exogeneity is related to the assumption that a dynamic system is embedded in a fixed structure which is not influenced by the changes of variables. for example  it is usually the case that the capacitance of an electrical capacitor is not influenced by the charge and voltage it is holding  although its value is implied by their values . this type of exogeneity is represented by parameters  to be distinguished from dynamical variables. this physically relevant distinction is usually ignored in ai. 
1 	self-containment 
the theory of causal ordering requires the  static or mixed  mathematical model to be self-contained  iwasaki  1. it is up to the modeller to check a model and to repair it if does not satisfy these requirements: no part of the structure may be overdetermined and the equations may not be dependent. if a model is expressed in terms of a bond graph however  causality assignment automatically checks self-containment. this is due to the fact that after correct causal assignment every variable  effort or flow  is the result of precisely one expression  in which this variable does not occur. the system is said to be in canonical form f  l wasaki  1. given the initial values at all storage processes a single value for each variable in the system follows. 
   however  during modelling it is possible to construct a system that is not self-contained. in that case applying scap will immediately reveal the problem. for example  suppose we connect two effort sources to a single 1-junction  so that the system is overdetermined. since a   -junction cannot accept two efforts as its input  reverse causality has to be assigned for the second source. hence  a causal error is detected and located. if both effort sources impose equal values one of them is redundant  if they don't the system is inconsistent. this corresponds to the impossibility for two batteries of different voltage and connected in parallel to act like two perfect effort sources. 
   an interesting application of automatic checking of self containment arises if a  mixed  dynamic structure is equilibrated. equilibrating refers to the process of replacing dynamic mechanisms by their corresponding equilibrium mechanisms  in order to find the state of the system after these processes have reached steady-state behaviour   i wasaki  1. in a bond-graph model equilibrating boils down to replacing capacitive processes by flow sources and inertial processes by effort sources  and setting the respective sources to zero output. next  scap is applied to generate a causal order for the new system. if no causal error is detected the system has a steady-state solution  otherwise the system is overdetermined. in that case simple propagation of values shows whether there is an infinite number of solutions or none ibreedveld  1 . 
1 	feedback 
in the theory of causal ordering 1 wasaki and simon  1a; 
i wasaki and simon  1b  feedback is detected when causal analysis runs into a set of equations that can only be solved simultaneously. the theory does not provide any information about the type of feedback or its sign. bond graphs incorporate a much more clear and informative representation of feedback. its presence  character and symbolic sign are provided automatically from the causally augmented graph. moreover  in contrast to the causal ordering theory bond graphs do assign a causal direction within a feedback loop. 
causal loops. a feedback loop within a bond graph simply shows up as a causal loop  i.e.  a chain ol* energybonds with equally directed causality between two storage and/or resistive processes 1 for example  in figure 1 the bonds 
1
　　any gy within the chain continues it  although the causal direction is reversed. 
between c  1 and r represent a causal loop  corresponding to the feedback loop in figure 1. 
   only three types of loops arc possible. loops between inert ial and capacitive processes introduce two derivatives and thus are of second order  related to oscillation   loops between resistive and storage processes arc of first order  related to relaxating behaviour   and loops between resistive processes are static. hence  the character of a loop can be obtained directly by inspecting the graph. 
   in general the sign of a feedback loop can be simply derived from the individual directions of the energybonds by tracing the reversals of bond directions within the loop. for example  in figure 1 the direction of the energybonds between c and r reverses at the intermediate 1-junction  resulting in a negative feedback loop. in many cases the feedback sign can be found even more easily by applying one of the seven theorems developed in i brown  1 . 
   thus  the path of a feedback loop  its character  sign and internal causal direction can be established immediately from inspection of the bond graph. however  the net effect of several interacting feedback loops cannot be determined on the basis of qualitative information only  since it depends in a complicated way on the actual values of the parameters. in fact  this points to a basic problem of the quantity space ide kleer and brown. 1; forbus  1; kuipers ' 1 . 
the resolution of a quantity space is too low to allow for an adequate treatment of multiple feedback. 
instantaneous feedback. it may happen that a feedback loop contains no dynamic processes. in that case feedback is mathematically described in terms of a set of simultaneous 
equations that cannot be solved by simple substitution. according to iwasaki and simon llwasaki and simon  1b  it is pointless to assign a causal order within such a loop. in the above paragraph we already mentioned that in a bond graph this type of feedback can easily be recognised as a causal loop between two resistive  r  processes. moreover  the presence of this algebraic feedback is detected already during the application of scap: if sources and storage processes do not succeed in determining all causal directions within the model  then the remaining acausal bonds participate in algebraic feedback. as we saw in section 1  scap does not prescribe a preferred causal direction in such a loop. hence  bond graphs do assign causality within all types of feedback  but in the case of algebraic feedback the direction is arbitrary. 
   the following argument shows that this agrees with the intuitive conception of causality. an algebraic feedback loop can actually be considered as a dynamic loop that is assumed to reach equilibrium instantaneously  i.e.  in a time that is very short compared to the time scale of the rest of the system. however  causal reasoning is only possible in terms of a sequence of causes and effects over time. since the algebraic loop reaches equilibrium in 'no time' compared to the rest of the system  it makes no difference what comes first. hence  there is no preferred causal direction. it is interesting to relate this argument to the conclusion in llwasaki and simon  1a  that the causal ordering in the equilibrated bathtub example is counterintuitive. apparently  any causal explanation needs dynamics to be intuitively acceptable. a steady state model is intuitively explained in terms of the associated dynamic 
behaviour and in a dynamic model  relatively  instantaneous processes are assigned 'virtual' dynamics. 
	top and akkermans 	1 

   an example of instantaneous feedback can be found in a pressure regulator  see e.g. ide kleer and brown  1   between the regulating resistance and the load resistance. 
1 	conclusion 
it has been argued that the bond-graph method can be fruitfully applied to represent and generate causal order in a 
physical system in a formal way. we have emphasised the physical notions that underly bond-graph causality and have indicated that they conform well with expert physicists' ideas. assignment of causal directedness is done on a local basis. a causal order is then computationally generated using the sequential causality assignment procedure  applied to the graphical representation of the model. 
   we have compared this conception of causality with that of the causal ordering theory of iwasaki and simon iiwasaki and simon  1a i. these two concepts turn out to be similar  but it appears that the causal ordering theory can be put on a firmer physical foundation if it is based on bond-graph causality. it has furthermore been demonstrated  with the help of various examples  that the present approach yields additional causal information. bond graphs arc seen to be more powerful with 
respect to: 
  causal resolution 
  exogeneity 
  self-containment 
  feedback 
   the causal analysis techniques described in this paper have been fully implemented in quba  our system for qualitative bond graph analysis. 
   bond graphs constitute a powerful tool for integrated qualitative and quantitative analysis of physical systems. this is being strengthened by their application to causal ordering. 
