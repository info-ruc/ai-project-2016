
the ability to detect failures and to analyze their causes is one of the preconditions of truly autonomous mobile robots. especially online failure detection is a complex task  since the effects of failures are typically difficult to model and often resemble the noisy system behavior in a fault-free operational mode. the extremely low a priori likelihood of failures poses additional challenges for detection algorithms. in this paper  we present an approach that applies gaussian process classification and regression techniques for learning highly effective proposal distributions of a particle filter that is applied to track the state of the system. as a result  the efficiency and robustness of the state estimation process is substantially improved. in practical experiments carried out with a real robot we demonstrate that our system is capable of detecting collisions with unseen obstacles while at the same time estimating the changing point of contact with the obstacle.
1 introduction
the detection of and reaction to unforeseen failure events is a fundamental ability for autonomous systems as an improper treatment of such situations may cause loss of control and can possibly harm the system or the environment. consider  for example  a mobile service robot that collides with a low doorstep or a planetary rover that hits an unforseen small rock. in such situations  the mobile robot should be able to  a  detect the unexpected event quickly and  b  to infer the cause of the event in order to react appropriately. many successful previous approaches to the online failure detection problem are based on the sequential monte-carlo method. they typically track multiple system modes in parallel before they decide on the most probable one. a crucial problem for such sampling-based approaches especially in real-time scenarios  however  lies in the high dimensionality of the state space to be tracked and the low frequency and unpredictability of failure events. to increase the efficiency of sample-based representations  different techniques such as lookahead sampling  de freitas et al.  1   risk sensitive sampling  thrun et al.  1   and hierarchical sampling  verma et al.  1  have been proposed. in this paper  we propose an alternative approach  in which gaussian processes  gp  are used to learn proposal distributions that represent informed guesses about the failure mode and its parameters. we demonstrate how gp classification can be used to predict discrete failure modes and how gp regression can be used to model continuous failure parameters. since gaussian processes provide full predictive distributions including the predictive uncertainties  they can readily be used as proposal distributions in the particle filter implementation. by includingthe most recent sensor measurements received by the robot  these proposals can be seen as an approximation of the optimal proposals for the respective state variables.
모our system does not require additional hardware such as inertial sensors or bumper rings  which may be expensive or otherwise unfavorable in certain domains  e.g.  for aerial blimps. the proposed algorithm has been implemented on a real robot and can be executed in real-time. we discuss results from several test runs in realistic scenarios in which we compared the achievable detection rates and pose tracking quality of our system with an optimized standard particle filter implementation without informed proposals.
모this paper is organizedas follows. after discussing related work  we describe particle filters for sequential state estimation and failure detection in section 1. our gaussian process proposals are introduced in section 1  followed by the experimental results.
1 related work
the close coupling between a mobile system and its environment makes it hard to detect abnormal behavior using instantaneous statistical tests only without tracking possible failure modes over time  dearden and clancy  1 . for this reason  probabilistic state tracking techniques have been applied to this problem. particle filters represent the belief about the state of the system by a set of state samples  thrun et al.  1 . in particle filter based approaches to fault diagnosis  the system is typically modeled by a non-linear markov jump process  driessen and boers  1  or a dynamic mixture of linear processes  de freitas et al.  1 . the look-ahead particle filter introduced in the latter work also approximates the optimal proposal distribution by considering the most recent sensor measurements  but in contrast to our work focuses on the case of discrete failure modes without continuous failure

figure 1: graphical model for the dynamic system in an abstract view  left  and a more detailed form  right  where the system states st are split up to include the discrete failure mode ft  the failure parameters ot  and the robot's state xt.
parameters. benanzera et al.  combine consistencybased approaches  i.e.  the livingstone system  with particle filter based state estimation techniques. verma et al.  introduce the variable resolution particle filter for failure detection. their approach is to build an abstraction hierarchy of system models. the models of consideration build a partition of the complete state space and the hierarchy is defined in terms of behavioral similarity. a different kind of model abstraction hierarchy based on explicit model assumptions was developed in  plagemann et al.  1  to detect failures online. other approaches that deal with the time efficiency of particle filters include  kwok et al.  1  in which real-time constraints are considered for single system models.
모gaussian processes have been widely studied in the machine learning community. excellent introductions have been given by  mackay  1  and  rasmussen  1 .  girard et al.  1  present a gaussian process based model for multiple step ahead prediction of time series. classification models are discussed in  neal  1 .  schwaighofer et al.  1  present an application of gaussian processes to localization using signals of a wireless phone network.
1 sequential state estimation
the temporal evolution of dynamic systems such as mobile robots can be described using the graphical model depicted in the left diagram of figure 1. in this figure  st denotes the state of the system at time t  zt stands for received sensor measurements  and ut is the issued control command. given the modeled independence assumptions  the state of the system can be evaluated recursively using the bayes filter formalism  thrun et al.  1 
p st | z1:t u1:t 1 
= 붾t p zt | st  z p st | st 1 ut 1  p st 1 | z1:t 1 u1:t 1  dst 1. 1 
	observation model|	{z	}	|	transition model{z	} |	recursive term{z	}
particle filters are widely used as a sample based implementation of this recursive filter. they represent the state of the system by a set of weighted samples. with the sample-based representation  the integral in equation 1 simplifies to a finite sum over the samples resulting from the previous iteration. the transition model and the observation model can be applied directly to predict and weight the individual samples respectively.
1 modeling failure events and parameters
for dynamic systems under the influence of external or internal failure events  the state st of the system can be split up to include the discrete failure mode ft  the continuous failure parameters ot  and the remaining part of the robot's state xt. we assume the commonly used constant failure rate model
 see  ng et al.  1    where the failure event itself does not depend on the rest of the system. the right diagram of figure 1 shows the underlying graphical model. since the observations are independent of the failure state  ft ot  given the state xt of the robot  the observation model simplifies to p zt | st  = p zt | xt . the transition model can be factorized as
	p st | st 1 ut 1  = p xt ft ot | xt 1 ft 1 ot 1 ut 1 	 1 

	failure event model	failure parameter model	robot motion model
모the constant failure rate model states that failure events are distributed exponentially depending on a failure rate parameter 뷂 by
               p ft  = 1   e 뷂몫 t t      1  where t denotes the time of the last failure event. it can easily be shown that for such a model  the mean time between failures becomes mtbf = 뷂1. for realistic failure rates 뷂  this model results in extremely low failure probabilities per filter iteration. assume  for example  a mean time of 1 minutes between collisions of a service robot with unseen obstacles. this implies and with a filter frequency of 붻t = 1 seconds yields a failure probability of p ft |  ft 1  뫘 1 within one iteration. for such a small value  just one of 1 particles would jump to a failure mode on average. thus  one would either need an extremely large particle set or would risk that failures remain undetected. this problem is amplified by the fact that not only the discrete failure mode has to be sampled  but also the unknown continuous failure parameters. since in general  there is no prior knowledge about the parameters of randomly occurring failures  we assume a uniform distribution
모모모모p ot | ft xt 1 ot 1  = u omin omax  ot   1  over a certain interval. note that this model applies only to the case where the system transitions into a failure state. the evolution of failure parameters within a failure state is typically governed by a much more peaked distribution similar to the motion model of the robot. in section 1  we describe our model for the evolution of collision parameters based on rigid body dynamics. this model is able to track collisions sufficiently accurate  if the initial collision parameters have been estimated well enough. the main focus of this work therefore is to improve the detection of failure events and to efficiently estimate the initial parameters.
모to address the problem of low sampling probabilities for important parts of the state space   thrun et al.  1  introduced the risk sensitive particle filter that incorporates a learned risk function to force the filter into less likely but important states. while this approach ensures a reasonable amount of samples in the important failure modes  it cannot adapt to the specific situation the robot is in when the sampling decision is made. we therefore propose to use learned proposal distributions to be able to make informed guesses about the discrete failure mode and the continuous failure parameters online.
1 data-driven proposal distributions
in the sequential importance sampling scheme  see  doucet  1   an arbitrary proposal distribution can be used to directly sample the relevant areas of the state space as long as  a  all possible states have a non-zero possibility of being chosen and  b  the importance weights of the particles are adjusted appropriately. proposal distributions that depend on the most recent sensor measurements or on features extracted by separate algorithms are typically denoted as datadriven proposals or detector-mediated proposals  see  khan et al.  1  . such proposals aim at approximating the optimal proposal p st | st 1 zt ut 1  which fully includes the most current sensor measurement zt. with the process model defined in equations 1 and 1  the weight for particle i at time t becomes

where 뷇 is the proposal distribution forto the transition model defined in equation 1 with the failure event model exchanged for 뷇f and the failure parameter model exchanged for 뷇o. here  뷇f and 뷇o are the learned proposal distributions for the discrete ft and the continuous ot respectively. the control commands ut have been omitted for clarity  they are straightforward to include. the normalizing factor 붾 is constant for all particles i. furthermore  ft denotes an arbitrary feature vector extracted at time t. any feature vector ft as well as any functions 뷇f and 뷇o can be used for this task as long as the assumptions
 for all f with  for all o with.
hold  which means that all possible failure states have to be assigned a non-zero probability of being chosen. visually speaking  equation 1 states that after each filter iteration  the particle weights have to be multiplied with the current observation likelihood and with two correction terms for the two learned proposal distributions. to calculate these correction terms for a specific sample s ti   we divide the probabilities defined in equations 1 and 1 by the likelihoods according to which the state variables ft i  and o ti  have been drawn from 뷇f and 뷇o. another precondition for the learned proposals therefore is the availability of likelihoods for sampled values. as we will see in the next section  gaussian processes always ensure the non-zero probability assumptions  can easily be sampled from  and provide the transition probabilities needed for the weight correction described above.
1 gaussian processes proposals for discrete and continuous state variables
gaussian processes are a powerful tool for learning and representing full predictive distributions for non-linear functions  rasmussen  1  and have also proven successful in solving classification problems. given a training set and priors on the function to be learned  the gaussian process model allows to predict function values at new input locations and also supplies predictive uncertainties. we first introduce the regression and classification models as well as their role in the general failure detection setting described above. in section 1  we then describe a specific application in detail  the detection and tracking of collision events for mobile robots.
1 non-linear regression
assuming a non-linear functional dependency g between mdimensional input vectors y1 ... yn and real-valued targets t1 ... tn such that for independent error
   the task is to predict future targets tn+j at new input locations yn+j. the idea of gaussian processes is to view all target values t1 ... tn+j as jointly gaussian distributed with an  n + j -dimensional mean and a covariance  specified via a kernel distance function k on the input vectors. predictions for a new query point yn+1 can thus be performed by conditioning on the known target values t1 ... tn  see  neal  1 . the mean 뷃 and variance 1 of the gaussian predictive distribution for tn+1
turn out to be뷃 = e tn+1 | t1 ... tn =ktc 1t 1 1 = v  tn+1 | t1 ... tn =v   ktc 1k 1 with c the n 뫄 n covariance matrix for the given targets  t the n-dimensional vector of given target values  and k the n-dimensional vector of covariances between the new target value tn+1 and the known targets t1 ... tn.
모in our failure detection setting  we can use this regression model to predict the continuous parameters of new failure events. we take extracted features ft as input vectors y and failure parameters ot as targets t. given a training set of such quantities and a properly chosen covariance function k  we can compute the predictive distribution 뷇o ot | ft ft  := n 뷃 1  as detailed in equations 1 and 1. this  normal  distribution naturally meets the requirements for proposal distributions named in the previous section. it can be sampled from directly  it supplies the likelihoods of sampled values  it has an infinite support  and it therefore only assigns non-zero likelihoods.

	diff vr	diff vr  m/s 
figure 1: the collision event training set where two feature values are mapped to class instances  left   the learned class probabilities 뷇f ft  using gaussian process classification  middle   and the learned regression model for the collision parameters visualized by a cut through the 1-dimensional pdf that maps velocity deviations to contact points for a collision  right .모an important aspect that has been left out so far is the choice of covariance function and how its parameters can be set. the covariance function plays an important role in the gaussian process framework as it represents the prior knowledge about the underlying function g. by changing its form and parameters  one can control the generalization behavior and smoothness of the predictor. a common choice of covariance function  see  mackay  1   that is also used in this work is

with a constant component and a non-linear  stationary term  which depends only on the distance between input points. the parameters of the covariance function are called hyperparameters of the gaussian process. they can either be fixed by maximizing the likelihood of the given data points or  for fully bayesian treatment  can be integrated over using parameter-specific prior distributions. for our experiments reported in section 1  we employed the latter strategy with gamma priors on the hyperparameters. we set these priors to favor smooth regression functions to avoid overfitting to the training data. the analytically intractable integration over the hyperparameters is approximated using markov chain sampling and the prediction results are cached on a fine-grained grid.
1 binary classification
binary classification problems can consistently be modeled in this framework by including for every binary target ti a real-valued latent variable li  such that
	  	 1 
which is known as the logistic model that links class probabilities to real values  see  neal  1 . the latent variables can now be given a gaussian process prior as in the regression setting and predictionsof class probabilitiescan be performed by predicting the corresponding latent variables and evaluating equation 1. for the failure detection problem  we again use feature vectors ft as inputs and binary failure labels ft as targets. the predicted class probabilities for new features then directly define the failure event proposal 뷇f ft | ft .
1 learning to predict collision events and parameters
in this section  we apply the sequential failure detection approach described above to the hard problem of collision detection for mobile robots under noisy sensor measurements and without additional hardware like bumpers or inertial sensors. for learning the collision event proposal and the proposal for the contact point of the robot with the obstacle  we achieve excellent results with simple features based on the rotational and the translational velocity of the robot. thus  we use as input to the gaussian process classifier the twodimensional feature vector ft =  붟vt 붟vr   where 붟vt is the difference between the translational velocity estimated by the particle filter and the one estimated by local laser scan matching. furthermore  붟vr is the difference of the rotational velocities respectively. a training set of 1 automatically labeled trajectories was generated by simulating random collisions with different obstacles using the 1d simulator gazebo  koenig and howard  1 . whereas the left diagram of figure 1 depicts the gathered data points  the middle diagram in the same figure shows the learned class probabilities depending on the two velocity differences described above. as can be seen from the left diagram  붟vt is negative for nearly all  collision  data points  which corresponds to the fact that the robot is slowed down when a collision occurs. the data points for  no collision  are spread widely and do not separate well from the  collision  data points due to noisy sensor measurements and imperfect labeling of the collision events. this makes the classification problem a hard one. it should be stressed  that we use this classifier as a proposal distribution for collisions rather than as a collision detector directly  because the features are too ambiguous to allow for perfect instantaneous classification. experiments with a real robot  see section 1  showed that this yields high detection rates with a low number of false alarms.
모given a collision event  the continuous collision parameters o have to be estimated to simulate the effects on the system and to continue the tracking process. since the task is not to fully track the pushed obstacle over time  a simple model that abstracts from the obstacle's geometry and exact pose has proven sufficient to describe the effects on the robot. a collision with an unseen obstacle is represented by the obstacle mass m and the contact point c on the front of the robot. therefore  the collision parameters are o =  m c . we learn the proposal distribution 뷇o ot|ft  for the parameters ot using the same velocity-based features and simulated training set as described above and the gaussian process re-
x  m 
figure 1  a : two correctly detected collisions  triangles   the estimated trajectory  solid line   1
	 1	 1 1
number of particles
figure 1  b : average deviation of the estimated trajectory from the ground truth in meters for a varying	 1	 1	 1	 1	 1	 1	 1
filter iteration
figure 1  c : estimation details around a correctly detected collision including the manually labeled true collision event.
one filter iteration corresponds to 1 seconds. 1
 1and the ground truth  dotted .	number of particles.
gression technique. the right diagram of figure 1 depicts a cut through the learned 1-dimensionaldistribution for the collision parameter c  which is the contact point of the obstacle on the front of the robot. the point of contact is measured in meters from the center of the robot's front to the right. it can be seen from the diagram that unexpected clockwise rotations  붟vr   1  of the robot are mapped to positive values for the contact point  which corresponds to a collision on the righthand side of the robot.
1 experimental results
our system has been implemented on a real activmedia pioneer 1dx robot and has been extensively tested in an office environment. before presenting experimental results  we describe the motion model we implemented for our localization system. since this model is not the focus of this work  we give only a brief overview here.
모the most widely used motion model for mobile robots is based on the wheel encoder measurements  see  thrun et al.  1  . this information  rather than the the actual control command  is taken as control input ut 1  which under normal circumstances results in accurate predictions of the performed movement. under the influence of failures like collisions or wheel slip  however  the motion of the wheels is not consistent with the whole robot's motion any more. a more appropriate model for such situations that still is efficient enough to be evaluated online is based on simple rigid body dynamics  see  plagemann et al.  1  . we model the robot as a rigid body in the 1-dimensional plane  represented by a set of constant values and the variable state vector xt =  posx posy pos붿 velt velr  which includes the translational velocity velt and the rotational velocity velr. in each filter iteration  the wheel thrusts are calculated from the actual velocity command that was sent to the motors. from this  the next state vector is computed by numerical simulation using the physical relationships between forces  acceleration  and speed. due to space limitations  we refer to  witkin and baraff  1  for details about rigid body physics. with this model  collisions with another rigid object at a given point of contact can be simulated using the same type of physical abstraction  namely computing the impulse  the resulting forces  and ultimately the influence on the robot's state vector. at the same time  this model describes how the point of contact between the robot and the obstacle changes over time and therefore defines the transition model for failure parameters of equation 1. from our experience  this physical model achieves the best balance between accuracy and efficiency. simpler models fail to handle important test cases while more complex models have too many free parameters to be evaluated in real time.
1 quantitative evaluation of failure detection and tracking performance
to quantitatively evaluate the usefulness of our approach  we compared it to a particle filter that implements the same process model with the standard uninformed proposals described in section 1. the parameters of the standard filter were optimized for best tracking performance and failure detection rates to ensure comparability. we recorded data by manually steering the robot through the environment and arranged for two collisions  one with boxes of milk and the other one with a box of lemonade bottles. both obstacles were placed at arbitrary positions and the obstacle heights were too low for the laser sensor to detect them. figure 1 a  depicts a typical test run  where our system successfully tracked the pose of the robot and detected the two collisions. on the recorded data set  we tested our improved particle filter with gaussian process proposals  gp-pf  as well as the standard particle filter  std pf  for different parameter settings. each filter was executed 1 times for each parameter setting.
모table 1 gives the failure detection performance of the different filters. the detection rate is defined as the number of correctly identified failures relative to the full number. the false positives rate is the amount of false alarms relative to the number of detections. the ground truth collision events were manually entered and a collision was counted as correctly detected  when the marginal failure likelihood exceeded a threshold 붣 after a maximum of six filter iterations  1 seconds  after the true failure event. the threshold 붣 was optimized independently for each filter to allow an unbiased comparison.
std pfstd pfgp-pfgp-pf1 particles1 p.1 p.1 p.detection rate1 %1 %1 %1 %false positives1 %1 %1 %1 %table 1: detection results with the optimized standard particle filter  std pf  and our approach that uses gaussian process proposals  gp-pf .
모the diagram in figure 1 b  gives the average deviation of the tracked poses of the robot compared to the ground truth trajectory. the ground truth trajectory was computed using a scan matcher. the results visualized in this diagram show that our system stays around ten centimeters closer to the true trajectory and produces less variance in these estimates than the standard approach. this is mainly due to the fact that the failure parameter  here  the point of contact with the obstacle  is estimated more accurately. to give an impression about the accuracy with which our filter estimates the point of contact and thereby the path of the robot  one failure event is depicted in detail in the diagram of figure 1 c . it can be seen  that the estimated failure likelihood increases shortly after the labeled failure event and that the heading angle of the robot is correctly estimated.
모the detection rates as well as the tracking results show that learned gaussian process proposals can indeed increase the reliability and efficiency of online state estimation approaches. the time requirements for the improved particle filter are around 1% to 1% higher than for the standard implementation without gaussian process proposals. nevertheless  the implemented system with 1 particles still processes one minute of recorded data in less than 1 seconds on a pc with a 1 mhz cpu.
1 conclusions
in this paper  we showed that efficient proposal distributions for particle filters can be learned usinggaussian process models and that both discrete as well as continuous state variables can be treated in a consistent manner. we applied the approach to the hard problem of online failure detection on mobile robots and presented a system for detecting unforseen collisions. experiments with a real robot demonstrated  that the developed system is able to track the state of the robot more reliably through collision events than an optimized version of the standard particle filter with uninformed proposals. our system does not require any additional hardware and can be trained conveniently using a simulator.
모while our current system only deals with binary failure variables  we believe that the multi-class case  potentially including different simultaneous failures  can be formulated and solved using similar models. for a limited set of such discrete failure modes  the combination of this system with the look-ahead particle filter  de freitas et al.  1  may be beneficial. moreover  in future work  we would like to extend our approach to the more general problem domain of learning sampling models for dynamic bayesian networks.
acknowledgments
this work has been supported by the ec under fp1cosy  by the german ministry for education and research  bmbf  through the desire project  and by the national science foundation under nsf career grant iis-1. 