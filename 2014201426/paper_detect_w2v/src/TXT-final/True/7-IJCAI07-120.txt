
in case-based reasoning  the adaptation of a source case in order to solve the target problem is at the same time crucial and difficult to implement. the reason for this difficulty is that  in general  adaptation strongly depends on domain-dependent knowledge. this fact motivates research on adaptation knowledge acquisition  aka . this paper presents an approach to aka based on the principles and techniques of knowledge discovery from databases and data-mining. it is implemented in cabamaka  a system that explores the variations within the case base to elicit adaptation knowledge. this system has been successfully tested in an application of case-based reasoning to decision support in the domain of breast cancer treatment.
1	introduction
case-based reasoning  cbr  riesbeck and schank  1   aims at solving a target problem thanks to a case base. a case represents a previously solved problem and may be seen as a pair  problem solution . a cbr system selects a case from the case base and then adapts the associated solution  requiring domain-dependent knowledge for adaptation. the goal of adaptation knowledge acquisition  aka  is to detect and extract this knowledge. this is the function of the semiautomatic system cabamaka  which applies principles of knowledge discovery from databases  kdd  to aka  in particular frequent itemset extraction. this paper presents the system cabamaka: its principles  its implementation and an example of adaptation rule discovered in the framework of an application to breast cancer treatment. the originality of cabamaka lies essentially in the approach of aka that uses a powerful learning technique that is guided by a domain expert  according to the spirit of kdd. this paper proposes an original and working approach to aka  based on kdd techniques. in addition  the kdd process is performed on a knowledge base itself  leading to the extraction of meta-knowledge  i.e. knowledge units for manipulating other knowledge units. this is also one of the rare papers trying to build an effective bridge between knowledge discovery and case-based reasoning.
모the paper is organized as follows. section 1 presents basic notions about cbr and adaptation. section 1 summarizes researches on aka. section 1 describes the system cabamaka: its main principles  its implementation and examples of adaptation knowledge acquired from it. finally  section 1 draws some conclusions and points out future work.
1 cbr and adaptation
a case in a given cbr application encodes a problem-solving episode that is represented by a problem statement pb and an associated solution sol pb . the case is denoted by the pair  pb sol pb   in the following. let problems and solutions be the set of problems and the set of solutions of the application domain  and  is a solution of  be a binary relation on problems 뫄 solutions. in general  this relation is not known in the whole but at least a finite number of its instances  pb sol pb   is known and constitutes the case base cb. an element of cb is called a source case and is denoted by srce-case =  srce sol srce    where srce is a source problem. in a particular cbr session  the problem to be solved is called target problem  denoted by tgt.
모a case-based inference associates to tgt a solution sol tgt   with respect to the case base cb and to additional knowledge bases  in particular o  the domain ontology  also known as domain theory or domain knowledge  that usually introduces the concepts and terms used to represent the cases. it can be noticed that the research work presented in this paper is based on the assumption that there exists a domain ontology associated with the case base  in the spirit of knowledgeintensive cbr  aamodt  1 .
모a classical decomposition of cbr relies on the steps of retrieval and adaptation. retrieval selects  srce sol srce   뫍 cb such that srce is similar to tgt according to some similarity criterion. the goal of adaptation is to solve tgt by modifying sol srce  accordingly. thus  the profile of the adaptation function is adaptation :   srce sol srce  
모the work presented hereafter is based on the following model of adaptation  similar to transformational analogy  carbonell  1 :
  srce tgt  뫸 붟pb  where 붟pb encodes the similarities and dissimilarities of the problems srce and tgt.
sol  where ak is the adaptation knowledge and where 붟sol encodes the similarities and dissimilarities of sol srce  and the forthcoming sol tgt .
  sol srce  srce  is modified into sol tgt  according to 붟sol.
모adaptation is generally supposed to be domain-dependent in the sense that it relies on domain-specific adaptation knowledge. therefore  this knowledge has to be acquired. this is the purpose of adaptation knowledge acquisition  aka .
1	related work in aka
the notion of adaptation case is introduced in  leake et al.  1 . the system dial is a case-based planner in the domain of disaster response planning. disaster response planning is the initial strategic planning used to determine how to assess damage  evacuate victims  etc. in response to natural and man-made disasters such as earthquakes and chemical spills. to adapt a case  the dial system performs either a case-based adaptation or a rule-based adaptation. the casebased adaptation attempts to retrieve an adaptation case describing the successful adaptation of a similar previous adaptation problem. an adaptation case represents an adaptation as the combination of transformations  e.g. addition  deletion  substitution  plus memory search for the knowledge needed to operationalize the transformation  e.g. to find what to add or substitute   thus reifying the principle: adaptation = transformations + memory search. an adaptation case in dial packages information about the context of an adaptation  the derivation of its solution  and the effort involved in the derivation process. the context information includes characteristics of the problem for which adaptation was generated  such as the type of problem  the value being adapted  and the roles that value fills in the response plan. the derivation records the operations needed to find appropriate values in memory  e.g. operations to extract role-fillers or other information to guide the memory search process. finally  the effort records the actual effort expended to find the solution path. it can be noticed that the core idea of  transformation  is also present in our own adaptation knowledge extraction.
모in  jarmulak et al.  1   an approach to aka is presented that produces a set of adaptation cases  where an adaptation case is the representation of a particular adaptation process. the adaptation case base  cba  is then used for further adaptation steps: an adaptation step itself is based on cbr  reusing the adaptation cases of cba. cba is built as follows. for each  srce1 sol srce1   뫍 cb  the retrieval step of the cbr system using the case base cb without  srce1 sol srce1   returns a case  srce1 sol srce1  . then  an adaptation case is built based on both source cases and is added to cba. this adaptation case encodes srce1  sol srce1   the difference between srce1 and srce1  붟pb  with the notations of this paper  and the difference between sol srce1  and sol srce1   붟sol . this approach to aka and cbr has been successfully tested for an application to the design of tablet formulation.
모the idea of the research presented in  hanney and keane  1; hanney  1  is to exploit the variations between source cases to learn adaptation rules. these rules compute variations on solutions from variations on problems. more precisely  ordered pairs  srce-case1 srce-case1  of similar source cases are formed. then  for each of these pairs  the variations between the problems srce1 and srce1 and the solutions sol srce1  and sol srce1  are represented  붟pb and 붟sol . finally  the adaptation rules are learned  using as training set the set of the input-output pairs  붟pb 붟sol . this approach has been tested in two domains: the estimation of the price of flats and houses  and the prediction of the rise time of a servo mechanism. the experiments have shown that the cbr system using the adaptation knowledge acquired from the automatic system of aka shows a better performance compared to the cbr system working without adaptation. this research has influenced our work that is globally based on similar ideas.
모 shiu et al.  1  proposes a method for case base maintenance that reduces the case base to a set of representative cases together with a set of general adaptation rules. these rules handle the perturbation between representative cases and the other ones. they are generated by a fuzzy decision tree algorithm using the pairs of similar source cases as a training set.
모in  wiratunga et al.  1   the idea of  hanney and keane  1  is reused to extend the approach of  jarmulak et al.  1 : some learning algorithms  in particular  c1  are applied to the adaptation cases of cba  to induce general adaptation knowledge.
모these approaches to aka share the idea of exploiting adaptation cases. for some of them   jarmulak et al.  1; leake et al.  1    the adaptation cases themselves constitute the adaptation knowledge  and adaptation is itself a cbr process . for the other ones   hanney and keane  1; shiu et al.  1; wiratunga et al.  1    as for the approach presented in this paper  the adaptation cases are the input of a learning process.
1	cabamaka
we now present the cabamaka system  for acquiring adaptation knowledge. the cabamaka system is at present working in the medical domain of cancer treatment  but it may be reused in other application domains where there exist problems to be solved by a cbr system.
1	principles
cabamaka deals with case base mining for aka. although the main ideas underlying cabamaka are shared with those presented in  hanney and keane  1   the followings are original ones. the adaptation knowledge that is mined has to be validated by experts and has to be associated with explanations making it understandable by the user. in this way  cabamaka may be considered as a semi-automated  or interactive  learning system. this is a necessary requirement for the medical domain for which cabamaka has been initially designed.
	moreover 	the system takes into account every or-
dered pair  srce-case1 srce-case1  with srce-case srce-case1  leading to examine n n   1  pairs of cases for a case base cb where |cb| = n. in practice  this number may be rather large since in the present application
1 . this is one reason for choosing for this system efficient kdd techniques such as charm  zaki and hsiao  1 . this is different from the approach of  hanney and keane  1   where only pairs of similar source cases are considered  according to a fixed criterion. in cabamaka  there is no similarity criterion on which a selection of pairs of cases to be compared could be carried out. indeed  the cbr process in cabamaka relies on the adaptationguided retrieval principle  smyth and keane  1   where only adaptable cases are retrieved. thus  every pair of cases may be of interest  and two cases may appear to be similar w.r.t. a given point of view  and dissimilar w.r.t. another one.
principles of kdd. the goal of kdd is to discover knowledge from databases  under the supervision of an analyst  expert of the domain . a kdd session usually relies on three main steps: data preparation  data-mining  and interpretation of the extracted pieces of information.
모data preparation is mainly based on formatting and filtering operations. the formatting operations are used to transform the data into a form allowing the application of the chosen data-mining operations. the filtering operations are used for removing noisy data and for focusing the data-mining operation on special subsets of objects and/or attributes.
모data-mining algorithms are applied for extracting from data information units showing some regularities  hand et al.  1 . in the present experiment  the charm data-mining algorithm that efficiently performs the extraction of frequent closed itemsets  fcis  has been used  zaki and hsiao  1 . charm inputs a formal database  i.e. a set of binary transactions  where each transaction t is a set of binary items. an itemset i is a set of items  and the support of i  support i   is the proportion of transactions t of the database possessing i  i   t . i is frequent  with respect to a threshold  뫍  1   whenever support i  뫟 . i is closed if it has no proper superset  with the same support.
모the interpretation step aims at interpreting the extracted pieces of information  i.e. the fcis in the present case  with the help of an analyst. in this way  the interpretation step produces new knowledge units  e.g. rules .
모the cabamaka system relies on these main kdd steps as explained below.
formatting. the formatting step of cabamaka inputs the case base cb and outputs a set of transactions obtained from the pairs  srce-case1 srce-case1 . it is composed of two substeps. during the first substep  each srce-case =  srce sol srce   뫍 cb is formatted in two sets of boolean properties: 붯 srce  and 붯 sol srce  . the computation of 붯 srce  consists in translating srce from the problem representation formalism to 1p  p being a set of boolean properties. some information may be lost during this translation  for example  when translating a continuous property into a set of boolean properties  but this loss has to be minimized. now  this translation formats an expression srce expressed in the framework of the domain ontology o to an expression 붯 srce  that will be manipulated as data  i.e. without the use of a reasoning process. therefore  in order to minimize the translation loss  it is assumed that
	if	then q 뫍 붯 srce 	 1 
for each p q 뫍 p  where stands for  q is a consequence of p in the ontology o  . in other words  붯 srce  is assumed to be deductively closed given o in the set p. the same assumption is made for 붯 sol srce  . how this first substep of formatting is computed in practice depends heavily on the representation formalism of the cases and is presented  for our application  in section 1.
모the second substep of formatting produces a transaction t = 붯  srce-case1 srce-case1   for each ordered pair of distinct source cases  based on the sets of items 붯 srce1   붯 srce1   붯 sol srce1   and 붯 sol srce1  . following the model of adaptation presented in section 1  items    and    t has to encode the properties of 붟pb and 붟sol. 붟pb encodes the similarities and dissimilarities of srce1 and srce1  i.e.:
  the properties common to srce1 and srce1  marked by
 =   
  the properties of srce1 that srce1 does not share   -    and
  the properties of srce1 that srce1 does not share   +  .
all these properties are related to problems and thus are marked by pb. 붟sol is computed in a similar way and 붯 t  = 붟pb 뫋 붟sol. for example 
if	
then 	 1 
more generally:
t = {p-pb | p 뫍 붯 srce1  붯 srce1 }
뫋 {p=pb | p 뫍 붯 srce1  뫌 붯 srce1 }
뫋 {p+pb | p 뫍 붯 srce1  붯 srce1 }
뫋 {p-sol | p 뫍 붯 sol srce1   붯 sol srce1  }
뫋 {p=sol | p 뫍 붯 sol srce1   뫌 붯 sol srce1  }
뫋 {p+sol | p 뫍 붯 sol srce1   붯 sol srce1  }
filtering. the filtering operations may take place before  between and after the formatting substeps  and also after the mining step. they are guided by the analyst.
mining. the extraction of fcis is computed thanks to charm  in fact  thanks to a tool based on a charm-like algorithm  from the set of transactions. a transaction t = 붯  srce-case1 srce-case1   encodes a specific adaptation   srce1 sol srce srce1 . for example  consider the following fci:
		 1 
i can be considered as a generalization of a subset of the transactions including the transaction t of equation  1 : i   t. the interpretation of this fci as an adaptation rule is explained below.
interpretation. the interpretation step is supervised by the analyst. the cabamaka system provides the analyst with the extracted fcis and facilities for navigating among them. the analyst may select an fci  say i  and interpret i as an adaptation rule. for example  the fci in equation  1  may be interpreted in the following terms:
if a is a property of srce but is not a property of tgt  c is a property of both srce and tgt  d is not a property of srce but is a property of tgt  a and b are properties of sol srce   and
c is not a property of sol srce 
then the properties of sol tgt  are
붯 sol tgt   =  붯 sol srce     {a}  뫋 {c}.
this rule has to be translated from the formalism 1p  sets of boolean properties  to the formalism of the adaptation rules of the cbr system. the result is an adaptation rule  i.e. a rule whose left part represents conditions on srce  sol srce  and tgt and whose right part represents a way to compute sol tgt . the role of the analyst is to correct and to validate this adaptation rule and to associate an explanation with it. the analyst is helped in this task by the domain ontology o that is useful for organizing the fcis and by the already available adaptation knowledge that is useful for pruning from the fcis the ones that are already known adaptation knowledge.
1	implementation
the cabamaka discovery process relies on the steps described in the previous section:  s1  input the case base   s1  select a subset of it  or take the whole case base : first filtering step   s1  first formatting substep   s1  second filtering step   s1  second formatting substep   s1  third filtering step   s1  data-mining  charm    s1  last filtering step and  s1  interpretation. this process is interactive and iterative: the analyst runs each of the  si   and can interrupt it   and can go back to a previous step at each moment.
모among these steps  only the first ones   s1  to  s1   and the last one are dependent on the representation formalism. in the following  the step  s1  is illustrated in the context of an application. first  some elements on the application itself and the associated knowledge representation formalism are introduced.
application domain. the application domain of the cbr system we are developing is breast cancer treatment: in this application  a problem pb describes a class of patients with a set of attributes and associated constraints  holding on the age of the patient  the size and the localization of the tumor  etc. . a solution sol pb  of pb is a set of therapeutic decisions  in surgery  chemotherapy  radiotherapy  etc. .
모two features of this application must be pointed out. first  the source cases are general cases  or ossified cases according to the terminology of  riesbeck and schank  1  : a source case corresponds to a class of patients and not to a single one. these source cases are obtained from statistical studies in the cancer domain. second  the requested behavior of the cbr system is to provide a treatment and explanations on this treatment proposal. this is why the analyst is required to associate an explanation to a discovered adaptation rule.
representation of cases and of the domain ontology of the application are represented in a light extension ofo. the problems  the solutions  and the domain ontology
owl dl  the web ontology language recommended by the w1c  staab and studer  1  . the parts of the underlying description logic that are useful for this paper are presented below  other elements on description logics  dls  may be found in  staab and studer  1  .
let us consider the following example:

srce 뫖patient tumor.   sizelocalization.뫟1	.left-breast 1  
and a tumor of sizesrce represents the class of patients with an ages 뫟 1 centimeters localized in the lefta 뫍  1   breast.
the dl representation entities used here are atomic and
 defined concepts  e.g.e.g. tumor and localizationsrce  patient  concrete roles  e.g.and  age.뫟1age   rolesand expression representing a class of objects. asize  and constraints  e.g. 뫟1 and  1 . aroleconceptr is a namec is an representing a binary relation between objects. a concrete role g is a name representing a function associating a real number to an object  for this simplified presentation  the only of real numbers . a constraintconcrete domain that is considered isc represents a subset of ir 뫞   the ordered setir denoted by cr. for example  intervals such as 뫟r1=  1;+  application.and  r1=  カ1  introduce constraints that are used in the
a concept is either atomic  a concept name  or defined.
a defined concept is an expression of the following form:
c.c  where c and d are concepts  r is a role  g is a concrete role and c is a constraint  many other constructions exist in the dl  but only these three constructions are used here . following classical dl presentations  staab
and studer  1axiom is a formula of the formsion  or of the formthe semantics of the dl expressions used hereafter can   ancontology뫖 d  whereoc is a set of axioms  where ancdand general concept includ are two concepts. -
wherei is the붟interpretation functioni is a non empty set  the  which maps a conceptinterpretation domainci  to aand몫i  be read as follows. an interpretation is a pair i =  붟
the following  all roles몫such thatmaps붟of an axiomof the defined concepts  for an interpretationseticsuch thatir to a functionr붟ii c  a rolexg i뫍 xd c igresp.r뫍randto a functionito a binary relationrc: 붟rare assumed to be. an interpretation c ig뫖.c is the set of objectsd 뫸i  ifis the set of objectsgcii : 붟 rdiiii  is as follows:functional i  resp.붟뫸is aixir뫄model뫍c.i:x붟붟in몫i=뫍ii  and a concrete role
붟i. the interpretation

di . i is a model of an ontology o if it is a model of each axiom of o. the inference associated with this representation formalism that is used below is the subsumption test: given an ontology o  a concept c is subsumed by a concept d  denoted by d  if for every model i of o  ci   di.
모more practically  the problems of the cbr application are represented by concepts  as srce in  1  . a therapeutic decision dec is also represented by a concept. a solution is a finite set {dec1 dec1 ...deck} of decisions. the decisions of the system are represented by atomic concepts. the knowledge associated with atomic concepts  and hence  with therapeutic decisions  is given by axioms of the domain ontology o. for example  the decision in surgery dec = partial-mastectomy represents a partial ablation of the breast:
partial-mastectomy  mastectomy
	mastectomy  surgery	 1 
surgery  therapeutic-decision
implementation of the first formatting substep  s1 . both problems and decisions constituting solutions are represented by concepts. thus  computing 붯 srce  and 붯 sol srce   amounts to the computation of 붯 c   c being a concept. a property p is an element of the finite set p  see section 1 . in the dl formalism  p is represented by a concept p. a concept c has the property p if p. the set of boolean properties and the set of the corresponding concepts are both denoted by p in the following. given p  붯 c  is simply defined as the set of properties p 뫍 p that c
 1 
as a consequence  if pq then
q 뫍 붯 c . thus  the implication  1  is satisfied.
모the algorithm of the first formatting substep that has been implemented first computes the 붯 c 's for c: the source problems and the decisions occurring in their solutions  and then computes p as the union of the 붯 c 's. this algorithm relies on the following set of equations1:
b is an atomic concept
 occurring in kb and b
cstraintsg and cr cstraintsg the expression  g.c occurs in kb}
 where a is an atomic concept  c and d are  either atomic or defined  concepts  r is a role  g is a concrete role  c is a constraint and kb  the knowledge base  is the union of the case base and of the domain ontology.
모it can be proven that the algorithm for the first formatting substep  computing the 붯 c 's and the set of properties p  respects  1  under the following hypotheses. first  the constructions used in the dl are the ones that have been introduced above  c.c and  g.c  where r is functional . second  no defined concept may strictly subsume an atomic concept  for every atomic concept a  there is no defined concept c such that c and  . under these hypotheses   1  can be proven by a recursion on the size of c  this size is the number of constructions that c contains . these hypotheses hold for our application. however  an ongoing study aims at finding an algorithm for computing the 붯 c 's and p in a more expressive dl  including in particular negation and disjunction of concepts.
모for example  let srce be the problem introduced by the axiom  1 . it is assumed that the constraints associated with the concrete role age in kb are  1  뫟1   1  뫟1   1 and 뫟1  that the constraints associated with the concrete role size in kb are  1 and 뫟1  that there is no concept a = patient in
kb= such thatleft-breasto patientof kb such that a  and that the only concepto left-breast  a is
a
a = breast. then  the implemented algorithm returns:
붯 srce  = {patient  age.뫟1  age.뫟1  age. 1 
 tumor. size.뫟1 
 tumor. localization.left-breast
 tumor. localization.breast}
and the 1 elements of 붯 srce  are added to p.
another example  based on the set of axioms  1  is: 붯 partial-mastectomy  = {partial-mastectomy 
mastectomy surgery therapeutic-decision}
1	results
the cabamaka process piloted by the analyst produces a set of fcis. with n = 1 cases and  = 1%  cabamaka has given 1 fcis in about 1 minutes  on a current pc . only the fcis with at least a + or a - in both problem properties and solution properties were kept  which corresponds to 1 fcis. each of these fcis i is presented for interpretation to the analyst under a simplified form by removing some of the items that can be deduced from the ontology. in particular if p and q then q=pb is removed from i. for example  if p =   age 뫟1  뫍 p 
q   then  necessarily    which is a redundant piece of information.
the following fci has been extracted from cabamaka:
 
  tumor.tumor. 
curettage=sol mastectomy=sol 
partial-mastectomy-sol radical-mastectomy+sol}
it has been interpreted in the following way: if srce and tgt both represent classes of patients of less than 1 years old  if the difference between srce and tgt lies in the tumor size of the patients-less than 1cm for the ones of srce and more than 1cm for the ones of tgt-and if a partial mastectomy and a curettage of the lymph nodes are proposed for the srce  then sol tgt  is obtained by substituting in sol srce  the partial mastectomy by a radical one.
모it must be noticed that this example has been chosen for its simplicity: other adaptation rules have been extracted that are less easy to understand. more substantial experiments have to be carried out for an effective evaluation.
모the choice of considering every pairs of distinct source cases can be discussed. another version of cabamaka has been tested that considers only similar source cases  as in  hanney and keane  1 : only the pairs of source cases such that |붯 srce1  뫌 붯 srce1 | 뫟 k were considered  experimented with k = 1 to k = 1 . the first experiments have not shown yet any improvements in the results  compared to the version without this constraint  k = +   and involves the necessity to have the threshold k fixed.
1	conclusion and future work
the cabamaka system presented in this paper is inspired by the research of kathleen hanney and mark t. keane  hanney and keane  1  and by the principles of kdd for the purpose of semi-automatic adaptation knowledge acquisition. it reuses an fci extraction tool developed in our team and based on a charm-like algorithm. although implemented for a specific application to breast cancer treatment decision support  it has been designed to be reusable for other cbr applications: only a few modules of cabamaka are dependent on the formalism of the cases and of the domain ontology  and this formalism  owl dl  is a well-known standard.
모one element of future work consists in searching for ways of simplifying the presentation of the numerous extracted fcis to the analyst. this involves an organization of these fcis for the purpose of navigation among them. such an organization can be a hierarchy of fcis according to their specificities or a clustering of the fcis in themes.
모a second piece of future work  still for the purpose of helping the analyst  is to study the algebraic structure of all the possible adaptation rules associated with the operation of composition: r is a composition of r1 and r1 if adapting  srce sol srce   to solve tgt thanks to r gives the same solution sol tgt  as  1  solving a problem pb by adaptation of  srce sol srce   thanks to r1 and  1  solving tgt by adaptation of  pb sol pb   thanks to r1. the idea is to find a smallest family of adaptation rules  f  such that the closure of f under composition contains the sets of the extracted adaptation rules expressed in the form of fcis. it is hoped that f is much smaller than s and so requires less effort from the analyst while corresponding to the same adaptation knowledge.
모another study on aka for our cbr system was aka from experts  based on the analysis of the adaptations performed by the experts . this aka has led to a few adaptation rules and also to adaptation patterns  i.e. general strategies for case-based decision support that are associated with explanations but that need to be instantiated to become operational. a third future work is mixed aka  that is a combined use of the adaptation patterns and of the adaptation rules extracted from cabamaka: the idea is to try to instantiate the former by the latter in order to obtain a set of human-understandable and operational adaptation rules.
