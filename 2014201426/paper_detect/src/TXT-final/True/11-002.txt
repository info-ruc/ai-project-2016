 
       several techniques for use in a stereo vision system are described. these include a stereo camera model solver  a high resolution stereo correlator for producing accurate matches with accuracy and confidence estimates  a search technique for using the correlator to produce a dense sampling of matched points for a pair of pictures  and a ground surface finder for distinguishing the ground from objects  in the resulting three-dimensional data. possible ways of using these techniques in an autonomous vehicle designed to explore its environment are discussed. an example is given showing the detection of objects from a stereo pair of pictures. 
key words: computer vision  stereo vision  matching algorithm  robots. 
introduction 
¡¡¡¡¡¡this paper describes a stereo vision system for use by a computer-controlled vehicle which can move through a cluttered environment  avoid obstacles  navigate to desired locations  and build a description of its environment. one possible application of such a vehicle is in planetary exploration. our experimental vehicle is described in  1 
       as the vehicle moves about  it takes stereo picture pairs from various locations this could be done with two cameras mounted on the vehicle  but with our present vehicle with one camera  it is done with the vehicle at two locations. each of these stereo pairs is processed to extract the needed three-dimensional information  and then this information from different pairs can be combined in further processing. 
       the processing of the stereo pairs is done as follows. first  an interest operator finds small features with high information content in the first picture. then  a binary search correlator finds the corresponding points in the other picture.  the interest operator and the binary search correlator were both developed by moravec  1  next  a high-resolution correlator is given these matched pairs of points. it tries to improve the accuracy of the match  and it produces an accuracy estimate in the form of a two-by-two covariance matrix  and a probability estimate giving the goodness of the match. the coordinates of these matched points are corrected for camera distortion as described by moravec  1 a stereo camera model solver then uses these matched pairs of points to find the five angles that relate the position and orientation of the two camera locations. the accuracy estimates are used by the camera model solver to weight the individual points in the solution and to compute accuracy estimates of the resulting camera model. a dense sampling of points is now matched over the pictures. the known camera model is used to restrict the search for these matches to one dimension  and by first trying matches approximately the same as neighboring points that have already been matched  often no search is needed. in any case  the precise matches are produced by the high-resolution correlator  and its probability estimates are used in guiding the search. 
after these matched points are corrected for camera distortion  distances to the corresponding points in three-dimensional space are computed  using the known camera model. the accuracy estimates of the matches and of the camera model are propagated into accuracy estimates of the computed distances. the three-dimensional information for all of the matched points is now transformed into a coordinate system approximately aligned with the horizontal surface.  the high-resolution correlator  the stereo camera model solver  and the technique for producing the dense sampling of matches are described later in this paper.  
       information from more than one stereo pair can be combined to produce a more complete mapping of points over the area. a ground surface finder is then used to find the ground for portions of the scene  which may be tilted slightly relative to the assumed horizontal coordinate system.  the ground surface finder is described later in this paper.  points which lie sufficiently above the ground surface can be assumed to he on objects.  in the process of finding the ground surface and finding objects  the accuracy and probability estimates are useful.  
stereo camera model solver 
       if the image plane coordinates of several pairs of corresponding points in a stereo pair of images have been measured  it is possible in general to use this information to compute the relative position and orientation of the two cameras  except for a distance scale factor. once this calibration has been performed  the distance to the object point represented by each pair of image points can be computed. 
       a procedure that performs the above stereo camera model calibration by means of a least-squares adjustment has been written. it includes automatic editing to remove wild points  the use of a two-by-two covariance matrix for each point for weighting purposes  estimation of an additional component of variance by examination of the residuals  and propagation of error estimates into the results. 
       consider any point in the three-dimensional scene. let the coordinates of the image of this point in the camera 1 film plane be x1 y1 and the coordinates of its image in the camera 1 film plane be x1 y1. image point x1 y1 corresponds to a ray in space  which  when projected into the camera 1 film plane  becomes a line segment. the distance  in the camera 1 film plane  from image point x1 y1 to the nearest point in this line segment is the magnitude of the error in the matching of this point. this error is a function of the angles which define the relative position and orientation of the two cameras.  these angles are the azimuth and elevation of the position of camera 1 relative to the position of camera 1  and the pan  tilt  and roll of camera 1 relative to the orientation of camera i.  the camera calibration is done by adjusting these angles to minimize the weighted sum of the squares of these errors for all of the points that are used. since the problem is nonlinear  the procedure uses partial derivatives to approximate the problem by the general linear hypothesis model of statistics  and iterates 

v i s i o n - 1 : 	g n n e r y 
1 

to achieve the exact solution. 
¡¡¡¡¡¡the automatic editing is done as follows. first  a weighted least-squares solution as described above is done using all of the points. then the point which has the largest ratio of residual to standard deviation of the residual is found. this point is tentatively rejected  and the solution is recomputed without this point. if this point now disagrees with the new solution by more than three standard deviations  it is permanently rejected  and the entire process repeats. otherwise  the point is reinstated  and the process terminates. however  if an f test comparing the computed and given values of the additional variance of observations shows the solution that includes the point to be bad  the point in question is rejected in any event. 
¡¡¡¡¡¡a more complete description of the camera model solver can be found in . 
high-resolution correlator 
       consider the following problem. a pair of stereo pictures is available. for a given point in picture 1  it is desired to find the corresponding point in picture 1. it will be assumed here that a higher-level process has found a tentative approximate matching point in picture 1  and that there is an area surrounding this point  called the search window  in which the correct matching point can be assumed to lie. a certain area surrounding the given point in picture 1  called the match window  will be used to match against corresponding areas in picture 1  with their centers displaced by various amounts within the search window in order to obtain the best match. 
       thus when the matching process  correlator  is given a point in one picture of a stereo pair and an approximate matching point in the other picture  it produces an improved estimate of the matching point  suppressing the noise as much as possible based on the statistics of the noise. it also produces an estimate of the accuracy of the match in the form of the variances and covariance of the x and y coordinates of the matching point in the second picture  and an estimate of the probability that the match is consistent with the statistics of the noise in the pictures  rather than being an erroneous match. this probability will be useful in guiding a higher-level search needed to produce a dense sampling of matched points. 
       let a1 x.y  represent the brightness values in picture i  a1 x y  represent the brightness values in picture 1  x1 y1 represent the point in picture 1 that we desire to match  x1 y1 represent the center of the search window in picture 1  wm represent the width of the match window  assumed to be square   and wg represent the width of the search window  assumed to be square   where x and y take on only integer values. 
       the following assumptions are made. a1 and a1 consist of the same true brightness values displaced by an unknown amount in x and y  with normally distributed random errors added the errors are uncorrelated with each other  both within a picture  autocorrelation  and between pictures  cross correlation   and the errors are uncorrelated with the true brightness values.  the asuumptions concerning errors hold fairly accurately for the usual noise content of pictures. the assumption concerning the true brightness values will be relaxed slightly below to allow bightness bias and contrast changes. however  another type of change is perspectve distortion  which can be important with large match windows  but it will not be discussed here.  
will produce the best match of a1 x+xm-x1 y+ym-y1  to a1 x.y  in some sense. traditionally the match which maximized the correlation coefficient between aj and a1 has been used  indeed  this is a reasonable thing to do if one of two functions has no noise. however  here both functions have noise. this fact introduces fluctuations in the cross-correlation function which may cause its peak to differ from the expected value. ad hoc smoothing techniques could be used to reduce this effect  but an optimum solution can be derived from the assumed statistics 
of the noise. 
let € represent the wm1 - vector of the differences 
a1 x1xm-x1y+ym-y1  - a1 x y  over the wm by wm match window  for a given trial value of xm ym  and let xc yc represent the true  unknown  value of xm ym. let p represent a probability and p represent a probability density with respect to the vector c. then by bayes' theorem 

if we assume that the ¦Á priori probability p xm.ym=xc yc  is constant over the search window and is zero elsewhere  this reduces to 

where k is any constant of proportionality. since consists of uncorrected normally distributed random variables  

and where €i denotes the components of €  ¦Á1 and ¦Á1 are the standard deviations of a1 and a1  and the product and sum are taken over the match window.   very often  the the variances ¦Á1 and ¦Á1 can be considered to be constant. in this case  the summation can be reduced to the sum of the squares of the differences over the march window  with the sum of the two variances factored out.  thus  

¡¡¡¡¡¡so far  the derivation is quite usual. if we simply wanted to maximize p  for the maximum likelihood solution   we would minimize the above sum  that is  use a weighted least-squares solution . however  because of the fluctations in w caused by the presence of noise in both images  the peak of p in general differs from the center of the distribution of p in a random way due to the random nature of the errors. 
¡¡¡¡¡¡therefore  we define the optimum estimate of the matching position to be the mathematical expectation of xm ym according to the above probability distribution. thus  letting 
 x1'y1  represent this optimum estimate  we have 

¡¡¡¡we temporarily assume that the variance of the errors is known for every point in each picture. 
we now wish to find the matching point xm ym which 
	v i s i o n - 1 : 	gennery 
1 


where the sums are taken over the search window. the variances and covariance of x1 and y1 are given by the second moments of the distribution around the expected values; 

1 he covariance matrix of x1 and y1 consists of and ¦Áx1 and ¦Áy1on the main diagonal and ¦Á xy on both sides off the diagonal. 
       it might appear that the above analysis is not correct because of the fact that certain combinations of errors at each point of each picture are possible for more than one match position  and the probability of these combinations is split up among these match positions however  this fact does not influence the results  as can be seen from the following reasoning the possible errors at each point of each picture form a multidimensional space. when a particular match position is chosen  a lower-dimensioned subspace of this space is selected  in order to be consistent with the measured brightness values when another match is chosen  a different subspace is selected these two subspaces in general intersect  if at all  in a subspace of an even lower number of dimensions. thus the hypervolurne  in the higher subspace  of this lower subspace is zero therefore  the fact that the two subspaces intersect does not change the computed probabilities. 
       now suppose that the standard deviations ¦Á1 and ¦Á1 are not known it is possible to estimate them  actually  the sum of their squares  which is what is needed in the equation for w  from the data if it is assumed that they are constant  that is  the noise does not vary across the pictures let v equal the constant value of ¦Á1 +¦Á1 then €.€/wm1  the mean square value of the 
components of €  is an estimate for v  where   denotes the vector dot product however  this value is different for each possible match position x m  y m . the method used to obtain the best value for v is to average all of these values for v  weighted by the probability for each match position p xrn.yrn=xc=yc i €  = w. thus a preliminary variance estimate is computed by 

where the sums are taken over the search window. however  this averaging process introduces a bias because of the statistical tendency for the smaller values to have the greater weights. it can be shown that this effect causes the estimate of variance to be too small by a ratio that can be anywhere from .1 to i. therefore  an empirically determined approximate correction factor is applied to the variance estimate as follows: 

where u is the minimum value of €.€/wm1over the search window. since the computation of w requires the value of  * v   t n e a d o v c process is iterative. 
       an estimate of an upper limit to the variance is also computed from the high-frequency content of the pictures. first  

then u is averaged over an appropriate local window and the results for the two pictures are added together to form the estimate of the upper limit of v. 
       the overall variance estimate used in the above equations is obtained by an appropriate weighted combination of the a priori given value  the derived value  and the computed upper limit. 
       the probability of a correct match is computed by comparing the derived variance to the a priori variance and the upper limit  high-frequency variance  by means of f-tests. 
       because of the finite window sue  the computed covariance matrix will be an underestimate. an approximate correction for this effect is made by computing the eigenvalues and eigenvectors of the covariance matrix  applying a correction to the eigenvalues  and then reconstructing the covariance matrix from the eigenvalues and eigenvectors. 
       1 he above computations assume that the shift between the two pictures is always an integer number of pixels. in cases where the correlation peak is broad  the smoothing process inherent in the moment computation for x1  y1  ¦Áx1 .¦Áy 1and 
¦Áxy   cause a reasonable interpolation to be performed if the correct answer lies between pixels. however  when the correlation peak is sharp  this will not happen  and the answer will tend towards the nearest pixel to the correct best match. this is not particularly serious insofar as it affects the position estimate  but it can have a serious effect on the probability estimate. this is because the € vector should be much smaller at the correctly interpolated point than it is at the nearest pixel  because of the sharp peak. therefore  the probability may come out much too small  indicating a bad match  whereas the match is really good but lies between pixels to overcome this deficiency  linear interpolation adjustments are made to the variance and probability  and the covariance matrix is augmented to allow for interpolation error. 
       since there may be changes in brightness and contrast between the two pictures of the stereo pair  the correlator can adjust a bias and scale factor relating the brightness values in the two pictures. this requires modifying the mathematics given above instead of actually using the sum of squares of differences ¡Æ€i1if  in the above equations  the moment about the principle axis of the function relating the two sets of brightness values is used. however  the sum of the squares of the differences is still the main ingredient in this computation. included in this computation are a priori weights on the given values of brightness bias and scale factor  contrast . thus the bias and scale factor can be constrained according to the amount of knowledge about them from other sources  if any. 
       as stated above  when the variance is assumed to be constant  a major portion of the computation is the sum of squares of differences €if. this are computed by a very efficiently coded method developed by moravec  1j. its inner loop  each term of the summation  requires about one microsecond on the pdp kl1. 
searching for stereo matches 
¡¡¡¡once the stereo camera model is known  the search for matching points in the two pictures is greatly constrained. a point in picture 1 corresponds to a ray in space  which  when 

projected into picture 1  becomes a line segment terminating at the point corresponding to an infinite distance along the ray. furthermore  by first trying a match with approximately the same stereo disparity as neighboring points that already have been matched  the search can be eliminated for many points. one criterion for deciding when to accept this tentative match is the probability value returned by the high-resolution correlator. also  when a search is made  the likeliest correct match is indicated by the highest probability value. 
¡¡¡¡¡¡the method used here is similar in some ways to matching techniques used by others  for example  quam  and hannah  . however  there is no region growing in the sense of hannah  since the equivalent operations are left until later in the processing. instead  the stereo disparities are allowed to vary in an arbitrary way over the picture  subject to some local constraints discussed later. furthermore  the acceptance of matches is guided by the probability values. also  even in areas of low information content  the noise suppression ability of the high-resolution correlator often allows useful results to be obtained if the content is too low  the correlator indicates this fact by producing very large values for the standard deviations of the two position coordinates. when this happens  the searching can be inhibited to save computer time  but even if this is not done  the results are still as good as the standard deviations indicate.  actually  the correct test to indicate no useful information is to see if both eigenvalues of the covanance matrix are large. both standard deviations might be large  but if only one eigenvalue is large  an accurate distance can still be computed for this point unless the corresponding eigenvector is almost parallel to the projected line segment.  
the method currently used is approximately as follows: 
1. divide picture 1 into square windows  denoted here as  areas   the center of each of which is considered to be a point to be matched to the center of a similar area in picture 1 in the following steps.  these areas normally would be equal in sire to the match window of the high-resolution correlator.  
1. select a set of starting areas.  currently a column near the edge of the picture is used  but this will soon be changed to the points which were produced by the interest operator and binary-search correlator and were not rejected by the camera model solver.  
1. try areas adjacent  including diagonally adjacent  to areas already tried  where possible working in the direction of the projected line segments in picture 1 towards the infinity points. 
1 if there are at least two already matched areas adjacent to the area in question and the disparities of all adjacent matched areas agree within a tolerance  apply the high-resolution correlator with the search window centered on the position corresponding to the average disparity of these neighbors. otherwise  go to 1. 
1. if the probability returned by the correlator in step 1 is greater than 1  accept this match and go to 1. 
1. starting at the infinity point  search along the projected line segment in picture 1  applying the search window of the high-resolution correlator at points with a spacing of half of the search window width  but not at previously matched areas. 
1. of those matches found in step 1  select the one for which the correlator returned the highest probability. if this probability is greater than 1 and at least one neighboring area  including these tentative matches  agrees in disparity and has a probability greater than 1  or vice versa  accept this match. otherwise  of those matches found in step 1 with probability greater then 1  if any  accept the one whose disparity agrees most closely with its neighbors  if within the tolerance. 
1. when the current group of areas being tried is exhausted  go 
to 1. if there are no areas left  finish. 
       some improvements can be made to this algorithm in the future. for example  another pass can be made over the data to clean things up  utilizing the fact that most areas have more matched neighbors than they did when things were progressing in a basically one-directional manner. another possibility is to change step 1 in the following way. the best match from those found in step 1 would not be selected immediately. instead  all of the potential matches with sufficiently high probability would be saved until the entire picture had been processed. then a cooperative algorithm similar to that discussed by marr and poggio  could be used to choose the best matches. this should produce more reliable matches  but with a large increase in computation time. 
ground surface finder 
       once the three-dimensional positions of a large number of points in an outdoor scene have been determined  it is desired to determine which points are on the ground and which are on objects above the ground. by taking a sufficiently small portion of the scene the ground can be approximated by a simple surface whose equation can be determined  and the points which he above this surface by more than an appropriate tolerance can be assumed to be on objects above the ground. 
       such a procedure has been written  which assumes in general that the ground surface is a two-dimensional second degree polynomial. however  weights can be given to a priori values of the polynomial coefficients  to incorporate any existing knowledge about the ground surface into the solution. for example  the second degree terms can be weighted out of the solution altogether  so that the ground surface reduces to a plane 
       to determine a ground surface from a given set of data  a 
       set of criteria which define what is meant by a good ground surface is needed. these include the number of points within tolerance of the surface  the more the better   the number of points which lie beyond tolerance below the surface  the fewer the better  since these would be due to errors such as mismatched points in a stereo pair   and the closeness of the surface coefficients to the a priori values. note that the number of points above the surface does not matter  other than that it detracts from the number within the surface   because many points can be on objects above the ground. a score for any tentative solution is computed based on these criteria  and the solution with the highest score is assumed to be correct  although a solution with a lower score can be selected by a higher level procedure using more global criteria the scoring function currently used is 

where n is the number of points within tolerance of the surface  these points were used to determine the surface by a least-squares fit   n ishe a priori expected number of points in the surface  b is the number of points below the surface by more than the tolerance  b is the a priori approximate maximum number of points below the surface  the c i are the coefficients of the fitted surface  c i a r e their a priori v a l u e s   ¦Á i are the standard deviations of these a priori values  and m is the number of these coefficients which were adjusted. 
v i s i o n - 1 : e n n o r v 
1        finding the best solution  according to the scoring function  out of all of the possible solutions is a search problem. what is needed is a method which will be likely to find the correct solution without requiring huge amounts of computer time. the method used uses some heuristics to lead the search 
to the desired solution. its main points can be described briefly as follows. 
¡¡¡¡¡¡first  a least-squares solution is done using; all of the points this fit is saved for refinement leading to one tentative solution. then all points within tolerance of this fit or too low  but not less than half of the points used in this fit  are selected  and another least-squares fit is done on these points and saved. this process repeats until there are too few points left.  this portion of the algorithm drives downward to find the low surfaces  even though there may a large amount of clutter above them.  
¡¡¡¡¡¡the refinement of each of the above fits is done as follows. the standard deviation of the points used in the fit about the fitted surface is computed. then all points within one standard deviation  or within the original tolerance  of the surface are used in a new least-squares fit. this process continues until it stabilizes  in which case the score of the result is computed  or until there are too few points in the solution.  this portion of the algorithm rejects erroneous points and some clutter  in order to find well-defined surfaces.  
results 
¡¡¡¡¡¡figure i shows a stereo pair of photographs taken from positions approximately 1 feet apart in a parking lot. each digitized picture is 1 pixels wide and 1 pixels high. 
¡¡¡¡¡¡figure 1 shows the points found in the left picture by the interest operator and the corresponding points  using the same arbitrary symbols  matched in the right picture by the binary search correlator. the points encircled were rejected because of low probability   1  estimated by the high-resolution correlator. the points in squares were rejected by the editing in the camera model solver. the remaining points then determined the camera model solution. 
¡¡¡¡¡¡figure 1 shows the matches produced by the searching algorithm  constrained by this camera model  using the high resolution correlator  with eight-by-eight windows . notice that the algorithm made several incorrect matches  particularly in the left foreground. this is a result of the fact that there was very little contrast in the texture on the pavement  resulting in a low signalto-noise ratio nevertheless  there are a sufficient number of correct matches so that the later stages of processing are not bothered by these errors. 
¡¡¡¡¡¡the left side of figure 1 shows the component of distance  in feet  parallel to the optical axis  computed from the matches for all points that the algorithm matched  superimposed on the left picture.  single characters are use for these plots  with 1 through 1  a through b  and a through b representing 1 through 1. the number sign represents values from 1 to 1  and the infinity symbol represents everything greater than 1. the right side of figure 1 shows the relative standard deviation computed for these points  to the nearest foot  the relative standard deviation indicates only those errors which tend to differ for nearby points. the total standard deviation is larger and indicates the absolute accuracy of the distances.  
¡¡¡¡¡¡figure 1 shows the results of transforming the three-dimensional information represented by the distances into an approximately horizontal coordinate system. the camera 1 position is at the bottom center of the figure  looking towards the top plotted are the heights above the reference plane in feet  using the single characters described above. 
¡¡¡¡¡¡the portion of the data between ranges of 1 feet and 1 feet was given to the ground surface finder. the heights of these points above the resulting plane are shown in figure 1. 
figure 1 is the same as figure 1  except that it shows only 
those points with a height of at least two feet. the points above this threshold are on the two vehicles in the pictures  the light poles  and some shrubbery near the light poles  with a few error points. 
future plans 
¡¡¡¡¡¡it is planned to use the stereo system in a system for operating an experimental exploring vehicle. stereo pairs will be taken from various locations and their results will be combined. points which lie sufficiently above the ground will be clustered into individual objects  and simple size and shape information will be computed for each object. a data structure 
containing a catalogue of objects  with their locations  sizes  and shapes  and properties of the ground  will be built up as the vehicle moves through its environment. by comparing this information to older portions of the data structure  the vehicle 
can determine if it is in a previously seen area. 
¡¡¡¡¡¡there are several opportunties for the previously described components of the system to cooperate and to pass information back and forth. for example  the high-resolution correlator has several parameters used to give it a priori information on the noise level in the data and changes in brightness and contrast between the two pictures. it also produces a posteriori estimates of these quantities. these results from early applications of the correlator  for example with the points used to obtain the camera model and not rejected by the camera model solver  can given to the correlator in later applications. also  when the ground surface finder is given points from a certain portion of the scene  it can be given a priori values and weights for the surface  which can be obtained from ground surface solutions for adjacent areas. furthermore  if its apparently best solution does not agree with those of adjacent areas  an alternate solution from the ground surface finder can be used which agrees better with neighboring areas  even though it may not be as good according to local criteria. all of these features may be implemented in the future. 
¡¡¡¡¡¡other possibilities include an automatic segmenter to produce regions of complicated terrain for the ground surface finder to work on  and the addition of a priori knowledge about the environment  including models of objects expected. 
acknowledgements 
¡¡¡¡¡¡the research described herein was performed at the stanford artificial inteliigence laboratory under nasa contract nasw-1 and the advanced research projects agency order 1 contract mda1-c-1. 
