 
     the hough transformation can detect s t r a i g h t lines in an edge-enhanced p i c t u r e ; however  i t s extension to recover e l l i p s e s requires too much computing time. this paper proposes a modified method which u t i l i z e s two properties of an e l l i p s e in such a way that it i t e r a t i v e l y searches for clusters in two d i f ferent parameter spaces to f i n d v i s i b l e e l l i p s e s   then evaluates t h e i r parameters by the least means squares method. 
introduction 
     analysis of a scene containing many complicated-shaped objects is a current problem of computer v i s i o n . since the usual l i n e finders f a i l to extract a r e l i a b l e l i n e drawing from the scene  falk and g r i f f i t h have proposed methods which i d e n t i f y each object in a blocks world by u t i l i z i n g input data and ext e r n a l constraints so as to suggest and test hypotheses on the scene  falk 1     g r i f f i t h 1 . in order for a computer vision system to analyze more complex pictures containing r e a l objects such as telephones  cups  or i n d u s t r i a l p a r t s   t h e i r h e u r i s t i c s have been modified as follows:  1  search for simple f a m i l i a r patterns such as polygons and ellipses in strong feature points in the p i c t u r e s    1  select models of objects whose features contain these patterns   1  t e s t the v a l i d i t y of the models by examining whether weak feature points around the patterns s a t i s f y the proposed models  tsuji 1 . 
     line f i n d i n g methods u t i l i z i n g the hough transformation are useful to f i n d polygons  especially p a r t l y occuluded ones  because they u t i l i z e global properties of edge points  hough 1   duda 
1       g r i f f i t h 1   o'gorman 1 . duda and hart also discussed p o s s i b i l i t i e s of extending t h e i r methods to f i n d curves in the picture  duda 1   and shapiro analyzed the performance of the t r a n s f o r -
mation method to detect curves in noisy pictures  shapiro 1 . direct applicat i o n of the parameterization  however  is l i m i t e d to curves w i t h a small number of parameters  say two or three at most  
this work was supported in part by grandin-aid for s c i e n t i f i c research from the ministry of education  japanese government. 
since necessary memory space and computing time grow exponentially with the number of parameters. for example  det e c t i o n of c i r c l e s requires a threedimensional array of accumulators  and a modification of the algorithm is necessary to recover the c i r c u l a r arcs in a reasonable time  kimme 1 . 
     this paper describes how we can modify the paramerization technique so as to recover both l i n e a r and e l l i p t i c edges  which are important cues for analyzing scenes containing a r t i f i c i a l l y constructed objects. we can easily detect and erase long s t r a i g h t lines in an edgeenhanced p i c t u r e ; then the problem is how to e f f i c i e n t l y detect e l l i p s e s  each of 
which has f i v e unknown parameters  in a 
set of feature points on curved or short linear segments. instead of u t i l i z i n g a five-dimensional array of accumulators  we sequentially search for clusters in two d i f f e r e n t parameter spaces; one for finding the approximate positions of centers of e l l i p s e s and selecting candidate feature points for an easily detectable e l l i p s e   and the other for t e s t i n g 
whether the candidates are exactly on the ellipses or not. there e x i s t interactions between d i f f e r e n t patterns when one maps edge points i n t o the parameter spaces. as the r e s u l t   e l l i p s e s w i t h many edge elements sometimes mask weak clusters corresponding to other e l l i p s e s . therefore  the computer v i s i o n system i t e r a t i v e l y searches for an easily v i s i b l e e l l i p s e in a set of feature points in an edge-enhanced picture from which edge points of the recovered long s t r a i g h t lines and e l lipses have been erased. 
detection of ellipses 
     the d i r e c t application of the hough transformation to the detection of e l l i p t i c objects in a d i g i t i z e d picture r e quires a five-dimensional array of accumul a t o r s ; the array is indexed by f i v e para-
meters specifying the l o c a t i o n   shape  and o r i e n t a t i o n of an e l l i p s e . i t s usuage  however  is impractical because of excessing computing time. an idea for overcoming the d i f f i c u l t y is as f o l l o w s : instead of the time consuming process of mapping each edge point in the picture i n t o the five-dimensional parameter space  
we sequentially examine clusters in both a two-dimensional and a one-dimensional space  by u t i l i z i n g two w e l l known properties of an e l l i p s e   and e f f i c i e n t l y 

vision-1: 	tsuji 1 

select a small number of candidate edge points for an easily visible ellipse. next  the five unknown parameters of the best fitting ellipse to the candidates are evaluated by the least mean squares method. 
erasing long straight lines in edgeenhanced picture 
     we preprocess a digitized input picture to find edge points by applying a simple gradient operator to every point in the picture and thresholding i t   and 
we thus obtain an edge-enhanced picture e in which each edge element is characterized by its location  x y  and quantized direction 1 which ranges between 1¡ã and 1¡ã  the distinctness of the edge point is not used in the following process . next  the edge points are arranged in a set {e } of edge lists: the edge list e¦È is a collection of edge points of a direction ¦È. now the line finding method  1'gorman 1  detects sets of collinear edge points in e and registers them in a 
list of straight lines  however some of them may belong to ellipses. straight lines longer than a threshold are considered not to be parts of the elliptic arcs  and their edge points are erased from e and {e } in order to simplify the following algorithm for detecting ellipses. 
detection of centers of ellipses 
     let us consider two parallel tangents at p and q to an ellipse  see fig.l  a  . a simple property  namely that p and q are at equal distance from the center 1 of the ellipse  is useful for finding locations of ellipses in e by a twodimensional accumulator array {a }; the array is indexed two parameters x y  x y  specifying the location of an ellipse. for each pair of edge points  x  y-  and  x1 y1  in an edge list e  a collection of edge points having an orientation e   an accumulator at   x +x1 /1  y +y  /1  is incremented by one. after all pairs of the set {eq  are processed in this way  the array is locally averaged by using a 1 neighborhood. thus  the accumulator corresponding to the center of a complete ellipse has a count approximately proportional to the length of its circumference. 
     now  we search for the accumulator a with the highest count  whose indices specify the location of the center of an easily visible ellipse  or concentric ellipses   and then select all pairs of edge elements which increased a in the above-mentioned process  as m n candidates for the ellipse. the process of erasing long straight lines is necessary before applying this center-finding algorithm because two parallel lines generate a mountain ridge  considerably dis-

fig.l two properties of an ellipse. 
 a  op=oq  if two tangents are parallel. 
 b   l/op1 + l/oq1 =l/r1=constant  if /poq=1¡ã 
turbing the peak-finding process  in the array. 
testing candidates for the ellipse and evaluation of its parameters 
     let c be the set of the selected candidates for the ellipse. the above-mentioned center-finding procedure simply collects edge points such that they are on symmetrical curved or linear segments to the point  m n  in e; therefore a member in c is not always on an ellipse. application of the least mean squares method to fitting an ellipse to c is likely to give an unsatisfiable result  especially when there exist concentric ellipses  because the fitting process is significantly disturbed by the symmetrical patterns not on one ellipse. thus we must select from the candidates the edge points which lie exactly on an ellipse by utilizing a property of an ellipse  and then apply the fitting process for evaluating accurate parameters. 
vision-1: tsuji 1      consider two points p and q on an ellipse such that /poq=1¡ã  where 1 is the center of the e l l i p s e  see f i g   1   b     . it is easy to prove the property that 

	= constant 	 1  
for an e l l i p s e . 
     now  a one-dimensional accumulator array { a . } is used to test the candidates. ' we assume that 1 is located at  m n  obtained by the center-finding algorithm. if any two points p and q in c s a t i s f y /poq=1¡ã+ 1   1 is a threshold value   then the  accumulator corresponding to r evaluated by  1  is incremented by one. after processing a l l members in c in t h i s way  we obtain a histogram of r  which gives us v a l u able information on e l l i p s e s in c ; mult i p l e prominent peaks in it suggest the existence of concentric e l l i p s e s in c  however the number of the e l l i p s e s is less than that of the peaks in most cases   or we would decide that there is no v i s i b l e e l l i p s e in c   if the h i s t o gram contains only low h i l l s . 
     mutual interactions between edge points on the concentric e l l i p s e s generate s i g n i f i c a n t false peaks in the histogram  sometimes higher than the peaks corresponding to true e l l i p s e s . the smallest e l l i p s e in c is examined f i r s t   because the count in the accumul a t o r corresponding to it is less sensit i v e to t h i s interference. we select a l l pairs of edge p o i n t s   contributing to the leftmost peak in the histogram  and then evaluate f i v e parameters of the best f i t t i n g e l l i p s e to these edge points by the least mean squares method. the f i t t i n g process is judged to be a f a i l u r e if the edge points in e cover only a small f r a c t i o n of t h i s e l l i p s e . otherwise  it is considered a success  and the edge points on the recovered e l l i p s e are excluded from e  c and {e   in order to eliminate t h e i r i n t e r a c t i o n 
with other e l l i p s e s . the candidatet e s t i n g process is i t e r a t e d by calcul a t i n g a new histogam of r in updated c and examining the leftmost peak in i t   u n t i l the histogram does not contain any prominent peak. 
     the above-mentioned procedure for t e s t i n g candidates is i t e r a t i v e l y app l i e d to a l l prominent clusters in the two-dimensional accumulator array to r e cover a l l v i s i b l e e l l i p s e s in the p i c ture. f i n a l l y   we t e s t whether each short l i n e i n the l i s t o f s t r a i g h t lines belongs to the recovered e l l i p s e s or not. since the edge points on these e l lipses have been excluded from the updated edge-enhanced picture e   we d i s card the l i n e from the l i s t if the edge points s t i l l remaining in e are not or sparsely d i s t r i b u t e d on the l i n e ; other-
wise it q u a l i f i e s for a s t r a i g h t l i n e . 
experimental results 
     the following example shows some of the features of the e l l i p s e - f i n d i n g a l gorithm. fig.1  a  shows a 1 d i g i t i z e d picture w i t h 1 gray l e v e l s   which contains three parts of a gasoline engine; two c y l i n d r i c a l parts and a rod. a simple gradient operator using a 1 window  1'gorman 1  with a noise threshold of 1 is applied to obtain an edge-enhanced p i c t u r e . fig.1  b  shows the r e s u l t   which contains 1 edge p o i n t s . 

fig.1 	input p i c t u r e . 
 a  a 1 by 1 d i g i t i z e d p i c t u r e   containing three i n d u s t r i a l parts.  b  an edge-enhanced picture of  a . 
setting the quantization step of 1 at 1¡ã  we c l a s s i f y the edge points i n t o 1 groups  edge l i s t s   . at t h i s p o i n t   the l i n e f i n d i n g algorithm is applied  and a l l l i n e a r segments are detected. 

vision-1: tsuj' 1 

¡¡¡¡after a l l pairs of edge points  which contributed to the highest  left  peak in fig.1  are selected as candidates for ellipses  we apply to them the candidatetesting algorithm  whose f i r s t step is to calculate the histogram of r of the candidates. the result is illustrated in fig.1  a . since the number of edge points on an ellipse depends on the size of the ellipse  it seems reasonable to use a threshold function which is proportional to r  for suppressing noises in the histogram  and 1r is used in this experiment. after application of this threshold function  a peak finder detects the single prominent peak in fig.1  a   and then the least mean squares method can easily f i t s e l l i p t i c arcs to the edge fig.1 contents of the one-dimensional array of accumulators. 
 a  histogram of r for the cluster of the l e f t peak in fig.1. 
 b  histogram of r for the cluster of the right peak in fig.1. 
 c  histogram of r after erasing the edge points on the ellipse corresponding to the leftmost peak in 
vision-1: tsuj! 1  b . 
points of the peak. selection of another threshold function w i t h a smaller coeff i c i e n t does not influence the f i n a l l y obtained e l l i p s e s   but much computing time is wasted by processing low peaks and r e j e c t i n g them as noise. 
     fig.1  b  shows another histogram of r  obtained for the second peak in f i g . 1   in which we can observe three prominent peaks and a medium peak. edge points c o n t r i b u t i n g to the l e f t peak are selected as q u a l i f i e d members for the smallest e l lipse in c  and then the least mean squares method f i t s an e l l i p s e to them  
which corresponds to the inner e l l i p s e on the c y l i n d r i c a l part at the r i g h t side in the input p i c t u r e . erasing the edge points on that e l l i p s e from the set c of candidates  we again calculate a new h i s togram of r. the r e s u l t  fig.1 c   imp l i e s t h a t the second peak in fig.1  b  is a false one  generated by the i n t e r a c t i o n of the recovered e l l i p s e w i t h the other  because the peak disappears as a r e s u l t of erasing the edge points c o n t r i buting to the adjacent peak. since the l e f t peak in the new histogram happens to be lower than the threshold function of 1r  we examine the r i g h t peak and detect the outer e l l i p s e on the r i g h t p a r t . if a lower threshold function  say 1r  is used  then the l e f t peak which corresponds to the e l l i p t i c arcs between the two e l lipses is examined  but the peak is judged to be a false one because the edge points in e cover only a small f r a c t i o n of e l lipses evaluated by the least mean squares 
method. f i n a l l y   the linear segments  which are judged as parts of the recovered e l l i p s e s   are discarded from the l i s t of l i n e s   and we obtain the r e s u l t displayed i n f i g . 1 . 
     the procedure is programmed in fortran  and the t o t a l computing time on a m i n i computer pdp1/e  1kw of core memory  1kbytes of buffer memory  and 1mw disk memory  is about 1 min 1 sec; 1 min 1 

fig.1 detected l i n e a r and e l l i p t i c edges. sec for calculating the gradients and storing them in the disk  1 min 1 sec for detecting the l i n e a r segments  and 1 min 1 sec for recovering the e l l i p s e s and evaluating t h e i r parameters. this computing time seems rather long; however  we pay more a t t e n t i o n to the r a t i o of the time for recovering the e l l i p s e s to that for recovering the s t r a i g h t l i n e s   since the computing time depends on the a b i l i t y of the computer used. the r a t i o 1 for our example seems to be acceptable when we consider the complexity of the shapes of e l l i p s e s . 
discussion 
     the proposed method seems to be s a t i s factory for extracting the global features of the a r t i f i c i a l l y constructed objects. although it can detect some of p a r t i a l l y hidden e l l i p s e s   such as the e l l i p t i c arcs on the object at the l e f t side in f i g . 1   there are many counterexamples. a p a r t i a l l y obscured e l l i p s e is not detectable if it contains a less number of edge points symmetrical to the center of the e l l i p s e than the threshold for f i n d i n g peaks in the two-dimensional array. setting the threshold at a lower l e v e l is not e f f e c t i v e   because it can add few e l lipses to the r e s u l t while much computing time is wasted by examining a large number of weak clusters in the array. an example of another class of undetected e l l i p s e s is shown in f i g . 1 . we can recover a c l u s t e r corresponding to the center of the e l l i p s e ; however  the number of the edge 
points which have partners mapped together 
in the one-dimensional accumulator array is very small  so that the method misperceives the e l l i p t i c arcs as noise. 
     another d i f f i c u l t y arises when we apply the method to a p i c t u r e containing very large or highly concentric e l l i p s e s . f l a t portions of the e l l i p s e s are erased 

v!s!on-1: 	tsuji 1 fig.1 an example of e l l i p t i c arcs cont a i n i n g few pairs of edge points mapped in the histogram of r. 
from the edge-enhanced picture before applying the ellipse-finding algorithm  because they satisfy the conditions for the long straight lines. however  the other parts of the ellipses are generally detected as sets of e l l i p t i c arcs  therefore we could improve the method by adding a function for finding straight lines which connect these e l l i p t i c arcs  and then f i t t i n g again an ellipse to the edge points on them. 
     finally  let us briefly study on the computation required for detecting e l lipses using the approach of duda and hart  who have shown that the computation required for obtaining lines increases with the number of edge points in the picture  duda 1 . suppose that the enhanced picture e has n edge points after erasing the long straight lines from i t . if we detect ellipses by searching the five-dimensional parameter space for clusters  then the computation required for mapping each edge element into the space is proportional to dh  where d is the number of quantization of a parameter. thus  the computation required for detecting ellipses is proportional to nd1. the computing time of the proposed method is spent in searching the two parameter spaces and evaluating parameters of the ellipses. if the distribution of the directions of edges is uniform in  1¡ã 1¡ã    then an edge l i s t has n/d¦Èelements  where d¦È is the number of quantization of 1. therefore  n1d¦È1 pairs of each edge l i s t are mapped in the two-dimensional array  and the total number of mapping parallel edge elements is n1d¦È . in order to obtain edge elements contributing to the prominent peaks  this mapping process is repeated again  thus time t1 for the center-finding process is approximately proportional to n1/d¦È on the other hand  mapping into the one-dimenaional space and evaluating parameters is done on much smaller numbers of candidates than n; thus the ratio of the computing time t1 of this process to t1 w i l l become very small for large n. 
     when we simply compare n1/d¦È with nd1¦È superiority of the proposed method over the direct application of parametrization is apparent. however  pictures with many edge points requires too much computing time  so that we must make n as small as possible. one idea for decreasing n is to apply a thinning operator to the edgeenhanced picture before mapping into the parameter spaces. 
falk g.   interpretation of imperfect data as a three dimensional scene   a r t i f i c i a l intelligence  vol.1  pplol1  no.1  1. 
g r i f f i t h a. k.   edge detection in simple scene using a p r i o r i information   ieee trans. comput.  vol.c-1  pp1  no.1  1. 
hough p. v. c   method and means for recognizing complex patterns   u.s. patent 1 1  dec  1. 
kimme c  ballard d. and sklansky j .    finding circles by an array of accumulators   commus. ass. comput.  vol.1  ppl1  feb.  1. 
o'gorman f. and clowes m. b.   finding picture edges through collinearity of feature points   ieee trans. comput.  vol.c-1  pp1  apr.  1. 
shapiro d. s.   transformation for the computer detection of curves in noisy pictures   computer graphics and image processing  vol.1  pp1  1. 
tsuji s. and nakamura a.   recognition of an object in a stack of industrial parts   proc. of 1th ijcai  pp1  1. 

