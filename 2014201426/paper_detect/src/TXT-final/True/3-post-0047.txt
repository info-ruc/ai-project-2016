
this paper proposes a rule language for defining social expectations based on a metric interval temporal logic with past and future modalities and a current-time binding operator. an algorithm for run-time monitoring compliance of rules in this language based on formula progression is also outlined.
1 introduction
the study of electronic institutions-explicit declarative models of the rules governing particular open systems of autonomous agents-has gained much recent attention  cortes 뫣 1 . there has been a significant amount of research on statically verifying properties of institutions as well as interpreting institutions to manage or guide agent interaction. however  there has been little attention paid to mechanisms for run-time compliance checking  i.e. monitoring events in a running agent system  determining the future expectations of agents' behaviour according to norms of the institution  and checking if these are fulfilled or violated. this paper focuses on this issue by presenting  i  a logic named hymitl that combines ctl  verdicchio and colombetti  1  with metric interval temporal logic  mitl   alur et al.  1   as well as features of hybrid logics  blackburn et al.  1   and  ii  a subset of hymitl that provides a rule language for defining social expectations. we have implemented an algorithm for monitoring social expectations encoded in this language  based on the technique of formula progression from the planning system tlplan  bacchus and kabanza  1 .
1 syntax of hymitl
the syntax of hymitl is defined as follows:
뷋 ::= p |  뷋 | 뷋 뫇 뷋 |  x.뷋x | x+뷋 | x 뷋 | 뷋u+i 뷋 | 뷋u i 뷋 | a뷋 | e뷋 | 뫻ux.뷋x | i
i ::=    +  |  b b  |  b b  |  b b  |  b b  b ::= a | +d |  d
where
  p is an atomic formula from a first order language l.
  뷋x denotes a formula 뷋 in which variable x is free  i.e. not bound by   or 뫻 .
  a and d are terms  possibly containing variables  that denote  respectively  absolute points in time and durations  e.g. using the language proposed by verdicchio and colombetti  .
  u is a unit selector on the 뫻 binding operator  referring to the desired granularity of time  e.g. year or minute  for binding x to the current time  with default value now .
we constrain the use of variables within interval bounds b: any such variables must be bound by an enclosing 뫻 operator. in this logic  the temporal operators x+ and x  mean  in the next state  and  in the previous state  respectively. 뷋u+i 뷍 asserts that 뷋 will remain true from the current state for some  possibly empty  sequence of consecutive future states  followed by a state that is within the time interval i and for which 뷍 holds. x  and u i are defined similarly  but in the past direction.
모the bounds of intervals can be specified either relatively or absolutely-a prefix of  +  or     indicates a relative time value. when qualifying u   the interval bounds are written in the reverse order from usual  e.g.   1 hours  1 hours .
모a and e are temporal path quantifiers. they assert that the formula that follows the operator applies to all  or respectively at least one  of the possible sequences of states passing through the current state.
모the 뫻 operator is based on the  binder  operator used in hybrid logics  blackburn et al.  1 . it binds a variable to a term denoting the current date/time  possibly 'rounded down' to a particular degree of precision  e.g. to the start of the current year  month or day  depending on the unit indicated by the superscript u.
모we use the usual derived operators of first order predicate logic  as well as the standard abbreviations for existential and universal quantification over states in a path: f+i 뷋 뫖 true u+i 뷋 and g  with similar definitions for
f i and g i . we define future and past  weak until  operators in the following way:

with similar definitions for intervals with open bounds and for w .
ag+  done c  makepayment c p amount prodnum   뫇  t  t +1week  뫸
뫻weekw.   f   1 w done p  sendreport c prod  w+1week done p  sendreport c prodnum w   
w+ +1  w+1weeks 
done c  cancelorder c p prodnum   
figure 1: a rule expressing the terms of service offered by agent p1 the rule language
we identify a subset of hymitl that is suitable for encoding social expectations in a form that can be used in run-time compliance testing: the set of all formulae of the following form:
               ag+  1뫞i뫞nxi. 뷋 뫸 뷍  for n뫟1  where 뷋 and 뷍 are linear-time formulae  i.e. they do not contain a or e   the free variables of 뷋 and 뷍 are precisely the quantified variables {x1 ... xn}  뷋 and 뷍 do not contain any occurrences of    and any occurrence of   must be of a certain restricted form that is equivalent to tlplan's bounded existential quantification  bacchus and kabanza  1 .
모figure 1 shows an example rule encoding a service offer by an agent p that can provide weekly reports on a particular market for an annual fee. this rule states that once payment of the required amount is made by the potential client c within the validity period of the offer  one week   the serviceproviding agent is committed to sending a report to the client once a week for 1 weeks or until the client cancels the order.
1 the compliance monitoring process
rules in our language are intended to be used in the following compliance-testing process:
given a current state and the history of all prior states and their associated times  for each rule  match the left hand side against the current state and history  resulting in a set of instances of the right hand side. add these instances to the set of current expectations  then check all expectations to see which are fulfilled or violated. any expectations that cannot yet be evaluated because they involve future states are 'progressed' to the next state when it is created by an event observation.
모the progression of unfulfilled expectations from one state to the next uses a modified version of the progression algorithm of bacchus and kabanza . this algorithm generates a formula expressing what needs to be true in the new state if the input expectation was required to be true in the previous state  but was not yet able to be evaluated there.
모once new expectations have been computed by matching the rules to the current state and history  each formula in the combined set of old and new expectations is partially evaluated  resulting in true or false if the truth of the formula can be determined yet  and otherwise returning a formula equivalent to the original one  given the facts in the history states   but modified where possible to make progression and future evaluation easier. this partial evaluation is separated out from the progression step as it is performed in the current state- before a new state is created by a new event occurrence  and therefore before formula progression can be done  this needs the time difference between the old and new state as an input .
1 conclusion
this paper has defined a rule language for defining social expectations based on a metric interval temporal logic and has outlined an algorithm that can be used at run time in a multiagent system to monitor when expectations are generated  fulfilled and violated. a prototype implementation of the compliance testing algorithm has been implemented using swi prolog. most of the features described here have been implemented  although currently the system is not connected to an agent-it uses a static database of states and their facts-and integers are used to represent times.
모the semantics for hymitl  the algorithms used  a discussion of related work and future extensions to this work  and acknowledgements can be found in the full version of this paper  cranefield  1 .
