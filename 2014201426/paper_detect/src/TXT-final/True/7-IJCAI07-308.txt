
the martingale framework for detecting changes in data stream  currently only applicable to labeled data  is extended here to unlabeled data using clustering concept. the one-pass incremental changedetection algorithm  i  does not require a sliding window on the data stream   ii  does not require monitoring the performance of the clustering algorithm as data points are streaming  and  iii  works well for high-dimensional data streams. to enhance the performance of the martingale change detection method  the multiple martingale test method using multiple views is proposed. experimental results show  i  the feasibility of the martingale method for detecting changes in unlabeled data streams  and  ii  the multiple-martingale test method compares favorably with alternative methods using the recall and precision measures for the video-shot change detection problem.
1	introduction
the problem of detecting changes in low-dimensional sequential data has been studied by statisticians for more than fifty years. methods of change detection first appeared in the 1s based on wald's sequential analysis  wald  1   in particular the sequential probability sequential test  sprt   basseville and nikiforov  1   and later  page introduced the cumulative sum method  page  1 . recently  the machine learning and the data mining communities become interested in the change detection problem due to the need to discover changes in data  such as customer click streams  high-dimensional multimedia data  and retail chain transactions  generated from online processes that are not stationary  domingos and hulten  1 . the target concepts change over time. it is  hence  vital to detect the changes in the data generating processes so that timely decisions can be made.
¡¡one real-world problem that requires detecting changes is the video segmentation problem which corresponds to videoshot change or video break detection. many algorithms  gargi et al.  1; lefevre et al.  1; zhai and shah  1  have been proposed to perform video-shot change detection. the range of existing methods includes pixel and histogrambased difference methods and motion-based methods  e.g. optical flow . threshold selection  a critical step for successful change detection  is required by methods using global or local thresholds. for video sequences with clear and distinct shots  a single global threshold would be sufficient. for video sequences that have both abrupt and gradual changes between shots  however  a global threshold cannot be found. to address such concerns  gargi et al.  1  argued for the use of local thresholds. the use of local thresholds requires choosing appropriate window size. alternatively  zhai and shah  zhai and shah  1  proposed that video breaks should be detected using the deviation from some current model.
¡¡recently   ho  1  proposed a martingale method for change detection for high-dimensional labeled data streams. an adaptive support vector machine for time-varying data streams was proposed based on the martingale method  ho and wechsler  1a . the main contributions of the present paper are:  i  the extension of the martingale methodology to unlabeled data stream  and  ii  the multiple-martingale test based on multiple views  features . we show empirically that the martingale method works well for unlabeled data stream and the multiple-martingale test compares favorably with alternative video-shot change detection methods for unlabeled video stream.
¡¡the paper is organized as follows. in section 1  we review the concept of exchangeability and martingale. in section 1  we introduce the concept of strangeness and p-values  and propose the strangeness measure for unlabeled data using clustering concept. in section 1  we state the theorem on the martingale method for change detection which is applicable to both labeled and unlabeled data stream. in section 1  we show the feasibility of the martingale method for change detection on an unlabeled synthetic data stream. in section 1  we propose the multiple-martingale test for change detection. in section 1  we apply the multiple-martingale test to video-shot change detection.
1	exchangeability and martingale
let {zi : 1 ¡Ü i   ¡Þ} be a sequence of random variables. a finite sequence of random variables z1 ¡¤¡¤¡¤ zi is exchangeable if the joint distribution p z1 ¡¤¡¤¡¤ zi  is invariant under any permutation of the indices of the random variables. the satisfaction of exchangeability condition indicates that the distribution that the sequence of random variables is drawn from is stationary.
¡¡ vovk et al.  1  introduced the idea of testing exchangeability online using the martingale. a martingale is a sequence of random variables {mi : 1 ¡Ü i   ¡Þ} such that mn is a measurable function of z1 ¡¤¡¤¡¤ zn for all n = 1 ¡¤¡¤¡¤
 in particular  m1 is a constant value  and the conditional expectation of mn+1 given m1 ¡¤¡¤¡¤ mn is equal to mn  i.e.
	e mn+1|m1 ¡¤¡¤¡¤ mn  = mn	 1 
after each new data point is received  an observer outputs a positive martingale value reflecting the strength of evidence found against the null hypothesis of data exchangeability. the testing of exchangeability is used to detect changes in timevarying labeled data streams  ho and wechsler  1b .
1	strangeness and p-values
to apply the martingale method one needs to rank the data points according to their differences. towards that end  one defines a strangeness measure that scores how much a data point is different from the other data points. consider the set of labeled data points z = {z1 ¡¤¡¤¡¤ zn 1} and the new labeled data point zn. each data point is assigned a strangeness value based on the classifier  such as the support vector machine  svm  or the nearest neighbor rule  used to classify the data points  vovk et al.  1 .
¡¡to define a valid strangeness value for each data point  the simple assumption that at any time instance the strangeness value of each data point seen so far should be independent of the order these data points are used in the strangeness computation must be satisfied  vovk et al.  1 . for instance  when a k-nearest neighbor rule is used  the strangeness value of a particular data point is the ratio of the sum of the knearest data points with similar label  ss  to the sum of the k-nearest data points with difference label  sd . hence  the higher ss is  the higher the strangeness value  and vice versa. on the other hand  when sd is high  the strangeness value is low. this is clearly a method that constructs valid strangeness values for labeled data points.
¡¡for unlabeled data  the strangeness measure is derived using clustering algorithm such as k-mean/median clustering with k = 1. consider the set of unlabeled data points
the strangeness valuez = {z1 ¡¤¡¤¡¤ zn 1} and the new unlabeled data pointsi of zi for i = 1 ¡¤¡¤¡¤ n is	zn.
		 1 
where c ¡¤  is some cluster representation and  ¡¤  is some distance measure. the strangeness value for a data point is high when it is further away from the cluster representation  e.g. the cluster center.
¡¡next  a statistic is constructed to rank the strangeness value of the new data point zn with respect to the strangeness values of all the observed data points. the statistic  called the pvalue of zn  is defined as p-value = v  z ¡È {zn} ¦Èn  =
#{i : si   sn} + ¦Èn#{i : si = sn}
 1 
n
where si is the strangeness measure for zi  i = 1 ¡¤¡¤¡¤ n and ¦Èn is randomly chosen from  1 .
¡¡the random number ¦Èn in  1  ensures that the pvalues p1 p1 ¡¤¡¤¡¤ output by the p-value function v are distributed uniformly in  1   provided that the input examples z1 z1 ¡¤¡¤¡¤ are generated by an exchangeable probability distribution in the input space  vovk et al.  1 . this property of output p-values no longer holds when the exchangeability condition is not satisfied.
1	change detection using martingale
intuitively  we assume that a sequence of data points with a change consists of concatenating two data segments  s1 and s1  such that the data distribution of s1 and s1 are p1 and
p1 respectively and. switching a data point zi from s1 to a position in s1 will make the data point stand out in s1. the exchangeability condition is  therefore  violated. exchangeability is a sufficient condition for a stable data stream. the absence of exchangeability suggests the occurrence of change.
¡¡a family of martingales  indexed by  and referred to as the power martingale  is defined as
		 1 
where the pis are the output p-values from the function v   with the initial martingale. we note that
. hence  it is not necessary to store the previous p-values. in our experiments  we use   which is within the desirable range where the martingale value is more sensitive to a violation of the exchangeability condition  vovk et al.  1 .
¡¡the following theorem is applicable to both labeled and unlabeled data streams as long as the assumption  stated in section 1  on the strangeness measure is satisfied.
theorem 1   ho and wechsler  1b  i   ¡Þ} be a martingale sequence of the form  1  constructed using p-values {pi : 1 ¡Ü i   ¡Þ} computed from  1  based on a valid strangeness measure for a given data stream:
1. if no change occurs in the given data stream  then
	 	 1 
where ¦Ë is a positive number.
1. let ¦Á be the size of the test deciding in favor of the alternative hypothesis  change occurs in the data stream  when the null hypothesis  no change occurs in the data stream  is true and 1 ¦Â be the power of the test deciding in favor of the alternative hypothesis when it is true  the martingale test according to  1  is an approximation of the sequential probability ratio test  sprt   with
	 	 1 
and the mean delay time e m   i.e. the expected number of data points  m  observed before a change is detected  is approximated from the sprt as follows:
		 1 

 a 
euclidean distance. the threshold ¦Ë value for the martingale test is set to 1. the data points from the data stream d are observed sequentially. the cluster center is updated. strangeness for all seen data points are computed. the martingale at each instance is computed using  1  based on the computed p-values from  1 . when the martingale value is greater than ¦Ë  a change in the mean of the gaussian distribution is detected. all previously seen data points are removed. the martingale is reset to 1. the next 1 data points are used b 
figure 1:  a  left: a sketch of four overlapping 1dimensional gaussian distributions and the way the data sequence changes in distribution; right: the trajectory of the center of the 1-mean cluster as data points are observed one by one;  b  the martingale values of the 1-d synthetic unlabeled data stream with 1 change points.
where
		 1 
¡¡a user selects a desirable threshold ¦Ë for the martingale test  1  based on  1 . to estimate the start of the change   1  is used .
1 experimental result: synthetic unlabeled data stream
we construct an artificial unlabeled data stream as follows:
1. randomly generate four sets of 1 data points s1  s1  s1  and s1 from four overlapping gaussian distributions with randomly generated mean with variance 1.
1. concatenate s1  s1  s1  and s1 to form a sequence d consisting of 1 data points such that d = {s1;s1;s1;s1}.
¡¡left graph in figure 1 a  shows a sketch of four overlapping 1-dimensional gaussian distributions generated by step 1 of the above procedure. the data distribution of the data sequence d changes with 1 change points.
¡¡in the experiment  the first 1 points from d is first used to compute the center of the initial 1-mean cluster with strangeness of each data point computed using  1  with the to construct a new 1-mean cluster. the process repeats till the data points in d are exhausted.
¡¡right graph in figure 1 a  shows the trajectory of the center of 1-mean cluster in the experiment. the theoretical basis for signaling a change is  1 . figure 1 b  shows the martingale values. detection occurs when the martingale value is greater than ¦Ë = 1. the true change points are at data points 1  1 and 1. the dimension of the gaussian distribution is then increased to 1. figure 1 shows that the changes in mean parameter of the high-dimensional gaussian distribution are detected as well.
¡¡we note that in some real-world problems  more than one data feature is good in representing the data. in order to utilize this observation to improve the sensitivity and performance of the martingale test  one can perform a number of martingale tests constructed based on different characteristics or features of the data.
1	multiple-martingale test using multi-views
in the multi-view learning problem  an example z is represented by a number of feature subsets. each feature subset describes a view of the example  muslea et al.  1 . the multi-view setting is closely related to co-training  blum and mitchell  1 .
¡¡for the multiple-martingale test  we consider the multiview setting such that each constructed martingale attempts to identify changes with respect to the particular feature subset. besides the fact that the features are extracted from the original data  the feature subsets should be independent of one another to minimize redundancy.
¡¡we note that according to the martingale theory  the data representation does not affect the probability bound  1 . on the other hand 
corollary 1 when the multiple martingale test with mviews is used for change detection  the expected number of data points  m  observed before a change point is detected 
		 1 
obviously  one can conclude that the number of miss detection using the multiple-martingale test is upper-bounded by the number of miss detection using the original martingale method. moreover  the number of false alarm using the multiple martingale test is lower-bounded by the number of false alarm using the original martingale method.
¡¡algorithm 1 is the multiple-martingale test with two views. the algorithm can be trivially extended to m   1.

algorithm 1 : multiple-martingale test with m-view 
initialize: m1  = m1  = 1;i = 1;t = {}.
set: ¦Ë.
1: loop
1:	a new unlabeled example xi is observed.1:construct the two views/features from xi  i.e.  x¡¥i =1:{fi1 fi1}.
compute the strangeness measure vectors containing strangeness for seen examples  using  1 1:fromcompute the p-values{f1 ¡¤¡¤¡¤ fi1} and {f1 ¡¤¡¤¡¤ fi1}.	  re-
spectively  using  1 .1:compute m1 i  and m1 i  from p1 and p1 using  1 .1:if m1 i    ¦Ë or m1 i    ¦Ë then1:change detected1:set m1 i  and m1 i  to 1;1:re-initialize t to an empty set.1:else1:add xi into t.1:end if1:	i := i + 1;
1: end loopm = 1
1	video-shot change detection problem
in section 1  we describe the method of constructing valid strangeness for video stream. in section 1  we analyze the martingale test method and motivate using the multiplemartingale test on detecting changes in video stream. in section 1  we compare the multiple martingale test method with alternative video-shot change detection methods.
1	strangeness measure for video stream
we describe the representation and the strangeness measure for the unlabeled video image in this subsection.
image representation using color and edge histograms
the image representations are based on the color and edge histograms. the color histogram is constructed with 1 bins.   r/1    1 +  g/1    1 + b/1  is used to convert
rgb values of a pixel into an index  with integer division where r  g and b are red  green and blue values respectively. the edge histogram consists of 1 bins such that a gradient angle is converted into an index by dividing the orientation angle by 1 and rounding to the nearest integer.
¡¡to capture local information from an image frame  the image frame is partitioned such that a histogram is constructed for each area partitioned along either the horizontal or the vertical axis. for example  for a 1¡Á1 image  histograms are constructed on 1 areas of 1 ¡Á 1 by partitioning along the horizontal axis and 1 areas of 1 ¡Á 1 by partitioning along the vertical axis. using this construction  we have two image representations: one consisting of six color histograms  rcc = {hc1 hc1 hc1 hc1 hc1 hc1}  and one consisting of six edge histograms  ree = {he1 he1 he1 he1 he1 he1}. the two image representations are used as the two views in algorithm 1.
strangeness measure of the image representations  rcc and ree
consider the set of image representations  i.e. z = {r1 ¡¤¡¤¡¤ r n 1 } and a new image representation rn in the form of either rcc or ree. first  we define
	¦¸ = max z ¡È {rn} 	 1 
which contains the maximum value for each bin in the histograms of the image representation.
¡¡we note that as the number of observed image frames increases  ||¦¸||  where ||¡¤|| is some distance measure  is monotonically increasing. ¦¸ ensures that the cluster center will maintain information from previously observed image frames and not be affected by a small drift in image content when a new image frame is observed. the effect of a small drift in image content is significant when the mean  median or minimum value is used. ¦¸ assumes the role of the cluster center for the images.
¡¡we are interested in the difference between the image representation ri i = 1 ¡¤¡¤¡¤ n and ¦¸. using the euclidean norm  the strangeness value for ri is
	.	 1 
 this strangeness measure is valid for an image representation ri in the form of either rcc or ree as it satisfies the assumption in section 1. the set of computed strangeness values is used to compute the p-
1	characteristics of the martingale method for video stream
consider the example shown in figure 1  we use the image representation rcc and the threshold value ¦Ë = 1 to demonstrate some characteristics of the martingale method.
¡¡the characteristic of ¦¸c  for color histogram representation  rcc  is shown in figure 1. the shot change is detected at frame 1 and all previous information is removed from the memory. unlike labeled data stream where the data-generating process changes at some particular time instances  ho  1; ho and wechsler  1b   the unlabeled video sequence is usually non-stationary  with constant small changes. the  cluster  representation ¦¸c should be either  i 

figure 1: example: starting at  left image  frame 1 to
 center image  frame 1: human starts appearing in frame 1 and appearing completely at around frame 1. the shot change is detected at frame 1  right image .
insensitive to small changes or  ii  maintain most information from the previously observed data. ¦¸c satisfies the two criteria.

figure 1: using the example shown in figure 1: the characteristic of ¦¸c using the image representation rcc when the video sequence is nearly stationary and after a shot change is detected at frame 1.
¡¡we perform the kolmogorov-smirnov test  ks-test  to see whether the p-values computed using  1  is uniformly distributed when the video content is nearly stationary. this important property of p-values computed using  1  does not hold when the video sequence no longer satisfies the exchangeability condition. the mean of the p-values lowers and the martingale values start to increase. in this experiment  we perform the martingale method without reacting to shot change detected  removing data points and resetting variables. in figure 1  we observed that with high confidence  based on p-values obtained from the ks-test  the p-values computed using  1  is uniformly distributed before frame 1. after frame 1  the p-values are no longer uniformly distributed at 1 significance level.
¡¡in figure 1  we show the martingale values computed using the color feature  rcc and the edge feature  ree. one notes that for this particular example shown in figure 1  the edge feature is more sensitive than the color feature. the martingale values computed using the edge feature increase faster and higher than the ones computed using the color feature near the image frame where the change occurs. hence  by using the multiple-martingale test with 1 views  the number of image frames observed before detecting the change point is lowered. hence  the sensitivity of the martingale method can be increased using multiple views.

figure 1: using the example shown in figure 1: the characteristics of the p-values computed using  1  and the image representation rcc on the video sequence. we perform the kolmogorov-smirnov test  ks-test  starting at frame 1. frame 1 has the lowest p-value using the ks-test at 1 significance level and a significance level of less than 1 is observed after frame 1.
1	comparison with alternative methods
experiments were performed to compare the multiplemartingale test with alternative methods. four sets of videos  consisting of two documentary video streams  anni  ugs  1and two video streams from hand-held digital video camera  outdoor  indoor   are used. the  anni  video stream consists of 1 shots and 1 gradual transitions between shots. the  ugs  video stream consists of 1 shots with some fast transitions and moving camera. the  outdoor  and  indoor  video streams consist of continuous changes due to the motion of the camera. the two video streams are captured from the top of a hill and from an apartment  respectively.
¡¡the performance of the methods is measured based on the number of detections  miss detections and false detections. they are summarized using the recall  precision and the f1
measure:=number of correct detectionsprecision
number of detections
	recall	=	number of correct detections
¡¡number of true changes 1 ¡Á recall ¡Á precision
	f1	=
recall + precision
 precision is the probability that a detection is actually correct  i.e. detecting a true change. recall is the probability that a change detection system recognizes a true change. f1 measure represents a harmonic mean between recall and precision. a high value of f1 measure ensures that the precision and recall are reasonably high.
¡¡in the experiment  we use ¦Ë = 1 which corresponds to the fact that the computed martingale values are unlikely to be higher than 1 with probability bound of 1 if no change

figure 1: the characteristics of martingale values mn using both the image representations rcc and ree on the example in figure 1. the edge feature is more sensitive than the color feature in this particular example.
occurs. we compare the multiple-martingale test  mt  1   with the alternative methods. for the alternative methods  the color histogram is used as the image representation and the local threshold is selected based on window averaging  gargi et al.  1  on three similarity measures: histogram intersection  hi   chi-square measure  ¦Ö1  and euclidean distance  ed   to measure the similarity between any two image frames for all the image frames in a video sequence. the parameters  such as the window size  are varied so that the best results can be obtained from the alternative methods. the experimental results on the four video sequences are shown in table 1.
videoanniugsoutdoorindoorlength1111methodframes11shots11precision1111mt  1 recall1111f1.1.1.1.1precision1111hirecall1111f1.1.1.1.1precision1111¦Ö1recall1111f1.1.1.1.1precision1111edrecall1111f1.1.1.1.1table 1: experimental results.
¡¡based on the f1 measure  the multiple-martingale test performed the best three out of the four video sequences. the main difference between the alternative methods and ours is the fact that our threshold is chosen a prior with theoretical consideration while the thresholds selected by the alternative methods are heuristics such that the window size and other parameters need to be tuned to achieve good result. moreover  the martingale method is a one-pass algorithm while the alternative methods are not.
1	conclusions
in this paper  we extend the martingale methodology  ho  1  to be used on unlabeled data. we also proposed the multiplemartingale test based on building different martingales using multiple views  features  to enhance the performance of the martingale methodology. we apply this multiple martingale test method to the video-shot change detection and show that it compares favorably with alternative methods.
