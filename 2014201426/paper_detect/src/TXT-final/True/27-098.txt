ing from the particular features of fluid dynamical reasoning  1 propose five core operations - aggregation  classification  re-description  spatial inference  and configuration change - as part of a general theory of imagistic reasoning. a new vortex-finding algorithm is also presented. 
 feymann said ... when einstein stopped creating it was because he stopped thinking in concrete physical images and became a manipulator of equations.  
genius  james gleick  p1  1. 
1 	introduction 
it is commonly believed that there are two styles of scientific thinking: analytical  a logical chain of symbolic reasoning from premises to conclusions  and visual  the holding of imagistic  analogue representations of a problem in one's mind so that perceptual and symbolic operations can be brought to bear to make deductions. neither style is to be preferred a priori over the other. however  for problems whose complexity precludes a direct analytical approach  a certain amount of qualitative and visual imagination is needed to provide the necessary 
 feel  or  understanding  of the physical phenomena. once the picture is clear  the analytical mathematics can take over and lead more efficiently to logical conclusions. 
¡¡this  feel and physical understanding  is rather informal  imprecise  and apparently unteachable  but necessary for scientists. my research goal is to formalize the visual style of thinking as computer programs  and to demonstrate the power of these programs by their ability to reason about the structure and motion of turbulent fluid flows. 
¡¡the choice of fluid flows as a domain may seem arbitrary and turbulence may add unnecessary difficulty to the project. however i believe the subject matter is fascinating  ripe for attack  more constrained than a commonsense theory of liquids  and  most importantly  is worthwhile because new tools for advancing turbulence research can have enormous scientific values. 
¡¡turbulent flows have been studied for many decades. but only recently has the capacity to perform direct numerical simulation  dns  of turbulent flows at moderate 
reynolds numbers with enough accuracy been realized. 
1
  so for the first time detailed solution fields are available to scientists. some of the important questions facing scientists are: how does one make observations from the data  how does one make theories based on new observations  how are data used to test theories  
¡¡currently there is a large effort in scientific visualization whose goal is to develop computer graphics to facilitate the presentation of large datasets. however the process of discovering interesting structures in the datasets and extracting physics from them is up to the human experts. even with the help of modern visualization software  such as avs and explorer   most human 

¡¡¡¡* the research was funded in part by nsf nyi award ecs-1. 
1 	qualitative reasoning and diagnosis 

'the terminology is explained in sections 1 and 1. 

experts find the task time-consuming and prone to human visualization error. 1 
in collaboration with experts in fluid dynamics from 
yale and mit  i am building computer tools that can reduce the post-processing time of cfd data by orders of magnitude. my approach is based on the following key idea: a c t i v e visualization and a b s t r a c t i o n  ava . 
1
  by  active  i mean the reasoning process has three properties: 
  autonomous - the computer holds pictures in its mind so that perceptual operations can be used to make inferences which are otherwise too difficult to make by analytical methods alone. 
  purposeful - the visualization is done in the context of making observations and testing theories. 
  generative - the results of visualization guide the computer to make further observations. 
   by abstraction  i mean the process of reducing the encoding length of the datasets. a moderate-sized instantaneous flow field might consist of o 1  grid points each with a 1-vector  three components for velocity and one for pressure  associated with it. it is hard to imagine four numbers or even one at each point of space. could we re-represent the flow field by semi-persistent objects that are much more compact and easy to visualize  that the physical picture of moving and deforming objects  called vortices  is a useful level of abstraction for reasoning about fluids is an important claim of ava. 
¡¡what does ava consist of  i conjecture that ava consists of five core operations: 1 
1. aggregation 
1. classification 
1. re-description 
1. spatial inference 
1. configuration change 
¡¡aggregation is the grouping of primitive objects according to some measure of similarity  e.g.  closeness  continuity  symmetry . for a familiar example  consider a vector field. points in the vector field can be grouped into integral curves or orbits. classification is the assignment of labels to the aggregate objects. each label denotes a bundle of characteristic properties. redescription gives a more concise representation of the aggregate. these aggregates might possess characterfurther discussion of this issue and current approaches in the visualization literature can be found in  samtaney et 
al  1 . 
     1 the concept is similar in spirit to the idea of  active vision  in the vision literature  which means the active control of camera movements and focus of attention to improve the robustness and stability of vision. i apply the concept to a higher-level cognitive process. 
1
¡¡¡¡these core operations are distilled from a rethinking of how phase space analysis programs - like kam  yip  1l  or maps  zhao  1  - work. i suspect much of the work in mechanism analysis using configuration space  e.g.  joskowicz and sacks  1   can be cast in the same framework. istic shape and might touch or overlap. deduction of these geometric relations is the province of spatial inference. the characteristic properties of an object might constrain what other objects can exist or change or deform in its neighborhood. finally  the whole cycle of core operations can be reapplied at a more abstract level. 
¡¡a word about related works. commonsense reasoning about fluids is a central problem in naive physics  hayes  1b; 1a . the problem is hard because fluids do not conveniently divide into discrete pieces that can be easily combined. ken forbus and his group have done important work in extending and partially implementing pat hayes' ideas for representing fluids using both the contained-liquid and piece-of-stuff ontologies  forbus  1; collins and forbus  1 . the work described here is closer to the scientific end of the formalization spectrum. as a consequence the theory is less general than hayes' theory  but more relevant to the research in the turbulence community. i expect the two lines of research to have fruitful interactions. 
1 	properties of fluid motion 
a fluid is either a gas or a liquid; it is not a solid. the behavior of fluid is interesting and often surprising. one can get a good understanding of fluids by thinking about the properties of water. solids resist deformation; fluids yield to any shear stress. solids care how far they deform; fluids how fast they deform. the measure of the ease of deformation is viscosity. a more viscous fluid like honey deforms more slowly than a less viscous one like water. if the fluid is not moving  the only force it exerts is pressure  which always acts in the direction normal to any surface in the fluid. if the fluid is moving  a number of new forces come into play. viscosity  an internal friction so to speak  causes a shear stress to develop between layers of fluid moving in different velocity. a fluid moving across a solid surface tends to drag the surface with it. this property is known as the no-slip condition  i.e.  the velocity of the fluid is exactly zero at the solid surface. the frictional forces always act in the opposite direction of motion. a fluid moving over an asymmetrical solid surface can create lift  a force perpendicular to the direction of motion. 
¡¡real fluids are quite complicated  so i will make some assumptions about the properties of the flow to simplify the discussion. the assumptions are convenient fictions  but in many interesting cases they are rather good approximations: 
1. fluids are incompressible. this is really the conser-vation of mass. the volumetric flow rate is the same at every point in the fluid; no fluid can accumulate anywhere. 
1. fluids are newtonian. this gives a particularly simple linear relationship between the applied shear stress and the rate of deformation. 
	yip 	1 
1. no temperature variation  coriolis forces  nor electromagnetic forces exist that might affect the fluid. the newtonian  incompressible fluid is already complicated enough. 
¡¡the payoff of these assumptions is large. the only relevant forces on the fluid  besides pressure  are inertial and viscous. the inertial forces keep the fluid going; the viscous try to stop it. the ratio between the two forces  a dimensionless number  is called the reynolds number  denoted by the symbol re. 
   one reason why the reynolds number is an important parameter is that the character of fluid motion is strongly dependent on it. a very high reynolds number flow  re    1  is dominated by inertial forces and tends to favor turbulence in which individual  fluid particles  move in a random unpredictable fashion even when the fluid as a whole is moving in a definite direction. large viscous forces such as those in a flow with very low reynolds number should damp turbulence and maintain a laminar flow in which fluid particles move more or less parallel to each other. in between the very high and very low reynolds number flows are the transition flows whose character depends on the circumstances. 
¡¡to get an idea of the different regimes of a real fluid flow  consider a steady incompressible flow past a symmetric  bluff body   a non-streamlined body such as a circular cylinder or a sphere . see fig. 1. at very low reynolds number  when the flow is slow  the flow pattern consists of smooth symmetrical streamlines  the trajectories of the fluid particles. as the reynolds number is increased  a pair of symmetrical eddies or vortices appears in the rear of the cylinder where fluid particles curl around. if the flow speed continues to increase  the vortices become elongated and at some point break off  traveling downstream with the fluid. the phenomenon is known as flow separation. new vortices begin to form near the behind of the cylinder and shed alternatively into the cylinder wake. at sufficiently high reynolds number  turbulence sets in and the wake begins to oscillate; the flow is unsteady and highly irregular. vortices of many different length scales are also visible. 
¡¡what really happens inside a turbulent flow  is the motion of fluid particles purely random  or is there organized motion within a background of smaller scale random fluctuation  experimental evidence seems to favor the latter alternative. nobody really knows for sure. but why do we care anyway  the reason is that although we do not understand turbulence  its effects are highly significant. turbulence increases drag  mixing of materials  and transport of heat. in designing an air transport  we might want to suppress turbulence in order to reduce drag; in a combustion engine on the other hand we might want to enhance turbulence to increase mixing rate. if large-scale structures do exist inside a turbulent flow and are found to be responsible for the enhanced mixing and transport properties  then it might be possible to control 
1 	qualitative reasoning and diagnosis 

figure 1: schematic flow patterns around a circular cylinder   a  symmetrical streamlines and absence of vortices   b  a pair of vortices in the rear of cylinder   c  alternating vortices shed downstream   d  a turbulent wake with vortices of many length scales. turbulence by direct interference with these structures. 
1 	reasoning tasks 
given a numerical solution field of a turbulent flow  a spectrum of reasoning tasks can be defined. the following list is roughly in the order of increasing complexity: 
1. making observations. find out structures  if any  that exist in the solution field. are there vortices  what are their shapes and sizes  how are they distributed  how are they created  how do they evolve and interact  
1. making correlations. determine how the shape and distribution of structures correlate with fluid velocities  pressure  dissipation  and other statistical properties of the flow. 
1. incremental analysis. given an instantaneous con-figuration of structures  predict the possible shorttime behaviors. 
1. causal analysis. explain and summarize the evolu-tion of structures by a set of elementary interaction rules. 
1. testing theories. given a hypothesis about structure formation or interaction  gather evidence to support or disprove the hypothesis. 
1 	domain theory 
the entire theory of incompressible flow is contained in the navier-stokes equations: 

¡¡the first equation expresses the conservation of mass; it is the incompressibility assumption. it says the velocity u  which has three components  has zero divergence. the name divergence is well-chosen for ¨‹-u is a measure of how much u spreads out  diverges . if it is positive  negative  at a point p  then p is a source  sink . zero divergence means no source or sink inside the flow. 
¡¡the second equation comes from newton's second law of motion; it equates fluid acceleration with applied forces. the acceleration terms  the left hand side of the second equation  represent the change of velocity in time and space. on the right hand side  the first term -¨‹p is the pressure gradient. the second term  u is the kinematic viscosity which is the ratio of the viscosity and density of the fluid; the product of v and the second spatial derivatives of the velocity v 1 u is the force due to viscosity. 
¡¡since we can associate with every point  x  y  z  in space and instance t with a velocity u  we call u ar  y  z  t  a velocity field. a field is any physical quantity that takes on different values at different positions and time. u x y  z t   like a magnetic field  is a vector field because at each space-time point  we associate a vector with three components. the pressure field p x y  z t  like temperature is a scalar field - one number for each point. 
   while useful for some specialized flows  the velocity field and its topology are not a particularly good representation of turbulent flows. the velocity field not only is not galilean invariant  what an observer sees depends on how fast she is moving   but also can change quite unpredictably from one instance to another. as a consequence  we cannot visualize what is happening - not easily. just as some scientists prefer to think in terms of interaction of charges and magnets rather than the resulting magnetic field  many fluid dynamicists prefer to think in terms of a vector quantity called vorticity  denoted by the symbol w  which is the curl of the velocity  w= ¨‹ x u . the curl of u at a point p measures how much the vector field u curls around p. 
¡¡suppose you float a paddlewheel on a bathtub. if it starts to turn  then the point it is placed has a non-zero curl. a region with a large curl is an eddy  a whirlpool. the curl of u is a vector; its direction is assigned by the right hand rule: if the water surface is the xy-plane and the paddlewheel turns counterclockwise  the curl points to the upward z-direction. 
¡¡the reason we introduce the vorticity field w x  y  z  t  is that it simplifies the description of fluid motion and gives ontological primitives which are easier to reason with. a vortex line is an integral curve of the vorticity field. the set of vortex lines passing through a simple closed curve in space is said to form the boundary of a vortex tube. vortex lines and vortex tubes have nice invariant properties. in particular  they can be treated as material objects. the truth of this last statement follows from the so-called helmholtz laws of vortex motion. for incompressible  inviscid  i.e.  v = 1  flow  helmholtz proved the following theorems  batchelor  1 : 
1. the vorticity field has zero divergence  because the divergence of a curl is always zero . 
1. vortex lines move with the fluid  i.e.  fluid particles that at any time lie on a vortex line continue to lie on it. 
1. the strength t of a vortex tube  defined as circula-tion   nds is the same for all cross-sections 1 of the vortex tube and is constant in time. 
the first and second theorems explain why vortex lines or tubes can be treated as material bodies. the third theorem is just an expression of the conservation of angular momentum. the skater's spin is a nice illustration of the third theorem at work. by bringing in her arms and thereby shrinking the cross-section  the skater spins faster because the total angular momentum is conserved. 
¡¡turbulent flows are not inviscid  but at very high reynolds number the viscous effect is very small except in a thin region close to the solid boundaries. so it is reasonable to expect the helmholtz laws to be approximately correct. 
¡¡although the exact analysis of the motion of a configuration of vortex lines and vortex tubes can be very complicated  the simplest situations can be understood by a few qualitative principles: 
	qualitative rules 	of 	vortex motion 
1. a vortex line accelerates velocity on one side and slows down on another. a lift force perpendicular to the vortex line is generated due to the bernoulli effect. 
1. a vortex line is convected by the fluid which exerts a drag force to push the vortex line in the direction of fluid motion. 
1. a vortex tube stretched  compressed  in one direc-tion increases  decreases  the velocity components in the other two directions. 
1. a bent vortex line  conceptualized as a space curve  exerts a self-induced motion along its binormal and the effect is largest at points of maximum curvature  arms and hama  1 . 
1. vorticity can only be created at velocity discontinu-ities and solid boundaries. 
	yip 	1 


figure 1: motion of vortex lines can be understood by a few qualitative principles: schematic pictures for two types of vortex line reconnection.  a  two antiparallei vortex lines come together and reconnect to get rid of the region of opposing vorticity.  b  a similar reconnection occurs when a vortex line touches a free-slip boundary. 
1. when two antiparallei vortex lines are brought close together  they can break apart and reconnect.  see fig. 1  
1. when a vortex line meets a free-slip boundary  it can reconnect. 
the first four rules are consequences of helmholtz laws; they are good approximations even when applied to vortex tubes with finite core size as long as the core is relatively thin. the fifth is a kinematic consequence of the no-slip condition and the conservation of vorticity. the last two rules describe how the topology of vortex lines can change. the detail of the reconnection mechanism is still an open issue  but reconnection appears to happen experimentally. 
¡¡the significance of these qualitative rules is that they allow the synthesis of the velocity field - at least the rotational component of the velocity. main qualitative features of the flow field can often be deduced without complicated numerics. the use of these rules in incremental motion analysis will be the subject of a sequel paper. 
1 	automatic extraction of vortex structures 
1 	aggregating vortex lines 
a vortex line is the basic building block of a vortex structure. because of the divergence-free property  a vortex line  like a magnetic field line  does not start or stop in the interior of the fluid; it tends to run in a closed loop. however  a real turbulent flow always has a background of randomly fluctuating vorticity. so it is reasonable to assume that only the relatively high-intensity vortex structures remain coherent from one time instance to another. to distinguish a  coherent  vortex from a mathematical vortex  i propose the following definition for aggregation: 
definition a coherent vortex is a compact bundle of adjacent  high-intensity vortex lines that are 
geometrically similar. 
¡¡there is some degree of arbitrariness in any definition of coherent structure because the notion of coherence is informal. i believe the definition here is more faithful to the mathematical definition of a vortex tube. a coherent vortex can be tube-like or sheet-like depending on the shape of its cross-section. unlike a mathematical vortex  a coherent vortex can start or end in the interior of the fluid. 
¡¡aggregating vortex lines to form coherent structures is not straightforward. previous researchers  moin and kim  1; robinson  1  have found that vortex lines are sensitive to initial conditions. nearby vortex lines can diverge rapidly. if the initial conditions are not chosen carefully  the resulting vortex lines are likely to resemble badly tangled spaghetti wandering over the whole flow field  making the identification of organized structure extremely difficult. this might explain why vortex lines have not been widely used for structure identification. i believe the search algorithm below is the first successful structure identification based on vortex lines. 
¡¡given a numerical vorticity field  the search algorithm finds all coherent vortices. the key idea in the algorithm is the adaptive control of the cross-section of the vortex tube: the cross-section is shrunk  expanded  when the vortex lines on the boundary of the cross-section are converging  diverging . the algorithm has the following 
steps: 
1. find all grid points that are local extrema of vortic-ity magnitude and greater than a threshold. these are the seed points. 
1. on the plane normal to the largest vorticity vec-tor component at the seed point  find an isocontour centered at the point. the contour  discretized into points  represents the initial cross section of the surface. 
1. use the advancing front method  explained later  to interleave the advancement of the cross section by integration and the tiling of the surface. 
1. use the geometry of the tiles to decide shrinking or expanding the cross section locally. 
1. the wavefront is periodically adjusted globally by computing its convex hull  and the diameter and width of the hull. 
1. the forward integration terminates when the circu-lation on the cross section falls below certain threshold. 
1. reconstruct the surface by integrating the last cross section backwards until it reaches the initial cross 

section. no wavefront adjustment is needed in this step. 
1. remove the weak vortex lines. 
¡¡the advancing front method is implemented as follows.  see  hultquist  1  for details.  the vortex surface consists of a list of ribbons. each ribbon has two tracers: a left and a right. as its tracers are advanced  the ribbon is tiled by triangular meshes in such a way to keep wavefront nearly perpendicular to the integration direction. the aspect ratio of the quadrilateral formed by the last pair of alternating left and right triangles in each ribbon is used to control the local adjustment of the wavefront. 
¡¡vortex lines can twist and turn  so the cross sections can get distorted quite a bit as the surface is developed. the vortex-finding algorithm keeps track of the number of tracers. if the number exceeds a threshold  which is indicative of many highly distorted quadrilaterals  the entire cross section is replaced by the convex hull of the projected wavefront on a plane normal to the vorticity vector at the centroid of the cross section. the convex hull is useful for three purposes:  1  it reduces the number of tracers   1  it re-orders the tracers into adjacent positions along the vertices of an oriented polygon  and  1  important shape information of the cross section such as its diameter and width can be computed in linear time from its convex hull  o'rouke  1 . 
1 	aggregation results 
as the test case  i use the dns results of a free surface turbulence provided by professor dick yue in the ocean engineering department of mit. the turbulence is generated by a shear flow in a 1 rectangular box with periodic boundary conditions in the x and y direction. a 1th order polynomial interpolation is used to compute the interpolated vorticity vector from the grid values  and an adaptive 1th order runge-kutta integrator to integrate vortex lines. hundreds of structures have been constructed by the algorithm. a typical result is shown in fig. 1a. the vortex is reconstructed from 1 vortex lines. the computation including rendering  done by avs 1  takes about 1 seconds real time on a sparc 1. 
¡¡the algorithm is not sensitive to the initial choice of isocontour value: it is self-adjusting. contrast this with an ordinary integrator. the vorticity lines obtained diverge and are tangled  fig. 1b . moreover  small changes in the initial isocontour can result in drastically different vortex line patterns. 
1 	classification and re-description 
the reconstructed vortex must be interpreted in order to perform spatial inferences and incremental motion analysis. classification is the assignment of labels to vortices. the assignment is determined by the shape of the vortex. a vortex can be tube-like or sheet-like. tube-like 

figure 1:  a  upper: a vortex structure reconstructed by the advancing wavefront method with backward integration. each line is obtained by approximately 1 integration steps   b  lower: the vortex lines obtained by integration with no adaptive control of cross sections. 

figure 1: a generalized cylinder representation of the reconstructed vortex shown in fig. 1a. the tiling is chosen to minimize twist between adjacent cross-sections. 
	yip 	1 
vortices are further differentiated by the curvature function along their axes. it is important to identify the local curvature extrema because these extrema cause a self-induced motion  section 1 . 
¡¡to obtain a concise representation of a bundle of vortex lines  a vortex is re-described as a generalized cylinder  gc . a gc consists of a spline  a cross-section  and a sweeping rule  binford  1 . the gc representation of a vortex is computed by the following steps: 
1. pick the vortex line with the highest integrated vorticity as the candidate spline. 
1. compute a scale-space representation of the cur-vature of the candidate spline  witkin  1 . 
1. the stable local extrema are chosen as knot points. 
1. at each knot point p  compute where the vortex lines intersect the plane at p with the plane normal equal to the vorticity vector at p. 
1. fit an ellipse to the intersection points to obtain a cross-section of the vortex. 
1. the spline of the gc is obtained by spline-fitting the centers of the elliptical cross-sections. 
1. compute the intrinsic shape descriptions of the spline  i.e.  its curvature and torsion. 
   by varying the criteria for stable curvature extrema  one can obtain generalized cylinders of different resolutions. fig. 1 shows a rather fine generalized cylinder representation of the reconstructed vortex first shown in fig. 1a. 
1 	conclusion 
this paper presents three novel ideas: 
1. a zeroth-order formalization of the visual style of thinking as a cycle of five core operations: aggregation  classification  re-description  spatial inference  and configuration change. 
1. a formalization of a theory of fluid flow based on new ontological primitives: vortex line  vortex tube  and coherent vortex  and a list of qualitative interaction rules. 
1. a new vortex-finding algorithm based on vortex lines. 
¡¡the implementation of spatial inference  such as determining spatial relations among vortices  and configuration change  such as incremental analysis of vortex motion  will be the subject of a sequel paper. 
references 
 arms and hama  1  r arms and f.r. hama. localized-induction concept on a curved vortex and motion of an elliptic vortex ring. physics of fluids  1  1. 
 batchelor  1  g.k. batchelor. an introduction to fluid dynamics. cambridge university press  1.  binford  1  t.o. binford. generalized cylinder representation. in encyclopedia of artificial intelligence. 
wiley  1. 
 collins and forbus  1  john collins and kenneth forbus. reasoning about fluids via moecular collections. in proceedings aaai-1  1. 
 forbus  1  kenneth d forbus. qualitative process theory. artificial intelligence  1  1. 
 hayes  1a  patrick hayes. naive physics 1: ontology for liquids. in j.r. hobbs and r.c. moore  editors  formal theories of the commonsense world. 
ablex publishing corp.  1. 
 hayes  1b  patrick hayes. the second naive physics manifesto. in j.r. hobbs and r.c. moore  editors  formal theories of the commonsense world. ablex publishing corp.  1. 
 hultquist  1  j.p.m. hultquist. constructing stream surfaces in steady 1d vector fields. in proc. ieee visualization 1  1. 
 joskowicz and sacks  1  l joskowicz and e.p. sacks. computational kinematics. artificial intelligence  1. 
 moin and kim  1  p. moin and j. kim. the structure of the vorticity field in turbulent channel flow. journal of fluid mechanics  1  1. 
 o'rouke  1  joseph o'rouke. computational geometry in c. cambridge university press.  1. 
 robinson  1  s.k. robinson. the kinematics of turbulent boundary layer structure. tech. mem. 1  nasa  1. 
 samtaney et al.  1  
r samtaney  d silver  n zabusky  and j cao. visualizing features and tracking their evolution. ieee computer  july 1. 
 witkin  1  andrew witkin. scale-space filtering. in proceedings ijcai-1. international joint conference on artificial intelligence  1. 
 yip  1  kenneth yip. understanding complex dynamics by visual and symbolic reasoning. artificial intelligence  1  1. special volume on qualitative reasoning about physical systems i i . 
 zhao  1  feng zhao. extracting and representing qualitative behvaiors of complex systems in phase space. artificial intelligence  1  1. 
history-based interpretation   
seismic   
	u l r i c h 	j u n k e r 
institut francois du petrole 
ilog* 
1  av. gallieni  bp 1 gentilly cedex 
france 
junker ilog.fr 
a b s t r a c t 
dynamic objects such as liquids  waves  and flames can easily change their position  shape  and number. snapshot images produced by finite element simulators show these changes  hut lack an explicit representation of the objects and their causes. for the example of seismic waves  we develop a method for interpreting snapshots which is based on hayes1 concept of a history. 
1 	introduction 
most work on qualitative reasoning about physical systems is devoted to technical systems consisting of a fixed set of components that interact via given connections. examples given in  weld and de kleer  1  are electronic circuits  water tanks  and gear systems. in contrast to this  we will consider natural systems where objects are dynamic in position  direction  shape  and number. the frob system  forbus  1  simulates springing balls changing their positions and directions  but keeping their shapes. furthermore  we don't obtain new balls. flowing liquids  hayes  1a  are different: they easily divide  merge  and change their shapes. in order to capture those interactions between liquids  hayes developed the concept of a history  i.e. a coherent piece of space-time. histories provide an adequate means to describe the behaviour of dynamic objects such as flames  waves  clusters  clouds  which can all be deformed  divided and merged. 
   in this paper  we will consider a concrete task requiring history-based reasoning about physical phenomena. we consider the propagation of seismic shock waves in the underground  lavergne  1 . seismic waves are used by geophysicists to explore the structure of the underground. they are usually launched by an initial vibration on the surface. the resulting spheric shock wave is then propagating downwards as shown in the first snapshot of figure 1. when it hits an interface between two geological layers this causes a reflected and a 
   *this paper is based on work performed during the postdoctoral stay of the first author at the institut frangais du petrole. 
f finite element simulations of 
1 fields 
	b e r t r a n d 	b r a u n s c h w e i g 
i n s t i t u t francais du petrole 
1 ct 1  av. de bois-preau  bp 1 
1 r u e i l - m a l m a i s o n 
france 
bertrand.braunschweig ifp.fr 
transmitted wave. the reflected wave returns to the surface and leaves an observable front in the seismograms measured by the geophysicists. 
¡¡in order to interpret seismograms  the geophysicists incrementally construct a model of the underground based on hypotheses of the histories of the returning waves. above  we considered a wave that was reflected by the first interface. further interfaces lead to further direct reflections. additionally  a seismogram can show multiply reflected fronts  diffractions which are obtained due to corners and many other disturbing fronts. geophysicists pick out direct reflections using some heuristic approach and use them to construct a model of the underground  based on numerical optimization procedures or further ad-hoc rules . 
¡¡newer work on numerical simulators based on finite elements allows a very precise simulation of the wave propagation in complex models of the underground. the snapshot sequence in figure 1 has been produced by such a simulator  anne and brae  1 . the simulations enable a verification of the geological model. divergences between observed and simulated seismograms might help to correct the model. to detect them  we have to compare fronts having the same history  e.g. two direct reflections; two diffractions etc. . unfortunately  numerical simulators based on finite elements do not keep track of the history of waves. they produce a series of images showing the waves  but they lack a representation of the wave objects  their causes  and their histories. when examining a front of a seismogram  we want to know the obstacles and the types of phenomena that produced it. 
   in this paper  we show how to interpret the images produced by the numerical simulator and how to establish a causal relation between seismic events  waves  and obstacles in the underground. our goal is to detect hayes-like histories of waves in snapshot images. although the paper is restricted to 1d-models of the underground  its concepts can be generalized to the 1d-case. 
¡¡the paper is divided into two main sections. section 1 presents the representation of fields  sec. 1   as well as the vocabulary for describing wave histories  sec. 1 . the interpretation is done in several steps developed in section 1. we first decompose the underground into layers and interfaces  sec. 1 . then we show how to detect 
	junker and braunschweig 	1 

figure 1: snapshots of seismic waves. 
wave fronts in a single snapshot  sec. 1 . tracking a front from one snapshot to the other is considered in section 1. in section 1  we discuss how to detect new objects and their causes. 
1 	multiple representations 
1 	fields 
in order to describe complex phenomena  e.g. 	liquids  waves  flames etc.   physicists use parameter fields. a 
field is the distribution of a physical parameter in the given space. for shock waves  we consider a velocity field  giving the velocity of a wave at a certain point  and the field of the amplitudes of the waves  i.e. the snapshots in figure 1. . a physical law captures a relationship between parameter fields  which is valid at each point. in general  such a law is a differential equation  e.g. the wave equation . its solution describes the temporal development of a field. some of the fields such as the velocity field are static  stationary   whereas the amplitude field is changing in time  non-stationary . we restrict our discussion to a single static and a single dynamic field. 
   a well-suited technique for simulating changes of complex and arbitrary fields is the funite element method. a numerical simulator based on this technique is supplied 

with the initial parameter fields and then produces a series of snapshots showing the fields at selected instances of time. the finite element method can handle complex shapes because it uses a kind of an analogical representation of fields: 
  it is based on a grid  p n  where v is a set of selected points and n c v x v is a symmetric neighbourhood relation. 
  it describes the spatial distribution of a parameter using a mapping / : v -  r of the points to the real numbers. 
  it is specified extensionally  e.g. a matrix of floating point  numbers.  
seismic simulators normally use regular grids obtained by rows and columns. they are characterized by a starting point s :=  s1  s1 -  a unit distance a  the number n of columns and the number m of rows. the set of points is then given by 

1 	histories of dynamic objects 
fields don't represent objects explicitly. they just show certain patterns of activity that are reproduced in the next instants. for example  figure 1 shows wave fronts that are propagating  hitting interfaces  and generating new waves. in order to describe these phenomena  we need an ontology for dynamic objects in fields. 
¡¡our discussion is based on a given  continuous  space s1 for example the two-dimensional space defined by r1  and a linear  continuous  time defined by t := r. dynamic objects such as waves evolve in time and occupy a region at each time t. this region is a subset of s x {t}. if we consider different time points the occupied region of an object can change. we require that these changes are local. if we put the regions of an object at different times together  we obtain a subset of s x 1 . this subset must be a 'connected piece of space-time'  i.e. a history as defined in  hayes  1b . 
¡¡the region occupied by an object can change in a continuous or discontinuous way. for example  the initial 

wave front in figure 1 is split into two parts when hitting the interface. changes are caused by the dynamic and the static field. in the case of seismic waves  discontinuities caused by the static field can be characterized precisely: if the velocities of a zone are changing continuously  a  convex  wave propagating through this zone will change continuously. discontinuities in the velocity field however cause discontinuities in wave propagation. 
   in order to keep track of causes for discontinuous changes  we divide the static field into regions and obstacles. a region is a  maximal  coherent subset of s that does not contain discontinuities in the static field. the regions of the seismic velocity field are also called geological layers. an obstacle separates one  two  or several regions. it is a  maximal  coherent subset of s of discontinuity points in the static field. its dimension is inferior to that of s. the geological model of figure 1 is composed of three 1d-regions of constant velocities  which are separated by three id-obstacles called interfaces. the interfaces are linked by a corner which is a od-obstacle. regions  interfaces  and corners constitute a place vocabulary in the sense of  hayes  1b; forbus  1 . 
   thus  we divided the static field into regions where motion of dynamic objects is continuous and into obstacles which disturb motion in a discontinuous way. we now use this topological structure to divide the global histories into episodes of dynamic objects and incident events linking these episodes. we require that a dynamic object is contained into a single region. if it reaches an interface then the continuation of its history on the other side of the interface is considered to be a new object  namely the transmission of the incident object. a dynamic object is an episode of the global history that is contained in the static history of a certain region. 
   an incident is the event when a dynamic objects hits an obstacle. it is in fact the intersection of the history of the dynamic object w i t h the history of the obstacle. the incident is caused by the incident object and causes itself new objects in the regions surrounding the obstacle. the global history is branching at the incidents as illustrated in figure 1. an incident is the start of the histories of the waves it causes and it links them with the history of the incident wave 
   thus  we have structured histories in the dynamic fields into dynamic objects  incidents  and their causal relation. in fact  we have adapted the basic concepts of naive physics  hayes  1b  to physical fields and now have a vocabulary for interpreting the simulated fields. 
1 	interpreting snapshots 
1 	detecting static histories 
first we show bow to decompose the static velocity field into geological layers and interfaces. thus  we obtain the regions where to look for waves and the obstacles where to look for incidents. 
¡¡let {v n  be a grid and / : v - r be a field. we define regions as follows: let c c n be a symmetric criteria that specifies whether two neighbour points belong to the same region. we consider the reflexive transitive closure of c and denote it by c. c* is the smallest superset of c that is reflexive and transitive. since c is symmetric  c is an equivalence relation. the regions are obtained as the equivalence classes of c* the cregion of a point p e v is defined as the equivalence class containing ; : 
		 1  
to define regions in the velocity field v of seismic waves  we link two neighbour points if there is no discontinuity between them. since grids have a fixed resolution  we use a threshold i to operationalize this criteria. the velocity difference of two points must be smaller than e: 
		 1  
the geological layer of point p is then the equivalence class fiv{p . 
   next we define interfaces separating two c-regions r  and r1 an interface is just a set of neighbourhood links  p q  € n that do not satisfy the given criteria c and that connect a point in r  with a point in r1'. 
		 1  
the set i r1 r1  is called c-interface between r1 r1 iff 1 r1  r1  is not empty. the geological layers are separated by v-interfaces. for the sake of brevity  we neither discuss corners  nor the case that the interface between two regions is interrupted by a third region. 
1 	d e t e c t i n g o b j e c t s in a s n a p s h o t 
in the next sections  we consider a sequence of snapshots a 1  a 1  a 1  .. . showing the amplitude field at increasing time points t l  t 1  t 1 ¡ö ¡ö ¡ö¡ö we proceed in three steps in 
order to detect histories of wave objects. first  we identify wave objects in a single snapshot. then  we link the possible interpretations of succeeding snapshots. after that  we show how to detect histories of new objects caused by incidents at interfaces. 
¡¡wave fronts as shown in figure 1 consist of a small number of oscillations. in a snapshot  they appear as thin regions of negative or positive amplitudes  which can clearly be distinguished from the background having zero amplitude. to capture this phenomena formally  we divide the set v of points into three classes: positive  negative  and zero ones. since there are small distortions in the simulated field  we use a  to define the zero class. let a - be the amplitude field of the i-th snapshot:   1  
	junker and braunschweig 	1 



	junker and braunschweig 	1 


this example shows that it is possible to interpret snapshots by a qualitative analysis of zero regions and their neighbourhood relationships. this method can be extended to other kinds of waves such as diffracted waves. problems are encountered if 1. fronts end in a region without enclosing it and 1. two fronts of a different origin are linked without showing an indication where this link can be found. in order to treat these problems  we need additional physical knowledge that cannot been extracted from the images. in  junker  1   a wave front has been characterized by a sequence of rays called polyray  cf. figure 1 . polyrays provide the additional knowledge  but are difficult to manage when traversing curved interfaces. a compromise could be the use of two auxiliary rays marking the left and right ends of wave fronts to meet the problems of the qualitative interpretation method. 
1 	related work 
recent work demonstrates the power of augmenting numerical simulation with qualitative notions.  forbus and falkenhainer  1  define the notion of self-explanatory simulations where the simulator itself is able to explain its behavior: 
a self-explanatory simulation integrates qualitative and numerical models to produce accurate predictions and causal explanations of the behavior of continuous physical systems. 
they illustrate this definition with the simgen program on physical systems simulated by ordinary differential equations. 
   other examples of programs mixing quantitative simulation with qualitative notions can be found in the ai literature : the most famous being q1  kuipers and berleant  1   poincare  sacks  1   the kineticist's workbench  eisenberg  1   and others  yip  1    zhao  1 .  forbus  1  addressed an extension of qualitative reasoning to spatial information. in this work  forbus advocates that  in order to be able to reason about  spatially distributed system  one needs to mix two representations which he calls a metric diagram  the quantitative part   and a place vocabulary  the symbolic part . the metric diagram is used for calculation whereas the place vocabulary is used for describing the system's behavior at a more abstract level  and for guiding the numeric computations which take place on the metric diagram. moreover  these two representations are intertwined so that there is a correspondence between the places identified by the place vocabulary  and the quantities manipulated in the analog representation. in a more recent paper  forbus  1   he proposes six challenge problems for spatial reasoning  the fourth one being : 
develop a system which can  given a sequence of weather maps for a region  provide a consistent qualitative explanation of the atmospheric behavior during that period ... 
the problem we have addressed is very similar: given a sequence of 1d snapshots of seismic amplitudes within the underground  our method provides a consistent qualitative explanation of the propagation of acoustic waves during that period. this has been achieved by effectively integrating several representations  namely a metric diagram  i.e. fields  used for simulation and a place vocabulary  i.e. objects  describing the geological structures.  junker  1  additionally experimented with a physical representation based on rays. 
   research in qualitative and model-based reasoning has focused since its beginning on systems that could be simulated by ordinary differential equations  odes . numerical simulators using differential equations can be divided into two classes: those using scalar variables and those using field variables. scalar variables describe different quantitative properties of a system and are not distributed over a space. good examples of this class of systems are simple physical devices  chemical processes  chemical kinetics  global socio-economical models  or econometric models. in contrast to this  field 

variables are distributed over a space  often related to the real world in one  two or three dimensions. within this category  we can distinguish between fields of scalar variables and fields of vector variables. different simulation techniques are used for approaching this kind of problems. finite difference and finite elements are the conventional tools used by applied mathematicians for the simulation of field variables. examples are fluid dynamics  geophysics or mechanics. other approaches for field variables are naive physics and cellular automata  the basis for a number of a life experiments such as conway's game of life. 
1 	conclusion 
we developed a method for interpreting snapshot images produced by finite element  simulators for seismic wave propagation. as a result  the regions in the images are linked with hayes-like histories of waves: 
1. in order to detect wave fronts in a snapshot  we characterized them by the zero regions in the background they are enclosing. the first  snapshot contains a single front enclosing the zero region that contains the source point. 
1. symbolic constraints are posed on the zero regions to track a given wave from one snapshot to the other and to detect new waves. we obtain new waves when wave histories intersect with the static histories of obstacles. 
a first prototype of a snapshot interpreter which is called sismonaute  junker  1  has been implemented using the iloc tools l e l i s p   a i d a   and s m e c i . this experience enabled us to find the crucial concepts for characterizing waves and for describing histories  as well as symbolic constraints  which enables the use of constraint programming tools to find globally consistent interpretations. 
¡¡as a future perspective  the interpretation method could be adapted to other kinds of numerical simulations 
 e.g. that of flame fronts in simulations of combustions . 
acknowledgements 
this work was initiated by alain bamberger  ifp  and significantly supported by laurence nicoletis  laurent anne  jean brae  ifp  and michel gondran  edf . furthermore  the authors would like to thank claude le pape and the anonymous referees for their suggestions and comments. 
