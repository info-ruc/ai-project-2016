            insideoutside probability computation belief propagation                                                 taisuke sato                                       tokyo institute technology                             ookayamaË†  meguroku tokyo japan                           abstract                          bns  sato kameya  mcallester et al                                                         chavira darwiche  propositionalization      paper prove wellknown cor   mean represent discrete random variable having val      respondence forwardbackward algo                                                        ues vvn set xv xvn  mutually ex      rithm hidden markov models hmms                                                        clusive binary random variables xvi true iff      lief propagation bp applied hmms gen    vi  â‰¤ â‰¤ propositionalization explodes      eralized bp junction trees number states bn beneï¬t      generalized insideoutside probability compu weighs explosion makes possible share com      tation probabilistic logic programs applied putation ï¬ner grain size valuedependently runtime      junction trees                                   dynamic programming rule  probability compu                                                        tation compile time explains omit details    introduction                                       probability computation polynomial time                                                        expected direct application bns pcfgs pyna  bayesian networks bns probabilistic context free dath wellman  carried time  grammars pcfgs basic probabilistic frameworks sentence length prism casefactor  uncertainty modeling bns statistical natural lan diagrams cfds mcallester et al   guage processing respectively indepen follows ï¬rst review basic notions section   dently developed strong indication close prove main theorems series lemmas sec  relationship example include hidden markov mod tion  space limitations description sketchy  els hmms common subclass furthermore belief prop reader assumed familiar logic program  agation bp applied hmms coincides forward ming doets  bp junction trees jensen   backward algorithm hmms smyth et al  lauritzen spiegelhalter  shafer shenoy   specialization probability computation used inside prism probabilistic logic programming language used  outside io algorithm pcfgs baker  nonethe paper detailed sato kameya   exact correspondence  known knowledge                                  background    paper upgrade correspondence prove  insideoutside probability computation io algo  bayesian networks junction trees  rithm generalized probabilistic logic programs                                                        bayesian network bn directed acyclic graph deï¬n  applied junction trees yields bp particular prove                                                        ing joint distribution  xxn  xn   collecting evidence resp distributing evidence bp                                                        Î    xi   xi  Î i   Ï€i nodes random  coincides computation inside probabilities resp                                                        variables xxn node xi parent nodes  outside probabilities generalized io computation                                                        Î i  xs  xs  â‰¥  conditional probability table    prove computational correspondence bns                                                                     representing conditional distribution xi  xi  Î i  Ï€i  pcfgs uniï¬ed manner need general language                                                        associated xi  â‰¤ â‰¤ lower case  bns pcfgs choose prism sato                                                        letter xi denotes value xi similarly Ï€iwe  kameya  ï¬rstorder probabilistic language                                                        denote range xi rxi direct product  purpose need â€œpropositionalizationâ€of rx Ã—Â·Â·Â·Ã—rx       rÎ            âˆˆ rx                                                                        sk    write                                                            Ï€i âˆˆ rÎ i use xxn       assume paper bns discrete bp               Ï€   normalization                                                     consider                                                                         Ï€         âˆªÏ€    note bns propositional framework deal function itheset called argu  ï¬nitely random variables pcfgs allow recursion ments xi  Ï€iletÎ±  ssk set  deal inï¬nitely random variables describing prob variable indices âŠ†n xÎ± stands set                                                                                   Î±       abilistic choices sentence derivation           variables       sk  example                                                                ijcai                                                    xÎ±  xxx notation extends vectors    âˆˆ rv  introduce ground term iden    junction join tree ve bn isatreesat  tiï¬er ground msw atom mswi  isfying following conditions node set xÎ± true iff outcome nth trial named vhere  variables bn follows use xÎ± natural number iids represented set  dex set Î± interchangeably edge connecting Î± Î² mswi  âˆˆ rv   msw atoms                                                                                                   labeled Î± âˆ© Î² second xxn Î Î±âˆˆv Ï†Î±xÎ±   msw atoms satisfy certain conditions  prob  hold Ï†Î±xÎ±apotential function prod ability mswi true called parameter  uct conditional distributions prism program db  âˆª consists set  arguments included xÎ± condition run deï¬nite clauses head msw atom set  ning intersection property rip dictates nodes msw atoms base distribution pf deï¬ning  Î± Î² common variable contained probabilities parameters msw atoms  simple distri  node path Î± Î² rip ensures butions deï¬nable soley terms msw atoms com  conditional independence subtrees given variables plex distributions constructed using deï¬nite clauses  node key property efï¬cient probability com semantics db deï¬nes probability measure pdb Â·  putation bp given bn junction tree constructed set herbrand interpretations distribution seman  way triangulation variable elimination jensen  tics sato kameya  consider pdb Â·  kask et al  lauritzen spiegelhalter  distribution ground atoms    pcfgs insideoutside probabilities                                                          propositionalization through tabled search  pcfg cfg probabilities assigned produc                                            tion rules way nonterminal rules approach pdb probability atom   â†’  Î±a  â†’  Î±n  probability pi assigned ï¬ned program db  computed steps ï¬rst                            n  â†’  Î±i  â‰¤ â‰¤ nand pi holds pi step propositionalization apply sld refutation pro  probability choosing â†’ Î±i expand probabilis cedure doets  db â‡ topgoal search  tic derivation pcfgs basic tool statistical natural sld proofs reduce logically equiv  language processing include hmms subclass   alent propositional dnf formula âˆ¨Â·Â·Â· âˆ¨ ek    let ai denote event nonterminal prob ei  â‰¤ â‰¤ kanexplanation conjunction  abilistically derives substring wiwj sentence ground msw atoms record probabilistic choices   wwn  â‰¤ â‰¤ â‰¤ probability ai process constructing sld proof each  called inside probability ai deï¬ned msw atom represents probabilistic event   sum products probabilities associated rules random variable  second step compute  derivation belonging ai similarly outside proba probability pdb gpdb âˆ¨Â·Â·Â·âˆ¨ek  bility ai wrt sum products probabil general exponentially proofs  ities associated rules used derivation starts explanations naive proof search produce  start symbol derives wwiâˆ’awjwnthe  exponential size dnf fortunately introduc  product insideoutside probabilities ai gives ing tabling ï¬rst step produce equiva  probability deriving ai insideoutside probabil lent polynomial size boolean formula common                                                    ities computed dynamic programming time ol  subexpressions eiâ€™s factored tabled atoms  generalize insideoutside probabilities context factored formula explg set conjunction  probabilistic logic programming                   deï¬nitions form â‡”  tabled atom                                                         deï¬ned conjunction tabled atoms    probabilistic logic programming language         msw atoms assume deï¬ning relation       prism                                            tabled atoms acyclic convenience think  brieï¬‚y explain probabilistic logic programming lan each deï¬nition andor graph conventionally  guage prism nutshell prism prolog extended explg explanation graph collection  tabling probabilistic builtin predicate called msw multi andor graphs explg stands factored  ary random switch generic parameter learning routine formulas graphical representation  learn parameters embedded program computing  generalized insideoutside probabilities sato kameya  generalized insideoutside probabilities      basic ideas prism propositionalization compute pdb convert each deï¬nition â‡” âˆ¨                                                        âˆ¨a    explg         âˆ§Â·Â·Â·âˆ§b   âˆ§      âˆ§Â·Â·Â·âˆ§  random variables using special builtin predicate msw                mi  msw  let discrete random variable set rv   ground terms range represent proposition                                                                                                require pf mswi âˆ§ mswi                                                                                                                                                   âˆˆ  rv  pf       mswi     tabling means memoize goals predicate symbol                      vâˆˆrv                                                                                      i  declared table predicate cache successful goals table vâˆˆrv  msw holds alsowhen  later reuse zhou sato  atom containing table  n mswi mswinv independent  predicate called tabled atom                    mswi mswi nv identically distributed                                                    ijcai                                                    mswni  â‰¤ â‰¤ numerical sumproduct equation                                                                                              pdb hpdb      aÂ·Â·Â·   pdb al        pdb aipdb     Â·Â·Â·pdb bmi Â·                               pdb msw Â·Â·Â·pdb mswni     note conversion assumes mutual exclusiveness                                                                                   disjuncts aal independence conjuncts     root                                                                                         bbmi  mswmswni  guaranteeing         node  conditions basically userâ€™s responsibility  automatically satisï¬ed far prism pro  gram describing junction trees concerned section                              eqg  lemma  denote      set converted           figure  junction tree   ve  equations    ground atom pdb pvariable  pvariables just numerical variables named ground  belief propagation generalized io  atoms assume deï¬ning relation tabled atoms  computation  acyclic pvariables eqg linearly ordered  eqg efï¬ciently solved bottomup manner section prove generalized io computation  dynamic programming time proportional size computation generalized insideoutside probabili  eqg acyclicity implies higher pvariable ties subsumes bp junction trees  multivariate polynomial lower pvariables  derivative higher pvariable function  program bp messages  lower pvariables                             suppose bn deï¬ning joint distribution                                                                                   suppose given program db  analogy xxn   xn Î ip   xi  xi   Î i  Ï€i  insideoutside probabilities pcfgs deï¬ne gener junction tree ve xxn                                                                                              alized inside probability insidea ground atom Î Î±âˆˆv Ï†Î±xÎ±letÎ´ root node            def                                                                          db         âˆª  insidea                                        construct prism  program                             db    extend deï¬nition                                                                   def               describes bp  follows  introduce each  junction ground atoms insidew   pdb   conditional probability xi  Ï€i ground msw atom      deï¬ne   generalized outside probability mswbni Ï€i oncexiifxi parent Ï€i   outsideg  wrt topgoal follows null list deï¬ne ï¬nite set ft msw atoms  enumerate aâ€™s occurrences explg                                                                 def                                                            ft     mswbni Ï€i oncexi             â‡”  âˆ§    âˆ¨Â·Â·Â·âˆ¨a âˆ§                                                                  â‰¤ â‰¤ nxi âˆˆ rxiÏ€i âˆˆ rÎ i                Â·Â·Â·                                                                        Î¸           hj â‡”  âˆ§ wj âˆ¨Â·Â·Â·âˆ¨a  âˆ§ wjij          set parameters bniÏ€ixi                                                          Î¸          pf mswbni Ï€i oncexi  xi  Ï€i  outsideg  recursively computed eq    bniÏ€ixi    outsideg                                     easy joint probability represented                                                                                       conjunction ground msw atoms    outsideg  aoutsideg      insidewj                                                                                                            Â·Â·Â· outsideg   ij  insidew                                                                      jj          xxn pf    mswbni Ï€i oncexi                                                     using eq  outside probabilities computed time introduce atom mswbni Î i oncexi           eqg  size     sato kameya  prove taining variables xi Î i each  â‰¤ â‰¤                               insidea Â· outsidea  ground atom  product                  mswbni Î i oncexi represents conditional distribu                                                                             average number occurrences proof tion xi  xi  Î i  Ï€i  node Î± junction  deï¬nition generalization usual deï¬nition tree  deï¬ne conjunction wÎ±xÎ± representing poten  insideoutside probabilities pcfgs lafferty  tial Ï†Î±xÎ± Î± introduce clause cÎ± deï¬ning mes                                                        sage atom qÎ±Î³xÎ±âˆ©Î³  describes message bp sent         mentioned pdb pvariable function                                                             pvariables pdb mathematical deï¬nition follows simplicity assume evidence given  outsideg                                      variables observed conclusions remain                                                        valid ï¬xed observed values                                                                                       def âˆ‚pdb                   programming convention follows prolog               outsideg                                                            âˆ‚pdb                     use intentionally xi logical variable                                                        random variable make explicit correspondence gen  derives eq                                   eral msw atoms conditional distributions bn                                                    ijcai                                                                    Î±                Î³                                    â§               parent node  respectively deï¬ned     â‡      bn  âˆ§                                                                        âª   Î³   msw                                                                                       âª                         def                                            âª          mswbn xxxâˆ§                wÎ±xÎ±                 mswbni Î i oncexi        âª                              xiÏ€iâˆˆÏ†Î±                              âª                                  def                                                 â¨âª          Î±Î³                              â‡   âˆ§                 Î±      Î±Î³   Î±âˆ©Î³      Î±   Î±                                qÎ±Î³ xx â‡                                                                    rt                            qÎ² Î±xÎ²  âˆ©Î± âˆ§Â·Â·Â·âˆ§qÎ²  Î±xÎ²  âˆ©Î±                     bn  âˆ§                                                                    âª     msw                       Î²Î±                                                                            âª       â‡                                                                        âª   Î²Î±                   Î²Î²k  â‰¥  child nodes Î±    âª                                                                        â©âª    mswbn xx âˆ§                                     wÎ±xÎ±              lemma states     correctly describes          mswbn xx              potential node Î± proof straightforward omitted              lemma                                                                        figure  deï¬nitions message atoms               pf wÎ±xÎ±                xi  Ï€iÏ†Î±xÎ±                                ip Ï€ âˆˆÏ†                                      Î±                         deï¬nition tabled atom qÎ±Î³ xÎ±âˆ©Î³  node Î±                                                                   shown                                                                                                                                             Î´                                           â‡”            âˆ§                       root node  parent add special Î±Î³ Î±âˆ©Î³         Î±  Î±     Î²iÎ±  Î²iâˆ©Î±                                                                                 Î±Î³              parent node  deï¬ne Î´                                                                                             def                                            xÎ±âˆ©Î³ denotes arbitrary ground instantiation xÎ±âˆ©Î³                 cÎ´    qÎ´ â‡ wÎ´xÎ´âˆ§                                                                    qÎ±Î³ xÎ±âˆ©Î³  represents message sent Î± Î³ Î±â€™s                              qÎ² Î´xÎ² âˆ©Î´ âˆ§Â·Â·Â·âˆ§qÎ² Î´xÎ² âˆ©Î´                                                k    k          parent node receiving messages Î±â€™s child nodes                                                                  Î²Î²k figure               Î² Î²  child nodes Î´ qÎ´ ar                                                                   prove recursive equations eq               guments calls message atom directly indirectly                                                                    â€œsolvedâ€ uniquely let tÎ± subtree rooted xÎ±              finally                                                                    xÎ¾Î± set variables appearing tÎ±weï¬rstin                                                                                    Ï„Î±xÎ¾     Î±                            def                                     troduce formula    Î±   eq  rewrite                        rt    cÎ±   Î± âˆˆ vt ve              eq  represents potential subtree tÎ±                illustrate small example discrete bayesian             def                                                                             Ï„Î±xÎ¾             wÏxÏ                             network bn xx lefthand side fig          Î±         ÏâˆˆtÎ±                                                                                                 k              ure  junction tree  righthand side             wÎ±xÎ±  âˆ§      Ï„Î² xÎ¾                                                                                                        Î²i                   root node Î³ dotted lines bn indicate edges added tri              angulation figure  shows deï¬nitions message atoms lemma                                                                                                                                                       Î¾      Î± âˆª    Î¾                                                                          Î±            Î²i                                                                        Î¾Î²i  Î³ Î¾Î²i   Î± âˆª Î²i âˆ© Î±  Î³ rip                                                       px                                                    px                             k                                                                   Î¾Î±  Î³ Î±     Î³ âˆª    Î¾Î²  Î±                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               px                      proposition  qÎ±Î³ xÎ±âˆ©Î³      Ï„Î±xÎ¾Î±                                                                                                       xÎ¾Î±Î³                                                                                                                                                       proof wellfounded induction whenÎ± leaf                                                                     proposition obviously true assume true wrt                                                                                                                                                              child nodes Î±                                                  px                                                                                                                          px                                                                         Ï„Î±xÎ¾                                                                    Î±                                                                                                                                     Î¾Î±Î³                                                                                                                                                         Â·Â·Â·     Ï„Î±xÎ¾Î±  eq                      bn                 junction tree                                                                                                                                                            Î±Î³ Î²Î±   Î²k Î±                                                                          Î±  Î³ Î²i  Î±â€™s mutually disjoint                        figure  bn junction tree                  â›             â›              ââ                                                                                        k                                                                                  â             â              â â                                                                                wÎ±xÎ± âˆ§           Ï„Î² xÎ¾                                                                                                         Î²i     eq                 explanation graphs bp messages                     xÎ±Î³            xÎ¾ Î±                                                                                                Î²i                 db     âˆª                                                                                      let          program constructed subsec                  k              tion  declaring qÎ±Î³ predicate table predi                                                                               wÎ±xÎ± âˆ§    qÎ²iÎ±xÎ²iâˆ©Î±  induction              cate apply tabled search proofs topgoal â‡ qÎ´                                                                          xÎ±Î³                        Î´ root node  search terminates                                                                                          yields explanation graph explqÎ´ contains   Î±Î³  Î±âˆ©Î³  eq                qed                                                                ijcai                                                                  bp generalized io computation              proof                                       db  let  db distribution deï¬ned          insideqÎ±Î³ xÎ±âˆ©Î³   generalized inside probability  tabled atom                                                                                  db Î±Î³  Î±âˆ©Î³  insideqÎ±Î³ xÎ±âˆ©Î³  generalized outside proba                                 outsideq                                                Ï„    bility       Î´  Î±Î³  Î±âˆ©Î³   wrt Î´ computed           db        Î±   Î¾Î±   proposition                                                                         xÎ¾Î±Î³  using eq  sumproduct computation speciï¬ed eq                                                                           Ï„                                                                       db  Î±  Î¾Î±  lemma   independence conjuncts mutual exclusiveness      Î¾Î±Î³         disjuncts righthand side eq  guaranteed             Â·Â·Â·            Â·                                                                                  db  Î±  Î±                                                                   Î±Î³  Î²Î±      Î²k Î±    each msw atom mswbni Î i oncexi occurs                                                                                  Ï„     wÎ± reï¬‚ecting fact conditional            db Î²i  Î¾Î²    eq                                                                                    â›             â  distribution function xi  Ï€i bn belongs exclu                                                                                k           sively potential Ï†Î± junction tree wÎ±xÎ±                            â             â                                                                   pdb  wÎ±xÎ±   pdb         Ï„Î² xÎ¾   qÎ² Î±xÎ² âˆ©Î±â€™s share msw atoms                                      Î²i                                                                                  ï¬rst condition independence condition satisï¬ed au   Î±Î³                         Î²iÎ±  tomatically hand proving mutual exclu            k                                                                  Ï†xÎ±   pdb  qÎ² Î±xÎ¾ âˆ©Î±  siveness condition straightforward lemma                          Î²i    lemma   low assures exclusiveness condition combined   xÎ±Î³      proposition                                                       k            Î¾  âˆ© Î³  Î± âˆ© Î³                      note Î±           holds thanks rip sowe            Ï†xÎ±    insideqÎ² Î±xÎ¾ âˆ©Î±                                                                                      Î²i        qed  rewrite Ï„Î±xÎ¾Î±                                                                xÎ±Î³                  Ï„  Ï„                           Î±  Î¾Î±        Î±  Î¾Î±Î³   Î¾Î±âˆ©Î³                         Ï„                     theorem  tells generalized inside probabilities                           Î±  Î¾Î±Î±   Î±âˆ©Î³                tabled atoms satisfy exactly equations mes                                                       sages collecting evidence phase bp  lemma   let xÎ¾ Î³          different                   Î±           Î¾Î±Î³                     root node Î´ jensen  lauritzen spiegelhalter                           ground instantiations Î¾Î±Î³    arbi   shafer shenoy  bottomup computa  trary ground instantiation xÎ±âˆ©Î³ of xÎ±âˆ©Î³    tion generalized inside probabilities identical bp                           Â¬  Ï„Î±x    xÎ±âˆ©Î³  âˆ§ Ï„Î±x  xÎ±âˆ©Î³                    collecting evidence phase         Î¾Î±Î³            Î¾Î±Î³                                                                 let distribution deï¬ned bn figure   sketch proof loss generality  equations generalized inside probabilities tabled atoms                                      write  Î¾Î±Î³          im way ij   junction tree                                            parent node  ik original bn ij pre       xi                       xi  xi     cedes   list Î¾Î±Î³                          insideqÎ±Î³ xx  x    x  x                                               Î¾ Î³          im  variable                      bn  Â·    Î±                                                                   db msw                 x      x     x   â‰¤ â‰¤                                      isâˆ’    isâˆ’                                                                                       insideqÎ²Î± xx  ï¬rst note Î i  âŠ†  xÎ¾  holds xi appears                                          Î±                                         insideq                                                                                      Î²Î±      tÎ± conditional distribution xis  Î is              contained potential tÎ± rip second    insideq                                                                       Î²Î±              Î i âˆ© xÎ¾  Î³ âŠ†xi  xi           Î±               sâˆ’ wealsohave                     pdb       bn xx Â·                                                                         msw  Î i  âˆ© xÎ¾ âˆ©Î³  Î i    âˆ© xÎ±âˆ©Î³   conclude        Î±                                                                   bn                                   Î                          db msw             facts Î¾Î±Î³ Î±âˆ©Î³ instantiates                                                                                                 xis  Ï€is  xÎ±âˆ©Î³ instantiates xis  Î is            px  Â· px                     Î¾Î±Î³                                                 x  Ï€         x           rest immediate  omitted                                     qed     compute generalized outside probabilities                                                        tabled atoms loss generality compute    prove main theorems applying computation  outside probability tabled atom Î² apply  eq  tabled atoms deï¬ned eq  recall deï¬nition generalized outside probability eq   insideap                                   explq                                                  db    ground atom   db         Î´ noting tabled atom Î²Î± Î²âˆ©Î± oc  distribution deï¬ned db  derive equation curs explqÎ´ eq  obtain recursive equations  satisï¬ed inside probabilities tabled atoms     generalized outside probabilities follows    theorem                                            theorem                                                                                                                                        outsideq               Ï†                                                                    Î²Î±  Î²âˆ©Î±           Î±  Î±  insideqÎ±Î³ xÎ±âˆ©Î³    Ï†Î±xÎ±   insideqÎ² Î±xÎ² âˆ©Î±                             Î±Î²                                                             outsideq      insideq                         xÎ±Î³                                            Î±Î³  Î±âˆ©Î³          Î²iÎ± Î²iâˆ©Î±                                                                                                                                                              ijcai                                                    
