              QCSP Made Practical by Virtue of Restricted Quantiï¬cation

                      Marco Benedettiâˆ—, Arnaud Lallouet, and JerÂ´    emieÂ´ Vautard
                                      LIFO - University of OrleansÂ´
                              BP 6759 â€“ F45067 OrleansÂ´   Cedex 2, France
                                     name.surname@univ-orleans.fr


                    Abstract                          âˆƒxâˆˆ{1, 2, 3}âˆ€yâˆˆ{3, 4}âˆƒzâˆˆ{4, 5, 6}.x<yâˆ§x+y = z âˆ§z =3x
             +                                                                                        (1)
    The QCSP    language we introduce extends the      to be true? The most intuitive way of entering the new sce-
    framework of Quantiï¬ed Constraint Satisfaction    nario is by thinking of it as a game between two players. One
    Problems (QCSPs) by enabling us to neatly ex-     player is associated to the existential quantiï¬erâ€”we call him
    press restricted quantiï¬cations via a chain of nested the âˆƒ-playerâ€”the other is related to the universal quantiï¬er:
    CSPs to be interpreted as alternately conjuncted  the âˆ€-player. The goal of the âˆƒ-player is to satisfy each con-
    and disjuncted. Restricted quantiï¬ers turn out to straint, hence to satisfy the whole CSP. The goal of the âˆ€-
    be a convenient solution to the crippling modeling player is to violate at least one constraint, thus overcoming
    issues we encounter in QCSP andâ€”surprisinglyâ€”     the opponentâ€™s effort. The two players play against each other
    they help to reuse propagation technology and to
                                +                     in turn, for a ï¬nite and ï¬xed number of rounds. The moves
    prune the search space. Our QCSP solverâ€”which     they do consist in assigning values to variables. Which vari-
    also handles arithmetic and global constraintsâ€”   ables get assigned at each step is statically decided by the
    exhibits state-of-the-art performances.           left-to-right order in the preï¬x of the problem (in our exam-
                                                      ple, the preï¬x is â€œâˆƒx âˆˆ{1, 2, 3}âˆ€y âˆˆ{3, 4}âˆƒz âˆˆ{4, 5, 6}â€).
1  Introduction                                         In (1), the âˆƒ-player plays ï¬rst, and he is given the chance
We extend the QCSP (Quantiï¬ed Constraint Satisfaction to choose a value for x. Then, it is time for the âˆ€-player to
Problem) framework by introducing a new language, called assign a value to the variable y. Finally, the âˆƒ-player assigns
QCSP+. Such extension is motivated by the difï¬culties we z and the game terminates: The satisfaction of the set of con-
experienced in modelling and solving most non-trivial prob- straints is evaluated. We say that such quantiï¬ed CSP (QCSP)
lems as plain QCSPs. So, let us start by describing (Q)CSP, is true if the âˆƒ-player has a winning strategyâ€”i.e. if he can
in order to point out some of its modeling weaknesses. manage to satisfy every constraint whatever the universal op-
  A CSP is a search problem established by giving a set of ponent doesâ€”and is false otherwise. For example, (1) is true,
variables ranging over ï¬nite domains, and a conjunction of while it becomes false if we change the preï¬x to âˆ€xâˆƒyâˆ€z.As
constraints mentioning such variables. For example, given opposed to the purely existential CSP case, the order of quan-
x âˆˆ{1, 2, 3}, y âˆˆ{3, 4}, and z âˆˆ{4, 5, 6}, the CSP    tiï¬ers is important: By ï¬‚ipping y and z in (1) we play under
                                                               âˆƒ âˆƒ âˆ€
                  âˆ§   +   =   âˆ§  =3                  the preï¬x x z y, and the existential player looses the game.
             x<y     x  y   z   z   x                   QCSP is widely believed to be strictly more â€œpowerfulâ€
is solved by selecting (if possible) one value for each variable than CSP: An entire hierarchy of QCSP problems exists for
in so as to satisfy the three constraints at once. For example, which no equivalent CSP formulation can be written â€œcom-
x =1, y =4, z =5is a valid solution, while x =2, y =4, pactlyâ€ (QCSP is PSPACE-complete, CSP is NP-complete).
z =6 is not. CSP formulations are naturally suited to model Some of these problems are openly perceived as games by hu-
real-world problems, and countless applications exist indeed. mans (i.e. board games), while in others the underlying game
  For the sake of this paper, a CSP problem is best viewed structure is camouï¬‚aged (see Section 2).
as a decision problem in which all the variables are quanti- Despite the expectation engendered by the strength of the
ï¬ed existentially (i.e. the existence of one single consistent language, we ï¬nd in the literature no single account of a real-
assignment sufï¬ces to answer the problem positively): world model1 actually solved by a QCSP solver. Why?
âˆƒxâˆˆ{1, 2, 3}âˆƒyâˆˆ{3, 4}âˆƒzâˆˆ{4, 5, 6}.x<yâˆ§x+y = z âˆ§z =3x   A partial explanation is that QCSP solvers are in their in-
                                                      fancy and miss most (quantiï¬ed) constraint propagators, i.e.
The seemengly inconsequential amendment of making quan- forward inference rules that are vital to cut the search space.
tiï¬ers explicit leads us to play in an entirely new ï¬eld [Bor-
deaux and Monfroy, 2002]: What if (some of) the variables 1By real-world model we mean any model designed to cap-
are quantiï¬ed universally? For example, what means for ture the pre-existing and human-intelligible semantics of some
                                                     problemâ€”e.g. the ones in Section 2â€”as opposed to random models
  âˆ—This author is supported by â€œLe STUDIUM R â€ (France). that obey merely syntactical generation patterns.

                                                IJCAI-07
                                                   38This limitation discourages or prevents people from invest- all...â€. We can reshape the above formula as a prenex QCSP
ing in the production of realistic models. However, we have as we realize that the â€œsuch thatâ€ connective stays for a con-
recently built a full-ï¬‚edged QCSP solver [Benedetti et al., junction when âˆƒ-player is involved, and for an implication
2006b], which manages several constraints. Even so, models when âˆ€-player is concerned. So, we actually ask whether
                                                                 âˆ€        âˆƒ        âˆ€        âˆƒ
of many â€œnaturalâ€ cases stay surprisingly difï¬cult to devise. âˆ€X1(L1 â†’âˆƒY1(L1 âˆ§âˆ€X2(L2 â†’âˆƒY2(L2 âˆ§ C))))   (3)
  To pinpoint the problem, let us take a step back to QCSP as or, in an equivalent prenex form with explicit disjunction, if
a game between âˆƒ and âˆ€, and let us observe that with games
                                                            âˆ€   âˆƒ  âˆ€  âˆƒ   ( âˆ€ âˆ¨ ( âˆƒ âˆ§ ( âˆ€ âˆ¨ ( âˆƒ âˆ§ ))))
almost invariably come rules: Some choices could be pre-     X1  Y1 X2 Y2. L1   L1   L2   L2  C        (4)
cluded as a function of previous choices by the same player Statement (4) shows that the most natural way to express re-
or by the opponent. An elementary example is the prohibi- stricted quantiï¬ers would be to extend the language to handle
tion in most board games to play in a cell already occupied disjunctions. But, a shift to general non-conjunctive CSPs
by someone. In the QCSP game, this means that players can- would hamper the critical opportunity to inherit the huge
not in general assign variables in arbitrary ways. The set of amount of propagators already implemented for the purely
legal choices is dynamically restricted over a game life-span conjunctive case. We would fall back into the inability to ex-
in relation to the moves already occurred, so to comply with ercise CSP tools on real problems, by having a nice formalism
an underlying game discipline. The observance of such disci- with just a proof-of-concept or no implementation at all.
pline is precisely what plain QCSPs ï¬nd difï¬cult to enforce. Our solution is to design a limited disjunctive extension of
  No support for dynamic ranges of variables is provided by the QCSP formalism, which is (i) enough to express all the
the preï¬x: In (1) z ranges over {4, 5, 6} whichever the values disjunctions originating from the use of restricted (universal)
chosen for x and y. So, we have to embed the game dis- quantiï¬cations, but is (ii) still capable of inheriting and exer-
cipline in the constraints. It is a matter of stating that if a cising the reasoning core of standard (Q)CSP solvers.

player chooses a forbidden value (or combination of values) âˆ€X1   From a FOL perspective, the syntactic shape of
he looses immediately. Such threat is promptly posed to the       the problems we introduceâ€”the QCSP+ prob-
âˆƒ-player: We consider the membership of the move to the set â†’     lems, generalizing Example (3-4)â€”is a chain
of legal moves as just an additional constraint. If the âˆƒ-player
                                                         âˆ€        of nested alternated quantiï¬cations with re-
cheats, he makes such constraint false, he looses the game. L1    strictions (depicted aside). This language is
                                       âˆ€                    âˆƒ
  No similar expedient can be used against the -player: The  Y1   cognitively adequate to represent game-with-
game is a loss for him when all the constraints are satisï¬ed,     rules scenarios (modelerâ€™s viewpoint, Section
a thing which simply cannot be imposed by just conjunct-    âˆ§     2), and at the same time is amenable to be de-
ing whatever additional constraint. Rather, to solve such âˆ€-
discipline problem we should slightly modify the whole for- âˆƒ     cided by reusing existing technology (solverâ€™s
                                                        L1        viewpoint, Section 3). Indeed, each restric-
malization. This reformulation-based approach has been pre- âˆ€X
sented in [AnsoteguiÂ´ et al., 2005] for the case of two-players 2 tion rule is a standard CSP, inside which the
QBF games but, for the reasons discussed in Section 4, it   â†’     usual propagation procedures can be capital-
comes out to be an unsatisfactory remedy to our problem.          ized. What is to be designed is (i) an exter-
So, let us introduce a different solution, based on handling âˆ€    nal search-guiding mechanism that evaluates
the game rules explicitly. As we shall see shortly, QCSP is L2    the truth value of the alternated chain of CSPs
not enough to plainly state the new formalization as it lacks
                                                             âˆƒXn  as a function of the truth value of the leaves,
support for disjunctions between constraint sets. Consider the    and (ii) an inter-leaf propagation scheme that
following problem (in which rules are provisionally absent)
                                                             âˆ§    reconciles the separate CSPs and makes them
           âˆ€X1âˆƒY1âˆ€X2âˆƒY2.C(X1,X2,Y1,Y2)          (2)               share information in a sound way. As a ï¬nal
                                                         Lâˆƒ
Let uppercase letters denote sets of variables rather than a n    note, let us observe that the â€œgame-with-rulesâ€

single variable (domains are not shown). Suppose the legal C(X1,Y1,...,Xn,Yn) scenario we target is deï¬nitely not a marginal
opening moves for âˆ€-player are characterized by a set of con-     modeling case. On the contrary, the usage of
               âˆ€
straints (a CSP) L1 (X1), i.e. an assignment to the variables restricted quantiï¬ers is so natural (see Section 2) that one
                                            âˆ€
in X1 is a legal opening move iff it is a solution to L1 in the ends up wondering which non-trivial problems can be mod-
classical CSP sense. Next, âˆƒ-playerâ€™s reply at second step eled as plain QCSPs! The relation between our approach and
                          âˆƒ
is constrained by some CSP L1 (X1,Y1): Once the choices recent contributions in the close ï¬eld of QBF decision pro-
over X1 from âˆ€-playerâ€™s side are known, an assigment over cedures is discussed in Section 4. The implementation of a
                                   âˆƒ
Y1 is to be considered only if it solves L1 . Likewise, rules full-ï¬‚edged solver and experiments on quantiï¬ed models are
 âˆ€                âˆƒ
L2 (X1,Y1,X2) and L2 (X1,Y1,X2,Y2) are provided. To cap- presented in Section 5. In Section 6 we summarize our con-
ture this scenario, we introduce restricted quantiï¬ers qX[L], tributions and present directions for future work.
with q âˆˆ{âˆƒ, âˆ€}: They quantify over X yet only span over
those assignments to X which comply with the CSP-based 2  Motivating Examples
rule L. With this compact notation, our example is written: The concepts involved in the modeling of the following com-
       âˆ€          âˆƒ              âˆ€
 âˆ€X1[L1 (X1)]. âˆƒY1[L1 (X1,Y1)]. âˆ€X2[L2 (X1,Y1,X2)].   mon problems are naturally captured as a conjunction of con-
               âˆƒ                                      straints. However, the questions we ask require universal
          âˆƒY2[L2 (X1,Y1,X2,Y2)].C(X1,X2,Y1,Y2)
                                                      quantiï¬ers and disjunctions in exactly the QCSP+ style.
                                                 âˆ€
 which reads â€œfor all the assignments to X1 such that L1 Problem 1 Suppose some (partial) ordering  is established
                                      âˆƒ
holds, exists an assignment to Y2 such that L1 holds and for to rank the solutions of a given CSP P . While a CSP is not

                                                IJCAI-07
                                                   39enough to compactly characterize the best solutions of P w.r.t. Problem 3 (Conformant Scheduling) Consider n tasks of
        +
, QCSP   gives to the problem an elegant one-move game duration Î´1 ...Î´n requiring an amount of resource r1 ...rn,
formulation: âˆƒX[P (X)]. âˆ€Y [P (Y )].Y  X.            and subject to the ordering constraints OâŠ†[1..n]Ã—[1..n], where
                                                      i, jâˆˆO means that task i must end before task j starts. We
In the following example [Cadoli et al., 1997], solutions to want to schedule the tasks so that (i) we ï¬nish by time T , (ii)
the CSP represent sets, and the âŠ† relation creates preferences. we comply with O, and (iii) the instantaneous resource con-
Example 1 (Strategic Companies) We are given a collec- sumption never exceeds a ï¬xed capacity R. A global con-
                                                            cumulative(                    )
tion C of companies, a set G of goods, and a relation ProdâŠ† straint   R, t1,Î´1,r1,...,tn,Î´n,rn is provided by
CÃ—G  to specify which goods each company produces. Com- most CSP solvers to check the latter condition. We have a
panies have reciprocal ï¬nancial participations, and a subset degree of uncertainty about the actual resources required by
 
C âŠ†C  that owns more than 50% of some câˆˆC is said to be a each task. An hostile environment can impact on them, sub-
                                                                             EM(         )
controlling set for c. A company may have many controlling ject to certain constraints r1,...,rn . Is it possible to
                                            C         devise an adversary-safe schedule?
sets. They all are represented by a relation ContrâŠ†2 Ã—C.A
                âŠ†
set of companies S C is â€œproduction-preservingâ€â€”written âˆƒt1,...,tn[âˆ§i,jâˆˆOti+Î´i â‰¤ tj ]. âˆ€r1,...,rn[EM(r1,...,rn)].
PP( )      ( )
   S â€”if it i covers all the goods in G, i.e. by cumulat- cumulative(R, t1,Î´1,r1,...,tn,Î´n,rn) âˆ§ max(ti+Î´i) â‰¤ T
ing the goods g such that c, gâˆˆProd and c âˆˆ S we obtain
G; and (ii) is closed under the controlling relation, i.e., for
       âˆˆ            âŠ†        âˆˆ                    Example 3  Consider three tasks to be completed within
each C ,c   Contr,ifC    S then c  S.Astrategic set          =4                                  =5
is any subset-minimal production-preserving set (i.e. the PP time T and without surpassing a capacity R , with
property is lost in each proper subset of a strategic set). A Î´1 =1, Î´2 =2, Î´3 =3, r1 =3, r2 =2, and r3 =1. Task 1 has
company x âˆˆ C is not strategic (intuition: it can be sold with to ï¬nish before Task 2 starts. We seek an attack-safe schedule,
no impact on either the overall portfolio of goods or the con-                          under the assump-
trolled companies) if it belongs to no strategic set, i.e. if                           tion that the en-
                                          
 âˆ€S[S âŠ† C âˆ§ PP(S) âˆ§ x âˆˆ S]. âˆƒS [PP(S ) âˆ§ x/âˆˆ S ].S âŠ‚ S                                  vironment can add
                                                                                        one unit of cost to
The Prod and Contr relations as deï¬ned above can be easily                              up  to two  tasks.
expressed in propositional logic. We adopted such restricted                            The  picture aside
version to enable a direct comparison with boolean reason-                              shows that the opti-
ers (Section 5). More realistic modelsâ€”mentioning explicit                              mal schedule (A) is
amounts of goods, capacity of production and percentage of                              subject to critical
participationsâ€”still ï¬t nicely in the CSP vocabulary, but they attacks, the linear schedule (B) exceeds T , while the solution
lay outside the natural reach of propositional logic. (C) to the our QCSP+ instance meets all the requirements.
Problem 2 (Game strategy) Let a set of variables Xi de-                                      +
scribe the state at step i of a system evolving after the al- 3 Formalizing and Deciding QCSP
                             âˆ€     âˆƒ
ternate moves of two opponents p and p , selected out of Let V be a set of variables and D =(Dv)vâˆˆV the family
a ï¬nite set of possibilities. A game is deï¬ned by a 4-tuple
PA SSA G  I                                         of their domains (hereafter we tacitly assume an underlying
   ,   ,  , of CSPs: A move M in a state X is only pos-                              âŠ†                 W
sible when the precondition axiom PA(X, M) is satisï¬ed and global version of V and D). For W V , we denote by D
                                                           Î 
leads to a new state X deï¬ned by the successor state axiom the set vâˆˆW Dv of tuples on W . The projection of a tuple t
        
SSA(X, X ,M). Initial and winning conditions are recog- (or a set of tuples T ) on a variable v (or a set of variables W )
                                                                  |     |                         =(    )
nized by I(X) and G(P, X) respectively (with P âˆˆ{pâˆ€,pâˆƒ}). is denoted by t v (or T W ). A constraint is a couple c W, T
                                                             âŠ†          âŠ†   W                      ( )
Let âˆ€ denote âˆƒ and vice-versa. The ï¬rst player pâˆƒ wins the with W V and T D   (W  and T are noted var c and
game in at most k rounds if âˆƒX0[I(X0)].WS(âˆƒ, 1), where sol(c)).ACSPS is a set of constraints. For a CSP C, we note
                                                      by var(C)=  câˆˆC var(c) its variables and by sol(C)=câˆˆC
   WS(q,i):=qXi,Mi[  PA(Xiâˆ’1,Mi) âˆ§ G(pq,Xiâˆ’1)âˆ§                                                     W
                     SSA(           )] WS(q +1)       sol(c) its solutions, whereâ€”for any W, U âŠ† V , A âŠ† D , and
                         Xiâˆ’1,Xi,Mi  .     ,i               U                   W âˆªU
                                                      B âŠ† D  â€”it is A  B = {tâˆˆD    | t|W âˆˆA âˆ§ t|U âˆˆB}.We
for i<2k, and WS(q,i):=G(pq,Xiâˆ’1) for i =2k.          name range over W âŠ† V any function R with domain W that
The next example shows QCSP+ escaping the intricacies of associates to each v âˆˆ W a subset R(v) âŠ† Dv.
game formalization we ï¬nd in e.g. [Gent and Rowley, 2003]. Deï¬nition 1 (Restricted quantiï¬er) A restricted quantiï¬er
                                               nÃ—m
Example 2 (Connect nÃ—mâˆ’k) Let B =(bij )âˆˆ{0,pâˆ€,pâˆƒ}     is a 4-tuple Q =(q,W,R,C) where q âˆˆ{âˆƒ, âˆ€}, W is a set of
be a matrix of variables representing the board state in a gen- variables, R is a range over W , and C is a CSP.
                                  Ã—
eralized Connect-4 game (played on a n m board in the at-              +           +
tempt to align k signs). The existence of a winning strategy Deï¬nition 2 (QCSP ) A QCSP with free variables F is
for the ï¬rst player is modeled by posing PA(B,x):=bnx =0, a couple (QS,G), where the quantiï¬cation structure QS is
where xâˆˆ[1..m] is the column of the current move, and using a ï¬nite (possibly empty) sequence [Q1,...,Qn] of restricted
                                                    quantiï¬ers Qi =(qi,Vi,Ri,Ci) for which it holds that
âˆ§iâˆˆ[1..n]jâˆˆ[1..m](bij =bij ) â†” (j=x âˆ§ bij =0âˆ§ bij =P âˆ§ biâˆ’1j =0)
                                                        â€¢ âˆ€i, j âˆˆ [1..n],Vi âˆ© F = âˆ… and i = j â‡’ Vi âˆ© Vj = âˆ…
           
as SSA(B,B  ,x), where P âˆˆ{pâˆ€,pâˆƒ} is the current player.                           S
                                                        â€¢ var(Ci) âŠ† Wi âˆª F with Wi = jâ‰¤i Vj
The initial condition I(B) is âˆ§ij bij =0. The G CSP is a con-
junction of allDifferent constraints excluding each alignment. and G is a CSP, called goal, with var(G) âŠ† Wn âˆª F .IfF = âˆ…
                                                      the QCSP+ problem is said to be closed.

                                                IJCAI-07
                                                   40Consistently with the examples already presented, we com- base case. It is cascade(([],G)) = ([], âŠ¥) if, for any v âˆˆ F ,
                     +                                                                    F
pactly denote such QCSP by writing:                       we have R (v)=âˆ…, where R = propG(R  ). Otherwise,
                                                          cascade(([] )) = ([] )
        q1V1 âˆˆ R1 [C1].....qnVn âˆˆ Rn [Cn].G                         ,G      ,G .
                       +                              inductive case. Let it be P =([(q,W,R,C)|QS],G) and
  Only two closed QCSP   with an empty quantiï¬cation                  F
               ([ ] )   ([ ] âŠ¥)                         R  =  propC (R  R). If for any v âˆˆ F âˆª W  it is
structure exists: ,  and   ,  , where    denotes the        
empty CSP, and âŠ¥  stands for any CSP which contains       R (v)=âˆ…, then  cascade(P )=([], ) if q = âˆ€, and
                                   +                      cascade( )=([] âŠ¥)  q=âˆƒ
an empty constraint. Given a QCSP     problem P  =                P     ,  if    . Otherwise (no empty range
                                                                    cascade(  )=([(q     |    )|QS] )
([(q1,V1,R1,C1),..., (qn,Vn,Rn,Cn)],G) with free vari-    in R ), it is      P        ,W,R  W ,C     ,G
                                                                (QS  )=cascade((QS   ))
ables F , the result of assigning the value aâˆˆDv to a variable where ,G              ,G   is computed using
                                                                                           âˆª     (QS  )
v âˆˆ F , written P [v = a], is deï¬ned as P =([(q1,V1,R1,C1[v = the new range R for the free variables F W of ,G .
a]),...,(qn,Vn,Rn,Cn[v = a])],G[v = a]), where the assign- The intuition is that propagation at the level of each restricted
ment to a CSP is in turn obtained by collecting the result quantiï¬er (q,W,R,C) is the â€œauthoritativeâ€ source of infor-
of the assignments to each constraint: Given a constraint mation about the new ranges of W . Conversely, for variables
c =(W, T ),itisc[v = a]=c if v/âˆˆ W . Otherwise, it is      ( )\
                                                in var C W a private temporary version of the ranges is em-
c = c[v = a]=(W ,T ) where W = W \{v} and T = {t âˆˆ    ployed where all the prunings realized by dominating scopes
 W        W        
D   |âˆƒt âˆˆ D  ,t|W  =t âˆ§ t|v =a}. This notion extends natu- are cumulated. Such collective result ï¬‚ows through the chain
                                            W
rally to tuple-assignments [W = t], with W âŠ† V , tâˆˆD .For of authoritative propagations to boost them, then vanishes.
                W                                                                   +
any W âŠ† V , t âˆˆ D , and any range R over W , let us write The alternated structure of QCSP endows cascade prop-
tâˆˆW R to mean âˆ€v âˆˆ Wt|v âˆˆ R(v).                       agation with an intrinsic advantage over the usual quanti-
Deï¬nition 3 (Evaluation of a QCSP+) Any closed QCSP+  ï¬ed arc-consistency of QCSP: It turns the global consistency
(QS,G) evaluates to a value in {true,false} as follows. check for values in universal domains into a local property,
         eval(([ ] ))=true  eval(([ ] âŠ¥))=false      decidable at the level of single constraints in the CSP rule
base case.      ,        and       ,        .         of restricted quantiï¬ers. This way, we expunge values from
                                           
inductive case. Let it be QS =[(q,W,R,C) |QS].Itis    both universal and existential domains, symmetrically, by just
    eval((QS,G)) = true iff: (i) q = âˆ€ and for all t âˆˆ W R (re)using quantiï¬cation-unaware CSP propagators.
                                                                                                    +
    such that tâˆˆsol(C),itiseval((QS ,G)[W =t]) = true,or We call validity preserving any mapping op : QCSP â†’
                                                            +                     +
    (ii) q=âˆƒ and there exists tâˆˆW R such that tâˆˆsol(C) and QCSP        âˆ€P âˆˆ QCSP    , eval(P )=eval(op(P ))
                                                             such that                                 ,
    eval((QS ,G)[W =t]) = true.                       and we say that op is a contractor if âˆ€P =(QS,G) âˆˆ
                                                            +                             
                                                      QCSP   , P =(QS  ,G )=op(P ) it is (i) |QS |â‰¤|QS|, (ii)
The decision procedure we implement closely mimics the     
           eval                                       var(P ) âŠ† var(P ), and (iii) for every (q,W,R,C) âˆˆQS,
deï¬nition of  , and is based on a classical depth-ï¬rst re-                            
cursive search of the and/or tree associated to a quantiï¬cation (q ,W ,R ,C ) âˆˆQS,ifv âˆˆ W âˆ© W then R (v) âŠ† R(v).
structure. As in CSP solvers, a form of forward-inference Theorem 1 Cascade propagation is a validity-preserving
(called propagation) is of key importance to prune the search contractor for QCSP+ problems.
space, and is exercised in each search node. What is peculiar
to QCSP+ is exactly the way this propagation operates, and The above property guarantees soundness and termination of
the way it builds on top of standard CSP propagation. the decision procedure, which performs cascade propagation
                                                                                    [                   ]
  We model a CSP propagation scheme as parametric func- at each search node. For details see Benedetti et al., 2006a .
    prop (Â·)
tion   P   â€”where the parameter P is a CSPâ€”whose do-  4   Discussion and Related Works
main and co-domain are the families of ranges over var(P ).
                                                     Concerns about the unsuitability of QCSP to model real cases
The result R = propP (R) of a propagation over R is meant
                                                      have not been raised so far2: Current random models do not
to contract the range of each variable (hence to reduce the                                         +
branching factor of the search) while preserving the solu- clash with the issues addressed in this paper. QCSP has
tions of P . This means that for any variable v âˆˆ var(P ) been designed in fact to provide crucial beneï¬ts in the up-
     
it is R (v) âŠ† R(v), but at the same time for each solution coming development of more realistic models.
                                                                        âˆ€
t âˆˆ sol(P ),ift|v âˆˆ R(v) then t|v âˆˆ R (v). Propagation is The existence of a â€œ -disciplineâ€ issue in quantiï¬ed con-
computed by a chaotic iteration as the greatest common ï¬x- junctive languages has been recently identiï¬ed by the QBF
point of the domain-reduction operators associated to each community [AnsoteguiÂ´ et al., 2005]. A static version of the
constraint c âˆˆ P , where the operator for c prunes values that same question has been discussed for the case of QBF encod-
fail a local consistency check against c [Apt, 1999]. ings of multi-valued QCSP variables whose boolean mapping
                                                                                      [             ]
  If R1 is a range over W1 and R2 is a range over W2 (W1 âˆ© needs to avoid â€œillegalâ€ combinations Gent et al., 2004 .
W2 = âˆ…), we deï¬ne R = R1  R2 as R(v)=R1(v) if v âˆˆ W1   This problem impacts on QCSP remarkably more than
and R(v)=R2(v) if v âˆˆ W2. We note projections of ranges on QBF: The latter does not bother at all with the mod-
                  |        |  =         |   =         elerâ€™s viewpoint, as it is not required for a human to write
onto sub-domains by , so e.g. R W1 R1 and R W2 R2.
  The analogous of propagation in QCSP+ is as follows. or understand a QBF speciï¬cation. Such QBF is obtained
                                                      through a computer-assisted compilation which starts from
Deï¬nition 4 (Cascade Propagation) Given a propagation
                  +                        F
scheme prop, a QCSP problem P , and a range R for the    2
                           +                             Such weakness is being quickly realized, as witnessed by the
free variables F of P , the QCSP problem cascade(P ) ob- independent proposal of a framework focusing on simplifying the
tained by cascade propagation from P is deï¬ned as follows. QCSP modeling of two-player games [Bessiere and Verger, 2006].

                                                IJCAI-07
                                                   41some higher-level language and terminates in a process called
CNF-ization. This consists in casting the meaning of any
structured formula into a CNF by conjuncting the clause-
based local meaning of each sub-formula through the help
of auxiliary variables [Plaisted and Greenbaum, 1986].A
natural workaround to the discipline problem comes out of
this mechanism: We reduce to a conjunctive matrix the entire
meaning of e.g., (4). This trick has since ever been adoptedâ€”
often tacitlyâ€”in QBF models, and is the reason why a library
of real-world instances exists [Giunchiglia et al., 2001].
  A more structured QBF encoding techniqueâ€”applied to
two-player gamesâ€”has been proposed in [AnsoteguiÂ´ et al.,
2005], where indicator variables are introduced to connect in
a suited QBF the SAT-PLAN propositional encoding of pre-
conditions, effects, etc [Kautz and Selman, 1992]. However,
this approach is shown to lead search-based solvers to ex- Figure 1: Running time comparison over the â€œStrategic Companyâ€
plore artiï¬cially enlarged search spaces, an effect which can family (Example 1, Section 2). The x axis gives the number of com-
                                                      panies in the set. We compare QeCode with state-of-the-art QBF
be mitigated either by employing encodings tuned to trigger                               +
a synergy between top-down search and boolean inference solvers, and the QBF formulation with the QBF one.
mechanisms, or by feeding the solver with information on the plicitly deï¬ned table constraints. Yet no viable solution ex-
special role of indicator variables. More recently, DNF rep-
                                                      ists if the C1âˆ’3 are (as they usually happen to be) sets of
resentations for boolean constraints have been adopted to re- possibly arithmetic/global constraints. Another option is to
                  [                              ]
duce the search space Sabharwal et al., 2006; Zhang, 2006 . use the reiï¬ed version of each constraint [Bordeaux, 2005].
  These approaches involve intricate details, or do not intro- The reiï¬ed version of C(X) is an always consistent constraint
                                                                                                
duce explicitly a language/semantics. They demand search- C (X, y), where y âˆˆ{0, 1}, which is satisï¬ed as C (X, 1) if
                                                                               
based solvers, or exploit boolean-only concepts (e.g. DNF), C(X) is consistent, and as C (X, 0) otherwise. So, we can
or focus on (human-level) games rather than on the general                              
                                                      write âˆƒX.âˆ€Y.âˆƒa, b.C1(X) âˆ§ C2(X, Y, a) âˆ§ C3(X, Y, b) âˆ§ (Â¬a âˆ¨ b)
issue of modeling concepts through quantiï¬ed constraints. (a generalized version of such rewrite shows that QCSP+ is
  Conversely, restricted quantiï¬cation is a fairly general and still in PSPACE). Inescapable complications arise in practice,
neat solution, inspired by analogous forms of quantiï¬cation as (i) no reiï¬ed version is provided by the CSP environment
found in other modeling languages under the name of qual- for many constraints, and (ii) the shift to the reiï¬ed version
iï¬ed (Description Logic), or bounded (Logic Programming), may be considerably detrimental from the solverâ€™s viewpoint,
or restricted quantiï¬cation (Logic and Semantics Theory). since reiï¬ed constraints cannot prune values from domains so
  Restricted quantiï¬ersâ€”which allow us to reuse propaga- long as they donâ€™t know the value of their last parameter.
tion technology and are not exclusively designed for search-
based reasonersâ€”can be fully â€œback portedâ€ to the realm of 5 Implementation, Models, and Experiments
                           +
QBF, where they yield the QBF language, deï¬ned as the We implemented our decision procedure for QCSP+ in a sys-
restriction of QCSP+ to boolean variables and clausal con-
           +                                          tem built around the CSP solver GeCode [Schulte and Tack,
straints. QBF will be studied in a forthcoming paper, but a 2005]. Our solverâ€”called QeCodeâ€”accepts a wide set of
ï¬rst application is presented in the next section.    constraints in the input language3, and is publically available
  The QBF-inspired techniques mentioned above can be in- from [Benedetti et al., 2006c]. At present, no other system
terpreted as workarounds to bypass restricted quantiï¬ers in accepts a constraint language as expressive as QeCode does4,
QBF. While ï¬rst evidences suggest (cfr. next section) that re- and no suited public domain model exists yet.
stricted quantiï¬ers may be equally rewarding in QBF, their We contribute an initial test suite by devising QCSP+ gen-
introduction in QCSP is supported by compelling arguments, erators for the examples in Section 2. Example 1 and 2 do not
as major obstacles prevent us from adapting other solutions: rely on non-boolean variables/constraints and have a straight
First, the modeler should be made responsible for captur- translation into QBF or QBF+. Our generators also produce
ing the semantics of the alternating structure in (4). This such equivalent propositional formulations. This enables us
threatens one of the fundamental assumptions of (Q)CSP: to exercise our system against QBF solvers. It is to be noticed
Models have to be human-writable and readable. Second, that such comparison is of relative signiï¬cance and biased in
QCSP constraints cannot undergo arbitrary syntactic manipu- favor of QBF solvers, as it does not leverage the strengths
lations as clauses do. To illustrate the problem, let us consider QeCode
        +                                             of        (e.g. non-boolean variables, propagators with a
the QCSP  formula âˆƒX[C1(X)]âˆ€Y [C2(X, Y )].C3(X, Y ). One complex semantics), while an important weakness is exposed
way to attain a QCSP version of this formula would be (i.e. data structures are not tailored to boolean reasoning).
to deï¬ne a (single) constraint over X âˆª Y whose meaning Results are shown in Figure 1 and 2. For the â€œstrategic
is C1(X) âˆ§ (C2(X, Y ) âˆ¨ C3(X, Y )), to be processed by a companiesâ€ case, it comes out that only one QBF solver, out
quantiï¬ed extension of the GAC-scheme [Nightingale, 2005].
Though heavily demanding (in space or time, depending on 3Actually, all those (the latest version of) GeCode knows.
the technique employed), this is still feasible for small, ex- 4Even if we eschew restricted quantiï¬ers in the modeling.

                                                IJCAI-07
                                                   42