       A Faithful Integration of Description Logics with Logic Programming‚àó

                        Boris Motik                               Riccardo Rosati
             Department of Computer Science          Dipartimento di Informatica e Sistemistica
               University of Manchester, UK            Universit`a di Roma ‚ÄúLa Sapienza‚Äù, Italy


                    Abstract                          same consequences as DL and LP, respectively, if the other
                                                      component is empty. Unlike the existing approaches, our ap-
    Integrating description logics (DL) and logic pro-
                                                      proach allows the user to freely switch between open- and
    gramming (LP) would produce a very powerful and
                                                      closed-world views on arbitrary predicates from DL and LP.
    useful formalism. However, DLs and LP are based
                                                      By means of an example, we argue that our logic produces
    on quite different principles, so achieving a seam-
                                                      intuitive and practically useful consequences.
    less integration is not trivial. In this paper, we intro-
                                                        We base our approach on the logic of Minimal Knowledge
    duce hybrid MKNF knowledge bases that faithfully
                                                      and Negation as Failure (MKNF), developed by [Lifschitz,
    integrate DLs with LP using the logic of Minimal
                                                      1991] to unify several major approaches to nonmonotonic
    Knowledge and Negation as Failure (MKNF) [Lif-
                                                      reasoning. To obtain intuitive consequences for our hybrid
    schitz, 1991]. We also give reasoning algorithms
                                                      logic, we modify certain technical aspects of MKNF regard-
    and tight data complexity bounds for several inter-
                                                      ing the universe of discourse and equality.
    esting fragments of our logic.
                                                        Function-free logic programs are usually decidable if the
                                                      rules are safe, and many decidable DLs exist. However, we
1  Introduction                                       show that these restrictions on DL and LP are not sufÔ¨Åcient
Integrating description logics (DLs) and logic programming to obtain a decidable hybrid formalism, due to an interaction
(LP) in a common framework would produce a very powerful between DL and negation-as-failure. To obtain decidability,
formalism; for example, LP rules could be used to model con- we apply the well-known notion of DL-safety [Motik et al.,
straints and exceptions over DL knowledge bases. Adding a 2005], which makes the rules applicable only to individuals
rule layer on top of the DL-based Web Ontology Language known by name. We present several reasoning algorithms
(OWL) is currently the central task in the development of for the cases of general, positive (i.e., without negation-as-
the Semantic Web language stack, and the Rule Interchange failure), nondisjunctive and positive, nondisjunctive and strat-
Format (RIF) working group of the World Wide Web Con- iÔ¨Åed, and nondisjunctive (but not necessarily stratiÔ¨Åed) DL-
sortium (W3C) is currently working on standardizing such safe rules. Finally, we present tight data complexity bounds
a language. However, DLs and LP are based on fundamen- for each case and show that combining DLs with LP often
tally different assumptions: DLs are fragments of Ô¨Årst-order does not increase the data complexity of LP.
logic and employ open-world semantics, whereas LP pro-  Our approach is related to several nonmonotonic exten-
vides negation-as-failure under closed-world semantics. sions of DLs. [Donini et al., 2002] propose an MKNF-
  Several approaches to integrating DLs and LP were pro- based extension of the DL ALC, but without LP rules and
posed recently. [Rosati, 2006] proposes an approach that in- with unique name assumption (UNA). [Baader and Hollun-
terprets the predicates from the DL knowledge base under der, 1995] propose an extension of DLs with DL-safe default
open-world and the predicates occurring only in the LP rules rules, which are subsumed by our approach due to our treat-
under closed-world semantics. [Eiter et al., 2004] propose a ment of equality and the well-known embedding of default
loose coupling of DLs and LP by extending the LP rules with logic into MKNF [Lifschitz, 1991]. Finally, [Bonatti et al.,
special atoms interpreted as queries to a DL knowledge base. 2006] present an extension of DLs with circumscription that
  In this paper, we introduce hybrid MKNF knowledge bases, allows for nonmonotonic reasoning on unnamed individuals,
which integrate an arbitrary description logic DL1 with dis- but only for unary predicates if decidability is desired.
junctive logic programs and negation-as-failure. This inte- We leave the detailed proofs to [Motik and Rosati, 2006]
gration is faithful in the sense that it provides exactly the and present here only proof sketches.
  ‚àó
   This work was partially funded by the EPSRC project REOL 2 Preliminaries
(EP/C537211/1) and the EU project TONES (FET FP6-7603).
  1Our approach is actually applicable to any Ô¨Årst-order fragment; Description Logics. Our approach is applicable to any
however, our work is motivated primarily by knowledge representa- Ô¨Årst-order fragment DL satisfying these conditions: (i) each
tion, so we call this fragment a description logic.   knowledge base O‚ààDLcan be translated into a formula

                                                IJCAI-07
                                                   477œÄ(O) of function-free Ô¨Årst-order logic with equality, (ii)it Aruler is nondisjunctive if n =1; r is positive if k =0; r
supports ABoxes‚Äîassertions of the form P (a1,...,an) for is a fact if m = k =0; r is safe if all variables in r occur in
P a predicate and ai constants of DL,and(iii) satisÔ¨Åability a positive body atom. A program P is a Ô¨Ånite set of MKNF
checking and instance checking (i.e., checking entailments of rules. A hybrid MKNF knowledge base K is a pair (O, P).
       O|=    (         )
the form    P  a1,...,an ) are decidable. We assume fa- We deÔ¨Åne the semantics of K by translating it into a Ô¨Årst-
                                 [               ]
miliarity with the standard DL notation Baader et al., 2003 . order MKNF formula as follows:
                                                      DeÔ¨Ånition 3.2. Let K =(O, P) be a hybrid MKNF knowl-
MKNF.   The Ô¨Årst-order version of MKNF [Lifschitz, 1991]
                                                      edge base. We extend œÄ to r, P, and K as follows, where x is
can be understood as a variant of the Ô¨Årst-order modal logic
                                                      the vector of the free variables of r:
S5 with a preference relation on models that implements the
                                                         œÄ(r)=‚àÄx :(K H  ‚à® ...‚à® K H ‚äÇ
nonmonotonic semantics. The syntax of MKNF is obtained                 1          n
                                                                K B+  ‚àß ...‚àß K B+ ‚àß not B‚àí ‚àß ...‚àß not B‚àí)
                                             K                 V    1          m        1            k
by extending Ô¨Årst-order logic with modal operators and  œÄ(P)=       œÄ(r)     œÄ(K)=K   œÄ(O) ‚àß œÄ(P)
not. A formula P (t1,...,tn),whereti are terms, is a Ô¨Årst-      r‚ààP
order atom.Forœï  an MKNF formula, K œï and not œï are     K                                         (K)
     K      not                                           is satisÔ¨Åable if and only if an MKNF model of œÄ ex-
modal  - and   -atoms, respectively; œï is ground if it does ists, and K entails a closed MKNF formula œà, written K|= œà,
not contain variables; œï is positive if it does not contain not;
                                                      if and only if œÄ(K) |=MKNF œà.
and œï[t/x] is the formula obtained from œï by replacing all
free occurrences of the variable x with the term t.     MKNF as deÔ¨Åned by  [Lifschitz, 1991] considers arbitrary
  We assume that, apart from the constants used in MKNF models, whereas we consider only Herbrand models (see Sec-
formulae, we have a countably inÔ¨Ånite supply of constants tion 2). We introduce this restriction to obtain an intuitive
not used in the formulae; with  we denote the Herbrand logic that is compatible with both DLs and LP. Namely, un-
universe of such a signature. Also, we assume that the signa- der the semantics by Lifschitz, K A(a)  |=MKNF ‚àÉx : K A(x),
ture contains a special equality predicate ‚âà that is interpreted since K A(a) does not Ô¨Åx the interpretation of a in .To
as a congruence relation on .AnMKNF structure is a triple remedy that, we interpret all constants by themselves, which
(I,M,N),whereI   is a Herbrand Ô¨Årst-order interpretation is standard in data management applications [Donini et al.,
over ,andM   and N are nonempty sets of Herbrand Ô¨Årst- 2002; Reiter, 1992]. In order to ensure that our model is large
order interpretations over . SatisÔ¨Åability of closed MKNF enough, we assume a countably inÔ¨Ånite supply of constants.
formulae in an MKNF structure (I,M,N) is deÔ¨Åned as fol- Hence, we consider only inÔ¨Ånite models of O in which dif-
lows, for A a Ô¨Årst-order atom:                        ferent constants are interpreted as different objects.
                                                        An equality-free Ô¨Årst-order formula is satisÔ¨Åable in an ar-
(I,M,N)  |= A     iff A is true in I
(I,M,N)  |= ¬¨œï       (I,M,N) |= œï                    bitrary model iff it is satisÔ¨Åable in a Herbrand model with
                  iff                                 an inÔ¨Ånite supply of constants not occurring in the formula
(I,M,N)  |= œï1 ‚àß œï2 iff (I,M,N) |= œï1 and (I,M,N) |= œï2
(I,M,N)  |= ‚àÉx : œï iff (I,M,N) |= œï[Œ±/x] for some Œ± ‚àà [Fitting, 1996, Theorem 5.9.4]. Hence, without equality we
(I,M,N)  |= K œï   iff (J, M, N) |= œï for all J ‚àà M    cannot distinguish arbitrary from Herbrand models. For com-
(I,M,N)  |= not œï iff (J, M, N) |= œï for some J ‚àà N  patibility with DLs, we need ‚âà, which we clearly cannot in-
                                                      terpret as identity, so we interpret it as a congruence. Now
  The symbols true, false, ‚à®, ‚àÄ,and‚äÇ (material implication) a Ô¨Årst-order formula with equality is satisÔ¨Åable in a model
are interpreted as usual. An MKNF interpretation M is a with ‚Äútrue equality‚Äù iff it is satisÔ¨Åable in a model where ‚âà
nonempty set of Ô¨Årst-order interpretations over .Letœï and is an ordinary predicate interpreted as a congruence [Fitting,
œà be closed MKNF formulae. An MKNF interpretation M   1996, Theorem 9.3.9]. Hence, our approach is fully compat-
is an S5 model of œï, written M |= œï,if(I,M,M) |= œï for ible with DLs: if P = ‚àÖ,thenK|= œï iff O|= œï for any
each I ‚àà M; M is an MKNF model of œï if (i) M is an S5- Ô¨Årst-order formula œï. Similarly, our logic is fully compatible
model of œï and (ii) (I,M,M)  |= œï for each M  ‚äÉ M and with LP: for a ground atom Œ±,ifO = ‚àÖ,thenK|= K Œ± iff P
some I ‚àà M  (so-called preference semantics of MKNF); entails Œ± under stable model semantics [Lifschitz, 1991].
Ô¨Ånally, œï entails œà, written œï |=MKNF œà,if(I,M,M) |= œà  We believe that our treatment of equality matches the com-
for each MKNF model M of œï and I ‚àà M.                 mon intuition behind negation-as-failure. In the version of
                                                      MKNF by  [Lifschitz, 1991], œï = K A(a) ‚àß¬¨not A(b) has
3  Hybrid MKNF Knowledge Bases                        a model with a singleton universe in which a and b are the
                                                      same, so  entails ‚âà  . We consider this quite unintuitive:
                O                                             œï       a   b
DeÔ¨Ånition 3.1. Let be a DL knowledge base. A Ô¨Årst-order we did not say that and are the same, so we expect them
                 (        )            ‚âà                               a    b
function-free atom P t1,...,tn such that P is or it occurs to be different. Because of these problems, the semantics of
  O
in  is called a DL-atom; all other atoms are called non-DL- LP is commonly based on Herbrand models. We follow this
atoms.AnMKNF rule   r has the following form, where Hi,
 +       ‚àí                                            practice, so in our approach œï is MKNF unsatisÔ¨Åable, and it
Bi , and Bi are Ô¨Årst-order function-free atoms:       can be made satisÔ¨Åable by explicitly stating a ‚âà b.
      K H1 ‚à® ...‚à® K Hn ‚Üê                                In [Motik and Rosati, 2006] we allow the rules to con-
(1)             +        +      ‚àí          ‚àí
            K B1 ,...,K Bm, not B1 ,...,not Bk        tain both modal and nonmodal atoms, in order to general-
                                                      ize known extensions of DLs with rules such as SWRL or
                   +             ‚àí
The sets {K Hi}, {K Bi }, and {not Bi } are called the rule DL+log [Rosati, 2006]. However, we also show that gen-
head,thepositive body, and the negative body, respectively. eral rules can be converted into rules with only modal atoms.

                                                IJCAI-07
                                                   478Furthermore, mixing modal and nonmodal atoms produces an I |= Married(John) and I |= NotMarried(John), respec-
unintuitive semantics, so it is good practice to use either fully tively, and let M3 = M1 ‚à™ M2. Clearly, we have M1 ‚äÇ M3,
nonmodal or fully modal rules.                        M1  |= K Married(John) and M3  |= K Married(John);in-
                                                      tuitively, M1 contains ‚Äúmore knowledge‚Äù than M3. The pref-
DL-Safety. Making the rules safe usually sufÔ¨Åces to make erence semantics of MKNF gives the following semantics
                                                         not
function-free LP decidable; however, we show next that this to : an MKNF model M of an MKNF formula  œï is
                                                                                               not
does not hold for MKNF rules. Note that MKNF rules contain the minimal knowledge justiÔ¨Åed by the values of -atoms.
                                                                                 not        (     )
modal atoms, so existing undecidability results for Ô¨Årst-order In our example, assuming that Married John is true
                                                                                     K            (    )
combinations of DLs with rules are not directly applicable. implies other consequences, such as NotMarried John ;
                                                      now each such consequence is justiÔ¨Åed in the sense that it be-
Theorem 3.3. For K a safe hybrid MKNF knowledge base
                                                      longs to the minimal knowledge entailed by the knowledge
and A a ground atom, checking whether K|= A is undecid-
                                                      base K in which each not-atom is replaced with its value.
able if DL allows us to express an axiom C.
                                                        To understand how open- and closed-world reasoning in-
  Namely, C   makes C equivalent to the inÔ¨Ånite set ,                              ‚àÉ       (    )
                                                     teract in our formalism, let us assert Spouse. Bill and
so all elements from can be accessed in the rules even if the p(Bill ).NowBill can be married to different people in dif-
rules are safe. In other words, safety is now not a sufÔ¨Åcient ferent models; however, (4) ensures that Married(Bill) holds
condition for domain independence. To ensure decidability, in all models. The precondition of (5) is thus not satisÔ¨Åed, so
we apply the well-known DL-safety restriction, which makes we derive neither NotMarried(Bill) nor HighRisk(Bill).In
the rules applicable only to individuals known by name in the a way, reasoning in O is performed under open-world seman-
ABox; for an in-depth discussion, see [Motik et al., 2005]. tics, but the modal operators allow us to put on ‚Äúclosed-world
DeÔ¨Ånition 3.4. An MKNF rule r is DL-safe if every variable glasses‚Äù and consider the consequences in all models.
in r occurs in at least one non-DL-atom K B in the body of r. Finally, let us assert Spouse(Bob, Ann), p(Bob),and
A hybrid MKNF knowledge base K is DL-safe if all its rules p(Ann). By (6) we can now derive Discount(Bob); in con-
are DL-safe.                                          trast, we cannot derive Discount(Bill ). Namely, the rule (6)
  Note that DL-atoms are interpreted in the same way as non- differs from the Ô¨Årst-order implication (4) in that it requires
DL-atoms; DL-safety merely provides a syntactic restriction Spouse(x, y) to be known‚Äîthat is, it must hold in all Ô¨Årst-
ensuring decidability. For a hybrid MKNF knowledge base order models. The spouse of Bill is different in different
K =(O,  P),letPG be obtained from P by replacing in each models, so O  |= Spouse(Bill ,y) for any value of y,andthe
rule all variables with all constants from K in all possible rule (6) would not ‚ÄúÔ¨Åre‚Äù even if it were not DL-safe.
ways; the knowledge base KG =(O, PG) is called a ground This example cannot be expressed in existing combinations
instantiation of K.                                   of DLs and LP: the rules of [Eiter et al., 2004] cannot de-
Lemma 3.5. For K a DL-safe hybrid MKNF knowledge base, rive new DL facts, and, in the approach by [Rosati, 2006],
KG the ground instantiation of K, and œà a ground MKNF the DL predicates are interpreted under open-world seman-
                                                                                 not
formula. Then, K|= œà iff KG |= œà.                     tics and thus cannot occur under .
4  Example                                            5   Reasoning Algorithms
Consider determining the car insurance premium based on Given a nonground hybrid MKNF knowledge base K, all our
various information about the driver. By convention, DL- algorithms Ô¨Årst compute the ground knowledge base KG to
predicates start with an uppercase and non-DL-predicates obtain an MKNF theory without modal operators under quan-
with a lowercase letter. Let K be the following hybrid MKNF tiÔ¨Åers. For a program with variables, this step is exponen-
knowledge base (the predicate p means ‚Äúperson‚Äù):      tial. However, even for nondisjunctive datalog the combined
(2)                       NotMarried ‚â°¬¨Married        complexity is higher than data complexity by an exponen-
                                                               [                ]
(3)                       NotMarried   HighRisk      tial factor Dantsin et al., 2001 , so this is to be expected of
                            ‚àÉ                       our logic as well. Therefore, for an MKNF knowledge base
(4)                           Spouse.    Married      K =(O,  P), we just consider the data complexity,whichis
(5)     K NotMarried(x) ‚Üê  K p(x), not Married(x)     measured in the size of the facts in P and the size of the ABox
(6) K  Discount(x) ‚Üê K Spouse(x, y), K p(x), K p(y)   of O. We denote the data complexity of reasoning in DL with
                                                      C        E =NP    E‚äÜNP       E = C
  Let us now assert p(John). Under Ô¨Årst-order seman-   ,andset        if        and      otherwise.
                              (     )                   For simplicity, we write K, O,andP instead of œÄ(K),
tics, some models contain Married John and others con- (O)       (P)                    K
tain NotMarried(John). However, (5) applies the closed- œÄ  ,andœÄ    . The MKNF models of  G are clearly inÔ¨Å-
worldassumptiontoMarried: by default, people are as-  nite, so we must devise a convenient Ô¨Ånite representation for
                                                                                            [           ]
sumed not to be married. Since Married(John) does not them. We adopt an approach already used by Rosati, 1999 :
                   O                                  we represent an MKNF model M using a Ô¨Årst-order formula
hold in all models of , the rule (5) ‚ÄúÔ¨Åres‚Äù and it derives         = {  | |=  }
NotMarried(John); with (3), this implies HighRisk(John). œï such that M I I   œï . We formalize this as follows:
  The preference semantics of MKNF is strongly related DeÔ¨Ånition 5.1. Let K =(O, P) be a hybrid MKNF knowl-
to the notion of the Gelfond-Lifschitz reduct used to de- edge base. The set of K-atoms of K, written KA(K),isthe
Ô¨Åne stable models. Let M1 and M2 be MKNF interpre-    smallest set that contains (i)allK-atoms of PG, and (ii)a
tations consisting of Ô¨Årst-order interpretations I such that modal atom K Œæ for each modal atom not Œæ occurring in PG.

                                                IJCAI-07
                                                   479  For a subset P of KA(K),theobjective knowledge of P Algorithm 1 Entailment in General hybrid MKNF KBs
            ob    = O‚à™                    (    )
is the formula K,P       K Œæ‚ààP Œæ. A partition P, N of Algorithm: not-entails-DL(K,œà)
KA(K) is consistent if obK,P  |= Œæ for each K Œæ ‚àà N.  Input:
  Let œï be an MKNF formula and  (P, N) a partition of   K =(O, P): a DL-safe hybrid MKNF knowledge base
                                                        œà               (¬¨) K A
KA(K). The formula œï[K,P,N]  is obtained from œï by re-    : a ground formula
           K        true  K   ‚àà           false       Output:
placing each Œæ with     if  Œæ   P and with     oth-     true K |= œà false
erwise; œï[not,P,N] is obtained from œï by replacing each     if     ;    otherwise
not Œæ with true if K Œæ ‚àà N and with false otherwise; Ô¨Ånally, K                      K
 [    ]=   [K     ][not     ]                           let G be the ground instantiation of
œï P, N   œï   ,P,N      ,P,N .                           if a partition (P, N)ofKA(KG) ‚à™{K A} exists such that
                          DL
  For a set of modal atoms S, S is the subset of DL-atoms 1. PG[P, N] evaluates to true,and
                                   
of S, S = {Œæ | K Œæ ‚àà S}, and SDL = S for S = SDL.               b
                                                          2. O‚à™PDL  is satisÔ¨Åable, and
                                                                b
  An MKNF model is strongly related to a particular parti- 3. O‚à™PDL |= Œæ for each K Œæ ‚àà NDL,and
tion of KA(K):                                                                    b                 b
                                                          4. for each Q(a1,...,an) ‚àà N and Q(b1,...,bn) ‚àà P ,we
                                                                    b
DeÔ¨Ånition 5.2. An MKNF interpretation M induces the par-    have O‚à™PDL  |= ai ‚âà bi for some 1 ‚â§ i ‚â§ n
     (    )   KA(K)   K   ‚àà              |= K                                                     
tition P, N of      if  Œæ    P implies M      Œæ and       5. for Œ≥ = PG[not,P,N] and each partition (P ,N ) of P
K Œæ ‚àà N implies M  |= K Œæ.                                  such that N  = ‚àÖ
                                                                       
  The following key lemma shows that each MKNF model       (a) Œ≥[P ,N ‚à™ N ] evaluates to false,or
     K                                KA(K)                       b
M  of G can be represented as a partition of :             (b) O‚à™PDL  is unsatisÔ¨Åable, or
                                                              O‚à™Pb   |= Œæ       K Œæ ‚àà N 
Lemma 5.3. Let M  be an MKNF model of KG and (P, N)        (c)     DL     for some      DL,or
                                                                                    b                 b
a partition of KA(K) induced by M. Then, M is equal to the (d) for some Q(a1,...,an) ‚àà N and Q(b1,...,bn) ‚àà P ,
                     = { |  |= ob  }                                    b
set of interpretations M I I     K,P .                        we have O‚à™PDL  |= ai ‚âà bi for all 1 ‚â§ i ‚â§ n
  Hence, to Ô¨Ånd an MKNF model of KG, we need to Ô¨Ånd a     6. one of the following conditions holds:
partition (P, N) of KA(K). We can do it in different ways for (i) œà = K A and K A ‚àà P ,or
different types of rules.                                  (ii) œà = ¬¨ K A and K A ‚àà P
                                                        then return true; otherwise return false
The General Case. As for disjunctive datalog, in the gen-
eral case we must guess a partition (P, N) of KA(K).Thisis
captured by Algorithm 1.                              is a contradiction; hence, M is an MKNF model of KG.Fi-
                                                      nally, Condition (6) ensures M  |= œà,soKG  |= œà.The(‚áê)
Theorem  5.4. Let K be a DL-safe hybrid MKNF knowl-
                                                      direction is analogous.
edge base and œà =(¬¨) K A  for A a ground atom. Then,
                                                        K
not-entails-DL(K,œà) returns true iff K  |= œà, and it runs with G can be computed in polynomial time if the size of the
               E                                                       P                     (    )
data complexity E .                                   nonground rules in is bounded. A partition P, N can be
                                                      guessed and Condition (1) can be checked in time polyno-
Proof sketch. (‚áí)Ifnot-entails-DL(K,œà) returns true,a mial in the size of KG. Checking Conditions (2)‚Äì(4) and (6)
partition (P, N) of KA(K) satisfying all conditions of Al- requires a polynomial number of calls to an oracle running in
gorithm 1 exists. We show that M = {I | I |= obK,P } is C, so all these steps can be performed in E. Disproving Con-
                                                                                            
an MKNF model of KG. By Condition (3), (P, N) is con- dition (5) requires guessing a partition (P ,N ) and a poly-
sistent on all DL-atoms and, by Condition (4), it is con- nomial number of calls to an oracle running in C, so it can
sistent on all non-DL-atoms (for a non-DL-predicate Q, be performed in E. Hence, validating Condition (5) can be
                                                                  E                       EE
obK,P |= Q(a1,...,an) can hold only if Q(b1,...,bn) ‚àà P performed in co , and the algorithm runs in .
and obK,P |= ai ‚âà bi for all i). By Condition (2), M  = ‚àÖ.
By Condition (1), (I,M,M) |= PG[P, N] for each I ‚àà M;
furthermore, the values of all K-atoms in M are determined Positive Programs. For K a positive hybrid MKNF knowl-
by (P, N),so(I,M,M)   |= PG. Clearly, (I,M,M) |= O,   edge base, K|= K A iff M |= K A for each S5-model M of
                                                                                                        
so (I,M,M)  |= KG. Assume now that M is not an MKNF   K: for each such M,sinceK is positive, an MKNF model M
                                    
model‚Äîthat is, an MKNF interpretation M exists such that of K exists such that M  ‚äÜ M. (This is analogous to the case
                                       
M  ‚äÉ M  and (I ,M ,M)  |= KG for each I ‚àà M . Then,   of positive disjunctive datalog.) In other words, for positive
                          
M   induces the partition (P ,N ) of KA(K). Because   queries, we do not need to ensure the preference semantics of
                                                                          +
M  |= K Œæ implies M |= K Œæ,wehaveP   ‚äÇ P , so we can  MKNF. Let  not-entails-DL (K, K A) be an algorithm that
                                 
represent (P ,N ) as (P ,N ‚à™ N ) for (P ,N ) a partition is the same as Algorithm 1, only without Condition (5). By
                               
of P with N  = ‚àÖ. By Lemma 5.3, M = {I | I |= obK,P  }. adapting the proof of Theorem 5.4, we get the following:
         
Because M   = ‚àÖ, obK,P  is satisÔ¨Åable, so Condition (b) is in-
validated; (I,M,M) |= Œ≥[P ,N ‚à™ N ] for each I ‚àà M , Theorem 5.5. Let K =(O, P) be a positive DL-safe hy-
                                    (     ‚à™   )     brid MKNF knowledge base and A a ground atom. Then,
which invalidates Condition (a); Ô¨Ånally, P ,N N  is                +
clearly consistent, which invalidates Conditions (c) and (d). not-entails-DL (K, K A) returns true iff K  |= K A, and it
Hence, Condition (5) could not hold for (P ,N ‚à™ N ),which runs with data complexity E.

                                                IJCAI-07
                                                   480Positive Nondisjunctive Programs. If K is nondisjunctive ‚Ä¢ For each body atom not Œæ of r,eachP ‚äÜ head(K)<Œª(r)
                                                                                                ‚â•Œª(r)
and positive, we can construct (P, N) deterministically in a such that obK,P  |= Œæ, and each P ‚äÜ head(K) ,ei-
bottom-up fashion. We can easily show that M1 |= K and    ther obK,P ‚à™P   |= Œæ or obK,P ‚à™P  is unsatisÔ¨Åable.
M2 |= K implies M1 ‚à™ M2 |= K for all MKNF interpreta-
                                                        K  is stratiÔ¨Åed if a stratiÔ¨Åcation Œª of K exists. A stratiÔ¨Å-
tions M1 and M2, which immediately implies the following:
                                                      cation Œª partitions P into strata œÉi = {r | Œª(r)=i};these-
Theorem 5.6. Each positive DL-safe nondisjunctive hybrid quence of strata œÉ1,...,œÉn is often identiÔ¨Åed with Œª and is
MKNF knowledge base K has at most one MKNF model.     also called a stratiÔ¨Åcation.
DeÔ¨Ånition 5.7. For K a positive nondisjunctive DL-safe hy- StratiÔ¨Åcation ensures that deriving an atom K Œæ in a stra-
brid MKNF knowledge base, RK, DK, and TK are the oper- tum œÉi does not change the values of the K-andnot-
ators deÔ¨Åned on the subsets of KA(K) as follows:      atoms from strata <iand  ‚â§  i, respectively. For exam-
  R  (S)=S  ‚à™{K  H |K                                 ple, consider a knowledge base K where DL is propositional
    K                G contains a rule of the form (1)     O  =(  ‚â°   ‚à®  ) ‚àß ( ‚â°¬¨  )    P
             such that K Bi ‚àà S for each 1 ‚â§ i ‚â§ n}   logic,     r  p   q    s    q ,and  contains the rules
                                                      K   ‚Üê  not      K  ‚Üê  K                    P
                                   b                    r       p and   s     r. In ordinary datalog, would
  DK(S)={K   Œæ | K Œæ ‚àà KA(K) and O‚à™SDL |= Œæ}‚à™         be stratiÔ¨Åed: by evaluating the Ô¨Årst rule we derive K r,af-
          {K Q(b ,...,b ) | K Q(a ,...,a ) ‚àà S \ S
                1     n        1     n        DL      ter which we evaluate the second rule and derive K s.But
                O‚à™Sb    |= s ‚âà b   1 ‚â§ i ‚â§ n}
             and     DL    i   i for                  now the objective knowledge is r ‚àß s ‚àßOand it implies ¬¨q,
  TK(S)=RK(S)   ‚à™ DK(S)                               which invalidates the atom K p in the body of the Ô¨Årst rule.
                                                      Intuitively, DeÔ¨Ånition 5.9 ensures that such an interaction be-
  The operator TK is monotonic on the lattice of subsets of
                                                    tween O  and the derived facts does not happen. Clearly,
KA(K) (i.e., S ‚äÜ S implies TK(S) ‚äÜ TK(S )). Namely, RK
                                                      checking stratiÔ¨Åcation is difÔ¨Åcult in general. However, if O
is monotonic similarly as this is the case for datalog, and DK
                                                      employs UNA and no rule in P contains a DL-atom in the
is monotonic because Ô¨Årst-order logic is monotonic. Hence,
                                                      head, then stratiÔ¨Åcation of P can be checked as usual. This
by Knaster-Tarski‚Äôs theorem, TK has the least Ô¨Åxpoint, which
              œâ                                       case is interesting because it allows to deÔ¨Åne complex con-
we denote with T . It is now easy to show the following:
              K                                       straints over DL knowledge bases. We now show how to
Theorem  5.8. Let K be a positive nondisjunctive DL-safe compute models of a stratiÔ¨Åed program:
                                =  { |  |= ob   œâ }
hybrid MKNF knowledge base and M    I  I     K,TK .
             = ‚àÖ                                K     DeÔ¨Ånition 5.10. Let œÉ1,...,œÉk be a stratiÔ¨Åcation of a DL-
Then, (i)ifM   ,thenM  is the single MKNF model of ;  safe MKNF knowledge base  K. The sequence of subsets
(ii)ifK has an MKNF model, this model is equal to M; and           KA( )                         = ‚àÖ
                                 œâ     PC             U0,...,Uk of    œÉ  is inductively deÔ¨Åned as U0 and,
(iii) the data complexity of computing TK is in .        0    ‚â§      =   œâ         =      ‚à™       
                                                      for  <i   k, Ui  Tœái where œái  Ui‚àí1   œÉi and œÉi is ob-
                                          œâ                                       not      true       |=
Proof sketch. (i) Clearly, M |= K O and, since TK is a Ô¨Åx- tained from œÉi by replacing each Œæ with if Ui‚àí1 Œæ
                                                                                       œâ
point of TK, M |= PG.IfM were not an MKNF model, an   and with false otherwise. Finally, let UK = Uk.
                                      
MKNF interpretation M ‚äÉ M such that (I ,M ,M) |= KG     The following theorem is analogous to the case of ordinary
for each I ‚àà M  would exist and it would induce a partition
                                                 stratiÔ¨Åed datalog:
(P ,N ) of KA(K) such that P ‚äÇ P . Clearly, TK(P )=P
                                                   Theorem 5.11. Let K be a stratiÔ¨Åed DL-safe MKNF knowl-
(otherwise, either M  |= r for some r ‚ààPG,or(P ,N ) is
                     œâ                                edge base K, and M = {I | I |= obK,U œâ }. Regardless of the
not consistent), but then T is not the minimal Ô¨Åxpoint of TK.                    œâ     K
                     K                                stratiÔ¨Åcation used to compute , the following claims hold:
The proof for (ii) is analogous. (iii) As for ordinary datalog,                UK
                                                      (i)ifM  = ‚àÖ,thenM  is an MKNF model of K;(ii)ifK has
RK(S) can be computed in polynomial time. The number
                                                      an MKNF model, then this model is equal to M; and (iii)the
of atoms in KA(K) is linear in the size of PG, so computing                      œâ      C
                                                      data complexity of computing UK is in P .
DK(S)  requires a polynomial number of calls to an oracle
running in C. Finally, the number of iterations is bounded by
the size of KA(K), which implies the claim.           Nondisjunctive NonstratiÔ¨Åed Programs. We now take K
                                                      to be a nondisjunctive and nonstratiÔ¨Åed knowledge base.
                        K|= K      obK,T œâ |=
  For entailment checking,    A  iff    K    A,and    Then, the knowledge base Œ≥ = PG[not,P,N] from Algo-
K|= ¬¨ K      ob   œâ  |=
        A iff  K,TK   A.                              rithm 1 is nondisjunctive and positive, so we can use The-
                                                      orem 5.8 to ensure the preference semantics of MKNF. We
StratiÔ¨Åed Programs. We Ô¨Årst deÔ¨Åne a notion of stratiÔ¨Åca- deÔ¨Åne nondisjunctive-not-entails-DL(œÉ, œà) to be the same as
                                                                                             œâ =
tion appropriate to MKNF programs.                    Algorithm 1, but replace Condition (5) with TŒ≥ P .
DeÔ¨Ånition 5.9. Let K =(O, P) be a nondisjunctive hybrid Theorem 5.12. For a nondisjunctive nonstratiÔ¨Åed hybrid
                                  +                                       K       =(¬¨) K
MKNF knowledge base and Œª : PG ‚Üí N  a function assign- MKNF knowledge base  and œà        A with A a ground
                                                                       nondisjunctive not entails DL(K )
            ‚ààPG                   ( )                 atom, the algorithm          -   -     -     ,œà re-
ing to each r     a positive integer Œª r . For an integer                                             C
k and  
 ‚àà{<, ‚â§,>,‚â•},lethead(K) k be the set of head turns true iff K  |= œà, and it runs with data complexity EP .
atoms of those rules r ‚ààPG for which Œª(r)  
 k . Then, Œª is
a stratiÔ¨Åcation of K if these conditions hold for each r ‚ààPG: 6 Data Complexity
                                              ‚â§Œª(r)
  ‚Ä¢ For each body atom K Œæ of r,eachP ‚äÜ head(K)       We now   determine the data complexity‚Äîthe complexity
                                          >Œª(r)
    such that obK,P  |= Œæ, and each P ‚äÜ head(K) ,ei-  measured in the sizes of the ABox of O and the facts of P‚Äî
    ther obK,P ‚à™P   |= Œæ or obK,P ‚à™P  is unsatisÔ¨Åable; of checking entailment for a hybrid MKNF knowledge base

                                                IJCAI-07
                                                   481