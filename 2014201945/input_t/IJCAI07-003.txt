                               The Logic behind Weighted CSP‚àó

         Carlos Ansotegui¬¥                Mar¬¥ƒ±a Luisa Bonet         Jordi Levy    and   Felip Manya`
             DIEI, UdL                         LSI, UPC                         IIIA, CSIC
     Jaume II 69, Lleida, Spain             Barcelona, Spain          Campus UAB, Bellaterra, Spain


                    Abstract                          underlying logic of WCSP. First, we deÔ¨Åne an encoding,
                                                      called signed encoding, that transforms any WCSP instance
    We deÔ¨Åne a translation from Weighted CSP to       to a Signed Max-SAT instance, where Signed Max-SAT is
    signed Max-SAT, and a complete resolution-style   the Max-SAT problem of the multiple-valued clausal forms
    calculus for solving signed Max-SAT. Based on     known as Signed CNF formulas (see [Ans¬¥otegui and Many`a,
    these results, we then describe an original exact al- 2003] and references therein). Second, we deÔ¨Åne a complete
    gorithm for solving Weighted CSP. Finally, we de- resolution calculus for solving Signed Max-SAT. Third, we
    Ô¨Åne several derived rules and prove that they en- devise an exact algorithm for solving WCSP from the com-
    force the main soft arc consistency deÔ¨Åned in the pleteness proof of the resolution calculus. Fourth, we deÔ¨Åne
    literature when applied to Weighted CSP instances. several sound inference rules for Signed Max-SAT that en-
                                                      force some known arc consistency properties when applied to
1  Introduction                                       the signed encoding of any binary WCSP instance.
                                                        The structure of the paper is as follows. Section 2 contains
The Weighted Constraint Satisfaction Problem (WCSP) is a preliminary deÔ¨Ånitions and the signed encoding. Section 3
well known soft constraint framework for modelling over- deÔ¨Ånes the inference rule for signed Max-SAT and proves its
constrained problems with practical applications in domains soundness and completeness. Section 4 describes an exact
such as resource allocation, combinatorial auctions and bioin- algorithm for solving Weighted CSP. Section 5 deÔ¨Ånes four
formatics. WCSP is an optimization version of the CSP derived rules that enforce soft local consistency properties.
framework in which constraints are extended by associating Finally, Section 6 presents the conclusions of our work.
costs to tuples. Solving a WCSP instance, which is NP-hard,
consists in Ô¨Ånding a complete assignment of minimal cost. 2 Preliminaries
  Global consistency WCSP algorithms such as Bucket
Elimination [Dechter, 1999] solve WCSP instances without DeÔ¨Ånition 1 A truth value set,ordomain, N is a non-empty
search. They obtain an optimal solution by applying, to Ô¨Ånite set {i1,i2,...,in} where n denotes its cardinality. A
the original instance, transformations that preserve cost dis- sign is a subset S ‚äÜ N of truth values. A signed literal is
tributions. On the other hand, WCSP Branch and Bound  an expression of the form S:p,whereS is a sign and p is a
(BnB) based algorithms such as PFC [Freuder and Wallace, propositional variable. The complement of a signed literal l
1992], PFC-MRDAC   [Larrosa and Meseguer, 1996],Rus-  of the form S:p, denoted by l,isS:p =(N \ S):p.Asigned
sian Doll Search [Verfaillie et al., 1996],MAC‚àó [Larrosa clause is a disjunction of signed literals. A signed CNF for-
and Schiex, 2004], MFDAC‚àó [Larrosa and Schiex, 2003] and mula is a multiset of signed clauses.
MEDAC‚àó   [de Givry et al., 2005] perform a systematic search
                                                      DeÔ¨Ånition 2 An assignment for a signed CNF formula is a
in the space of all possible assignments. They differ in the
                                                      mapping that assigns to every propositional variable an ele-
method of computing a lower bound at each node of the proof
                                                      ment of the truth value set. An assignment I satisÔ¨Åes a signed
tree to prune some parts of the search space. Modern al-
                    ‚àó        ‚àó            ‚àó           literal S:p iff I(p) ‚àà S, satisÔ¨Åes a signed clause C iff it sat-
gorithms such as MAC , MFDAC   and MEDAC    enforce
                                                      isÔ¨Åes at least one of the signed literals in C, and satisÔ¨Åes a
some extension of Arc Consistency (AC) to WCSP ‚ÄîSoft
       ‚àó                         ‚àó                    signed CNF formula Œì iff it satisÔ¨Åes all clauses in Œì. A signed
AC (AC  ), Full Directional AC (FDAC ) or Existential Di-
                 ‚àó                                    CNF formula is satisÔ¨Åable iff it is satisÔ¨Åed by at least one as-
rectional AC (EDAC )‚Äî when computing that lower bound.
                                                      signment; otherwise it is unsatisÔ¨Åable.
  In this paper we relate ideas from three different re-
search communities ‚ÄîMultiple-Valued Logic, SatisÔ¨Åability DeÔ¨Ånition 3 The Signed Max-SAT problem for a signed
and Constraint Processing‚Äî with the aim of describing the CNF formula consists in Ô¨Ånding an assignment that mini-
                                                      mizes the number of falsiÔ¨Åed signed clauses.
  ‚àóThis research was founded by the MEC research projects
iDEAS (TIN2004-04343), Mulog (TIN2004-07933-C03-01/03) and DeÔ¨Ånition 4 A constraint satisfaction problem (CSP) in-
SofSAT (TIC2003-00950), and the program Ram¬¥on y Cajal. stance is deÔ¨Åned as a triple X, D, C,whereX  =

                                                IJCAI-07
                                                   32{x1,...,xn} is a set of variables, D = {d(x1),...,d(xn)}
                                                          x1            x2          1:  {a}:x
is a set of domains containing the values the variables may                                  1
                                                                                    2:  {a}:x1
take, and C = {C1,...,Cm} is a set of constraints. Each
                                                       a  2             0   a       3:  {b}:x
constraint Ci = Si,Ri is deÔ¨Åned as a relation Ri over a                                    1
                S = {x  ,...,x  }                      b                    b       4:  {b}:x
subset of variables i  i1     ik , called the constraint  2      1      0                    1
                                                                 1
scope. The relation Ri may be represented extensionally as a     x3                 5:  {c}:x1
                          d(x  ) √ó¬∑¬∑¬∑√ód(x   )          c  1             0   c
subset of the Cartesian product i1        ik .                       1              6:  {c}:x1 ‚à® {a}:x2
                                                                    2
                                                              a  0                  7:  {c}:x1 ‚à® {b}:x2
DeÔ¨Ånition 5 An assignment v for a CSP instance X, D, C            1
                                                                                    8:  {a}:x3 ‚à® {c}:x2
is a mapping that assigns to every variable xi ‚àà X an ele-    b  0
ment v(xi) ‚àà d(xi). An assignment v satisÔ¨Åes a constraint                           9:  {b}:x3 ‚à® {c}:x2
{x ,...,x  },R ‚ààC     v(x ),...,v(x )‚ààR                   c  0
   i1     ik   i     iff   i1        ik      i.                                    10 : {b}:x3 ‚à® {c}:x2
                                                                                   11 : {c}:x  ‚à® {c}:x
DeÔ¨Ånition 6 A Weighted CSP (WCSP) instance is deÔ¨Åned as                                      3       2
atripleX, D, C,whereX  and D  are variables and do-
mains as in CSP. A constraint Ci is now deÔ¨Åned as a pair
S ,f       S  = {x  ,...,x }                            Figure 1: A WCSP instance and its signed encoding
  i i ,where  i      i1     ik is the constraint scope
   f  : d(x ) √ó¬∑¬∑¬∑√ód(x   ) ‚Üí N
and i     i1           ik      is a cost function.The
                 C                        v
cost of a constraint i induced by an assignment in which Example 10 Figure 1 shows a WCSP instance X, D, C
             S  = {x  ,...,x }           b ,...,b
the variables of i   i1     ik take values i1    ik   and its signed encoding. The WCSP has the set of variables
  f (b ,...,b )
is i i1     ik . An optimal solution to a WCSP instance X = {x1,x2,x3} with domains d(x1)=d(x2)=d(x3)=
is a complete assignment in which the sum of the costs of the {a, b, c}. There is a binary constraint between variables x1
constraints is minimal.                               and x2, a binary constraint between variables x2 and x3,and
DeÔ¨Ånition 7 The Weighted Constraint Satisfaction Problem a unary constraint for every variable. Unary costs are de-
(WCSP) for a WCSP instance consists in Ô¨Ånding an optimal picted inside small circles. Binary costs are depicted as la-
solution for that instance.                           beled edges connecting the corresponding pair of values. The
                                                      label of each edge is the corresponding cost. If two values
DeÔ¨Ånition 8 The signed encoding of a WCSP  instance
X, D, C                                             are not connected, the binary cost between them is 0. In this
         is the signed CNF formula over the domain   instance, the optimal cost is 2.
N  =         d(xi)
        xi‚ààD       that contains for every possible tu-
   b ,...,b  ‚ààd(x    ) √ó ... √ó d(x )
ple  i1     ik       i1            ik  of every con-
      {x ,...,x  },f ‚ààC    f (b ,...,b )
straint  i1     ik   i      , i i1     ik  copies of  3   The Inference Rule. Soundness and
the signed clause:                                        Completeness
             {b  }:x  ‚à®¬∑¬∑¬∑‚à®{b   }:x .
               i1   i1        ik   ik                 We deÔ¨Åne a resolution rule for solving signed Max-SAT,
                                                      called Signed Max-SAT Resolution, and prove its soundness
  An alternative encoding is to consider signed clauses with and completeness. This rule was inspired by previous works
weights instead of allowing multiple copies of a clause. For [Larrosa and Heras, 2005; Bonet et al., 2006] for Max-SAT.
the sake of clarity we use unweighted clauses. Neverthe- The completeness proof for signed CNF formulas is techni-
less, any efÔ¨Åcient implementation of the algorithms proposed cally more involved than the proof for Boolean CNF formu-
should deal with weighted clauses. The extension of our the- las.
oretical results to weighted clauses is straightforward.
                                                      DeÔ¨Ånition 11 The Signed Max-SAT Resolution rule is de-
                                   P
Proposition 9 Solving a WCSP instance is equivalent to Ô¨Åned as follows
solving the Signed Max-SAT problem of its signed encoding;
i.e., the optimal cost of P coincides with the minimal number S:x ‚à® a1 ‚à® ...‚à® as
                                                               
of unsatisÔ¨Åed signed clauses of the signed encoding of P .   S :x ‚à® b1 ‚à® ...‚à® bt
                                                                  
                                                             S ‚à© S :x ‚à® a1 ‚à® ...‚à® as ‚à® b1 ‚à® ...‚à® bt
                                                                  
PROOF: For every combination of values to the variables of   S ‚à™ S :x ‚à® a1 ‚à® ...‚à® as ‚à® b1 ‚à® ...‚à® bt
                     C   = S ,f 
the scope of a constraint i  i  i , the signed encod-        S:x ‚à® a1 ‚à® ...‚à® as ‚à® b1
ing contains as many clauses as the cost associated with that S:x ‚à® a1 ‚à® ...‚à® as ‚à® b1 ‚à® b2
combination. If an assignment of the signed encoding re-     ¬∑¬∑¬∑
stricted to the variables of Si coincides with a combination
                                                             S:x ‚à® a1 ‚à® ...‚à® as ‚à® b1 ‚à® ...‚à® bt‚àí1 ‚à® bt
of Ci with cost 0, then all the clauses of the signed encoding 
                                                             S :x ‚à® b1 ‚à® ...‚à® bt ‚à® a1
introduced by Ci are satisÔ¨Åed because there is no clause for-  
                                                             S :x ‚à® b1 ‚à® ...‚à® bt ‚à® a1 ‚à® a2
bidding that combination. If an assignment of the signed en- ¬∑¬∑¬∑
coding restricted to the variables of Si coincides with a com- S :x ‚à® b ‚à® ...‚à® b ‚à® a ‚à® ...‚à® a ‚à® a
       b ,...,b    C          u       u>0                         1        t   1        s‚àí1    s
bination i1     ik of  i with cost ,where    , then,
by construction of the signed encoding, only the u clauses of This inference rule is applied to multisets of clauses, and re-
       {b  }:x  ‚à®¬∑¬∑¬∑‚à®{b   }:x
the form i1   i1         ik  ik are falsiÔ¨Åed among the places the premises of the rule by its conclusions.
clauses introduced by Ci.                             We say that the rule resolves the variable x.

                                                IJCAI-07
                                                   33The tautologies concluded by the rule like N :x ‚à® A are re- of a multiset of clauses is the sum of scores of the clauses
moved from the resulting multiset. Also we substitute clauses contained in it.
   S:x‚à®S :x‚à®A    (S ‚à™ S):x‚à®A              ‚àÖ:x‚à®A
like           by             , and clauses like                                          C            x
by A.                                                 Lemma 15   For every multiset of clauses and variable ,
                                                      there exists a multiset C such that C is a saturation of C
  We would like to emphasize that the rule does not add the w.r.t. x.
conclusions to the premises. It replaces the clauses in the
premises by the clauses in the conclusions.           PROOF: We proceed by applying nondeterministically the in-
DeÔ¨Ånition 12 We write CDwhen the multiset of clauses D ference rule resolving x, until we obtain a saturated multiset.
can be obtained from the multiset C applying the rule Ô¨Ånitely We only need to prove that this process terminates in Ô¨Ånitely
                         
many times. We write C x C when this sequence of appli- many inference steps, i.e that there does not exist inÔ¨Ånite se-
cations only resolves the variable x.                 quences C = C0 C1    ..., where at every inference we
                                                      resolve the variable x and none of the sets Ci are saturated.
  In the context of Max-SAT problems, an inference rule is Let M be the score of C.
sound iff the number of falsiÔ¨Åed clauses in the premises is Let us partition the multiset C of clauses into n multisets
equal to the number of falsiÔ¨Åed clauses in the conclusions for (n is the size of the domain), {B0,B1,...,Bn‚àí1},whereBi
any assignment.                                       contains the clauses where the cardinality of the support of
Theorem 13 (Soundness) The signed Max-SAT resolution  x is i. Notice that B0 is the multiset of clauses that do not
rule is sound.                                        contain the variable x. Let us denote by s(Bi) the score of
                                                      the multiset Bi.
PROOF:LetI   be an arbitrary assignment. There are four We will look at this n multisets as a word of length n and
cases:                                                base M+1. So our multiset will be represented by the number
1. If I falsiÔ¨Åes the two premises, then I also falsiÔ¨Åes the Ô¨Årst s(B0) s(B1) ¬∑¬∑¬∑ s(Bn‚àí1),takings(B0) as the most signiÔ¨Å-
two conclusions, and only them.                       cant digit. Since Bi is a subset of C,fori =0,...,n‚àí 1,
2. If I satisÔ¨Åes the two premises, then it also trivially satisÔ¨Åes s(Bi) ‚â§ M.
the last s+t clauses of the conclusion, because they are either When we apply our inference rule, we take two clauses,
implied by one or the other premise. The second clause of the say one from Bi and one from Bj and substitute them by a
conclusion is implied by each one of the premises. Therefore, set of clauses that we will distribute among the different Bk‚Äôs.
it is also satisÔ¨Åed by I.                             Now we have a new multiset of clauses and by the soundness
  The Ô¨Årst clause of the conclusion is not implied by the of our rule the score of the new multiset is the same. But,
premises. However, if both premises are satisÔ¨Åed then we if we again look at the multiset as a number in base M,the
have two cases. If S:x and S :x are both satisÔ¨Åed, then so number will be different. We will argue that for each infer-
         
it is (S ‚à© S ):x. Otherwise, either some ai‚Äôs or some bj‚Äôs is ence step, the number increases. Say that the clauses we do
                                                                                     
satisÔ¨Åed, thus also the Ô¨Årst clause of the conclusion. inference are S:x ‚à® A ‚àà B|S| and S :x ‚à® B ‚àà B|S|.Bythe
3. If I satisÔ¨Åes the Ô¨Årst premise, but not the second one, then inference step we remove these clauses and add some clause
the second clause of the conclusion as well as the t following in B|S‚à©S|, and maybe also some clauses in B|S|, B|S| and
                                                                                                
clauses are satisÔ¨Åed, because all them are implied by the Ô¨Årst B|S‚à™S|. Since, by deÔ¨Ånition of saturation S ‚à© S = S and
premise.                                              S ‚à© S = S, we know that |S ‚à© S| < |S|, |S| < |S ‚à™ S|,
  For the rest of conclusions, there are two cases: If some hence the digit of B|S‚à©S| is more signiÔ¨Åcant than the dig-
     a                    i                  a
of the i‚Äôs is satisÔ¨Åed, then let be the index of such .The its of B|S|, B|S| and B|S‚à™S|. We have to conclude that the
assignment will satisfy the Ô¨Årst clause of the conclusion and
                                                     new M-base number after the inference step is larger than be-
the last s conclusions, except S :x ‚à® b1 ‚à® ... ‚à® bt ‚à® a1 ‚à® fore. Since the largest possible number we can obtain is the
...‚à® a   ‚à® a                                   a
      i‚àí1   i that is falsiÔ¨Åed. Otherwise none of the i‚Äôs one represented as s(B0)s(B1) ¬∑¬∑¬∑s(Bn‚àí1)=M0 ¬∑¬∑¬∑0 the
is satisÔ¨Åed, and therefore, S:x is satisÔ¨Åed. Hence, the Ô¨Årst saturation procedure for x has to Ô¨Ånish before M n steps.
conclusion is falsiÔ¨Åed, and the last s conclusions are satisÔ¨Åed.
    I
4. If satisÔ¨Åes the second premise, but not the Ô¨Årst one, the Lemma 16 Let E be a saturated multiset of clauses w.r.t. x.
situation is analogous to previous case.              Let E be the subset of clauses of E not containing x. Then,
                                                      any assignment I satisfying E (and not assigning x) can be
                              C
DeÔ¨Ånition 14 A multiset of clauses is said to be saturated extended to an assignment satisfying E.
w.r.t. x if, for every pair of clauses C1 = S:x ‚à® A and C2 =
 
S :x ‚à® B of C,                                                                I                  E
                S :y   A     S :y   B         S  ‚à™    PROOF:Wehavetoextend     to satisfy the whole . In fact
i) there are literals 1 in and 2  in  such that 1     we only need to set the value of x. Let us partition the multiset
S2 = N,or                                                   
                                                   (E‚àíE) (multiset of clauses that contain the variable x)into
ii) S ‚à© S = S or S ‚à© S = S .                                             
                                                    two multisets: (E‚àíE)T the multiset already satisÔ¨Åed by I,
A multiset of clauses C is a saturation of C w.r.t. x if C is (E‚àíE)
             x    C   C    C                  C    and        F the multiset such that the partial assignment
saturated w.r.t. and x  ,i.e.  can be obtained from   I doesn‚Äôt satisfy any of the clauses. Our aim is to show that
applying the inference rule resolving x Ô¨Ånitely many times.                                     
                                                      the intersection of all the supports of x in (E‚àíE)F is non-
  We assign to every clause C ascores(C) equal to the num- empty. This way we will extend I by assigning x to a value
ber of assignments to the variables that falsify C. The score in the intersection of all the supports.

                                                IJCAI-07
                                                   34  Since E is saturated, for every pair of clauses C1 = S:x‚à®A 4 Global Consistency in WCSP
   C  =  S :x ‚à® B (E‚àíE)
and  2           in        F either condition i) or ii) of From the proof of Theorem 17, we can extract the following
the deÔ¨Ånition happens. Condition i) cannot happen because
                                                     exact algorithm for solving WCSP.
C1 and C2 cannot both be in (E‚àíE)F . Therefore, for ev-
                                                                                 P
ery pair of clauses, C1 = S:x ‚à® A and C2 = S :x ‚à® B in     input: A WCSP instance
                                                       C  :=               (P )
(E‚àíE)F  , S ‚à©S = S or S ‚à©S =  S . Now, we order all the      0   signed encoding
                                                             i := 1  k
supports of x appearing in (E‚àíE)F in decreasing order of   for      to
their cardinality. It is straightforward to see that every support C := saturation(Ci‚àí1,xi)
is contained or equal to its predecessor. Particularly, the last  Ci,Di := partition(C, xi)
support is equal to the intersection of all the supports, and it endfor
is non-empty.                                              m  := |Ck|
                                                           I := ‚àÖ
Theorem 17 (Completeness) For any multiset of clauses C,   for i := k downto 1
we have                                                           I := I ‚à™ [xi ‚Üí extension(xi,I,Di)]
                 C    ,...,   , D                         output: m, I
                          
                         m                              Given an initial WCSP instance P with k variables, this
                                                      algorithm returns the minimal cost m of P and an optimal
where D is a satisÔ¨Åable multiset of clauses, and m is the min-
                                                      solution I.
imum number of unsatisÔ¨Åed clauses of C.
                                                        The function saturation(Ci‚àí1,xi) computes a saturation
                                                      of Ci‚àí1 w.r.t. xi applying the resolution rule resolving x until
PROOF:Letx1,...,xn   be any list of the variables of C.
                                                      it gets a saturated set. Lemma 15 ensures that this process
We construct two sequences of multisets C0,...,Cn and
                                                      terminates, in particular that it does not cycle. As we have
D1,...,Dn such that
                                                      already said, the saturation of a multiset is not unique, but
 1. C = C0,                                           the proof of Theorem 17 does not depend on which particular
 2. for i =1,...,n, Ci ‚à™Di is a saturation of Ci‚àí1 w.r.t. xi, saturation we take.
    and                                                 The function partition(C, xi) computes a partition of C,
                                                      already saturated, into the subset of clauses containing xi and
 3. for i =1,...,n, Ci is a multiset of clauses not contain-
                                                      the subset of clauses not containing xi.
    ing x1,...,xi,andDi is a multiset of clauses containing
                                                        The function extension(xi,I,Di) computes an assign-
    the variable xi.
                                                      ment for xi extending the assignment I, to satisfy the clauses
  By lemma 15, this sequences can effectively be computed: of Di according to Lemma 16. The function Ô¨Ålters all clauses
for i =1,...,n, we saturate Ci‚àí1 w.r.t. xi,andthenwe  of Di that are not satisÔ¨Åed by I. Then it computes the inter-
partition the resulting multiset into a subset Di containing xi, section of the supports for xi of all of them, and returns one
and another Ci not containing this variable.          of the values of such an intersection. It returns a value from
  Notice that, since Cn does not contain any variable, it is
                                                              ‚à©{S | S:x ‚à® A ‚àà  D     I        A}
either the empty multiset ‚àÖ, or it only contains (some) empty          i         i and falsiÔ¨Åes
clauses { ,..., }.                         
                                       D =   n  D     The argumentation of the proof of Lemma 16 ensures that this
  Now we are going to prove that the multiset i=1 i   intersection is not empty.
is satisÔ¨Åable by constructing an assignment satisfying it. For The order on the saturation of the variables can be freely
i =1,...,n,letEi  = Di ‚à™ ... ‚à™Dn,andletEn+1   =  ‚àÖ.                         x ,...x
             i =1,...,n                               chosen, i.e. the sequence 1  n can be any enumeration
Notice that, for       ,                              of the variables.
 1. the multiset Ei only contains the variables {xi,...,xn}, A similar approach to this algorithm was deÔ¨Åned using
                                                                      [           ]
 2. Ei is saturated w.r.t. xi,and                     bucket elimination Dechter, 1999 . Even though both proce-
                                                      dures have the same exponential worst-case complexity, we
    E              E =  D ‚à™E
 3.  i decomposes as i   i   i+1, where all the clauses believe that our algorithm can give rise to a better perfor-
      D         x           E           x
    of  i contain i and none of i+1 contains i.       mance proÔ¨Åle, in the sense that our computation of the joint
  Now,   we  construct a  sequence  of  assignments   operation is incremental.
I1,...,In+1,whereIn+1  is the empty assignment, hence
satisÔ¨Åes En+1 = ‚àÖ.Now,Ii   is constructed from Ii+1 as 5  Local Consistency in WCSP
follows. Assume by induction hypothesis that Ii+1 satisÔ¨Åes
                                                      In WCSP a number of local consistency properties have been
Ei+1.SinceEi is saturated w.r.t. xi, and decomposes into
                                                      proposed. These local properties do not ensure the global
Di and Ei+1, by lemma 16, we can extend Ii+1 with an
                                                      consistency of a set of constraints. However, they can be en-
assignment for xi to obtainIi satisfy Ei. Iterating, we get
                        n                             forced very efÔ¨Åciently and used to Ô¨Ånd a lower bound of the
that I1 satisÔ¨Åes E1 = D =  Di.
                        i=1                           cost.
  Concluding, since by the soundness of the rule (The-
                                                        In this section we focus on binary WCSP instances as
orem 13) the inference preserves the number of falsiÔ¨Åed
                                                      in [Larrosa and Schiex, 2003; de Givry et al., 2005].We
clauses for every assignment, m = |Cn| is the minimum num-
ber of unsatisÔ¨Åed clauses of C.                       assume the existence of a unary constraint for every variable
                                                      xi. If no such a constraint is deÔ¨Åned, we can always deÔ¨Åne

                                                IJCAI-07
                                                   35a dummy constraint as f(ak)=0for every ak ‚àà d(xi).We  Rule 3:                  Rule 4:
                                                                                    {i }:x ‚à® {j }:y
will use the standard notation for binary WCSP in the liter- i }:x ‚à® {j }:y           1       1
      C                                         x          { 1       1              ¬∑¬∑¬∑
ature: i will denote a unary constraint over a variable i, ¬∑¬∑¬∑
and Cij will denote a binary constraint between variables xi                        {i }:x ‚à® {j }:y
                                                           {i }:x ‚à® {j }:y            s       1
and xj; Ci(ak),whereak ‚àà d(xi), will denote f(ak),and        s       1              {i   }:x
                                                           {i   }:x                   s+1
Cij (ak,bl),whereak ‚àà d(xi) and bl ‚àà d(xj ), will denote     s+1                    ¬∑¬∑¬∑
                                                           ¬∑¬∑¬∑
f(ak,bk)
        .                                                                           {in}:x
                                                           {in}:x
                                                                                    {j2}:y
DeÔ¨Ånition 18 Variable xi is node consistent if there exists a
                                                           {j1}:y                   ¬∑¬∑¬∑
value ak ‚àà d(xi) such that Ci(ak)=0. A WCSP is node
            ‚àó                                              {is+1}:x ‚à® {j2}:y        {jn}:y
consistent (NC ) if every variable is node consistent.     ¬∑¬∑¬∑
                                                           {i   }:x ‚à® {j }:y
DeÔ¨Ånition 19 Given a binary constraint Cij ,thevalueb ‚àà      s+1       n            {i   }:x ‚à® {j }:y
                                                           ¬∑¬∑¬∑                        s+1       2
d(xj ) is a simple support for a ‚àà d(xi) if Cij (a, b)=0, and                       ¬∑¬∑¬∑
               C  (a, b)+C (b)=0                           {i }:x ‚à® {j }:y
is a full support if ij   j                                  n       2              {i   }:x ‚à® {j }:y
                                                           ¬∑¬∑¬∑                        s+1       n
                                                                                    ¬∑¬∑¬∑
DeÔ¨Ånition 20 Variable xi is arc consistent if every value  {i }:x ‚à® {j }:y
                                                             n       n              {i }:x ‚à® {j }:y
a ‚àà d(xi) has a simple support in every constraint Cij .A                             n       2
                        ‚àó                                                           ¬∑¬∑¬∑
WCSP is arc consistent (AC ) if every variable is node and
arc consistent.                                                                     {in}:x ‚à® {jn}:y

DeÔ¨Ånition 21 Variable xi is full arc consistent if every value Lemma 24 Star node consistency (NC*) can be enforced ap-
a ‚àà d(xi) has a full support in every constraint Cij .AWCSP plying rule 1.
is full arc consistent (FAC‚àó) if every variable is node and full
arc consistent.                                       PROOF:Sayxi   is a variable of a WCSP that is not star node
                                                      consistent. Then for every j ‚àà N, Ci(j) > 0.Letbe
                >
DeÔ¨Ånition 22 Let  be a total ordering over the variables w =min{Ci(j) | j ‚àà N} and k such that Ci(k)=w.This
                 x
of a WCSP. Variable i is directional arc consistent (DAC) if means that in the corresponding signed encoding we have
          a ‚àà d(x )
every value      i has a full support in every constraint Ci(j) copies of {j}:xi,forallj ‚àà N. Rule 1 applied to
Cij such that xj >xi.Itisfull directional arc consistent
                                                      the encoding w many times will remove w copies of {j}:xi,
(FDAC) if, in addition, every value a ‚àà d(xi) has a simple
                                                      for all j ‚àà N, hence all the copies of {k}:xi. Therefore,
support in every constraint Cij such that xj <xi.AWCSP
                                 ‚àó                    the WCSP equivalent to the new encoding has the star node
is full directional arc consistent (FDAC ) if every variable is
                                                      consistency property of the variable xi.
node and full directional arc consistent.
DeÔ¨Ånition 23 Let > be a total ordering over the variables Lemma 25 Arc consistency (AC*) can be enforced applying
of a WCSP. Variable xi is existential arc consistent if there is rule 2.
at least one value a ‚àà d(xi) such that Ci(a)=0and has a
                                                                  x
full support in every constraint Cij . A WCSP is existential arc PROOF:Say i is a variable that is not arc consistent with
             ‚àó                                                           C                  x
consistent (EAC ) if every variable is node and existential arc respect to a constraint ij ,forsomevariable j . This means
                                                                         a  ‚àà  N                 b ‚àà  N
consistent. A WCSP is existential directional arc consistent that there is a value such that for all    ,
      ‚àó           ‚àó        ‚àó                          C  (a, b) > 0       w  =min{C    (a, b) | b ‚àà N}
(EDAC  )ifitisFDAC  and EAC .                           ij        .Letbe             ij             .The
                                                      constrain Cij will generate among others Cij (a, b) copies of
  In what follows we deÔ¨Åne four sound inference rules for {a}:xi ‚à® {b}:xj ,foreveryb ‚àà N. Applying rule 2 w many
a sublanguage of signed formulas. We just consider clauses times, we substitute these clauses by w copies of {a}:xi and
with at most two literals and whose signs are complements of Cij (a, b) ‚àí w copies of {a}:xi ‚à® {b}:xj ,foreveryb ‚àà N.
singletons. This language captures binary WCSP instances. Since there is one value k such that Cij (a, k) ‚àí w =0,this
As we will see bellow, the rules enforce some known local new set of clauses indicates that now variable xi is arc con-
consistency properties. For lack of space we do not show sistent with respect to Cij , for the value a. Arc consistency
how these rules may be derived from the signed Max-SAT for other values would be obtained in the same way.
resolution rule.
  In the next rules we assume that N = {i1,...,in} =    The previous two lemmas where proved for domains of
                                                                [                    ]
{j1,...,jn} and j ‚àà N.                                size two in Larrosa and Heras, 2005 .
                                                                                    >
Rule 1:                  Rule 2:                      Lemma 26   Fixed a total ordering on the variables, Di-
                                                      rectional Arc Consistency (DAC) can be enforced from rule 3
                                                                             x>y
          {i1}:x               {i1}:x ‚à® {j}:y         applied with the restriction .
           ¬∑¬∑¬∑                      ¬∑¬∑¬∑
                                                       ROOF       >
          {in}:x               {in}:x ‚à® {j}:y         P     :Let    be a total ordering on the variables. Say
                                                      xi is a variable that is not directional arc consistent with
                                   {j}:y              respect to a restriction Cij for some variable xj where

                                                IJCAI-07
                                                   36