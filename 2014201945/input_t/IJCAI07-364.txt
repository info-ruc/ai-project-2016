                  Symmetry Breaking in Quantiï¬ed Boolean Formulae

                      Gilles Audemardâˆ—     and SaÂ¨Ä±d Jabbour   and  Lakhdar SaÂ¨Ä±s
                                       CRIL - CNRS, FRE 2499
                                   UniversitÂ´e dâ€™Artois - Lens, France
                              {audemard,jabbour,sais}@cril.univ-artois.fr


                    Abstract                          space. Symmetries are widely investigated and considered as
                                                      an important task to deal with the intractability of many com-
    Many reasoning task and combinatorial problems    binatorial problems such as constraint satisfaction problems
    exhibit symmetries. Exploiting such symmetries    (CSP) and satisï¬ability of boolean formula (SAT).
    has been proved to be very important in reducing    A previous work on symmetry breaking predicates for QBF
    search efforts. Breaking symmetries using addi-   was proposed by [Audemard  et al., 2004]. The authors
    tional constraints is currently one of the most used use an hybrid QBF-SAT approach where the set of gener-
    approaches. Extending such symmetry breaking      ated breaking predicates is separated from the QBF formula.
    techniques to quantiï¬ed boolean formulae (QBF) is Consequently, this approach is solver dependent. Indeed,
    a very challenging task. In this paper, an approach to solve the hybrid QBF-SAT formula, DPLL-based QBF
    to break symmetries in quantiï¬ed boolean formu-   solvers need to be adapted, whereas, other kind of solvers
    lae is proposed. It makes an original use of univer- (e.g. Skizzo) can not be used in this context.
    sally quantiï¬ed auxiliary variables to generate new In this paper, we propose a preprocessing approach which
    symmetry breaking predicates and a new ordering   is solver independent. Taking as input a QBF with symme-
    of the QBF preï¬x is then computed leading to a    tries, we generate a new QBF formula without symmetries
    new equivalent QBF formula with respect to valid- equivalent to the original one wrt. validity. To break such
    ity. Experimental evaluation of the state-of-the-art symmetries we extend the SAT approach proposed by Craw-
    QBF solver SEMPROP shows signiï¬cant improve-      ford [Crawford, 1992; Aloul et al., 2002].
    ments (up to several orders of magnitude) on many   The paper is organized as follows. After some prelimi-
    QBFs instances.                                   nary deï¬nitions on quantiï¬ed boolean formulae, symmetry
                                                      framework in QBFs is presented. Then a symmetry breaking
1  Introduction                                       approach for QBF is described. An experimental validation
                                                      of our approach is given, showing signiï¬cant improvements
Solving Quantiï¬ed Boolean Formulae (QBF) has become an over a wide range of QBF instances. Finally, promising paths
attractive and important research area over the last years. for future research are discussed in the conclusion.
Such increasing interest might be related to different fac-
tors, including the fact that many important artiï¬cial intel-
ligence (AI) problems (planning, non monotonic reasoning, 2 Technical Background
formal veriï¬cation, etc.) can be reduced to QBF which is 2.1 Quantiï¬ed boolean formulae
considered as the canonical problem of the PSPACE com-
                                                      Let P be a ï¬nite set of propositional variables. Then, LP is
plexity class. Another important reason comes from the re- the language of quantiï¬ed Boolean formulae built over P us-
cent impressive progress achieved in the practical resolu- ing ordinary boolean formulae (including propositional con-
tion of the satisï¬ability problem. Many solvers for QBFs stants  and âŠ¥) plus the additional quantiï¬cation (âˆƒ and âˆ€)
                            [
have been proposed recently (e.g. Giunchiglia et al., 2001b; over propositional variables.
Zhang and Malik, 2002; Letz, 2002; Benedetti, 2005]), most
                                                      In this paper, we consider quantiï¬ed boolean formula Î¦
of them are obtained by extending satisï¬ability results. This
                                                      in the prenex clausal form Î¦=QkXk,..., Q1X1Î¨    (in
is not surprising, since QBFs is a natural extension of the sat-
                                                      short QXÎ¨,  QX  is called a preï¬x and Î¨ a matrix) where
isï¬ability problem (deciding whether a boolean formula in
                                                      Qi âˆˆ{âˆƒ,  âˆ€}, Xk,...,X1 are disjoint sets of variables and
conjunctive normal form is satisï¬able or not), where the vari-
                                                      Î¨ a boolean formula in conjunctive normal form. Consecu-
ables are universally or existentially quantiï¬ed.
                                                      tive variables with the same quantiï¬er are grouped. We de-
  Some classes of QBFs encoding real-world application              
                                                      ï¬ne Var(Î¦) =    iâˆˆ{1,...,k} Xi the set of variables of Î¦ and
and/or AI problems contain many symmetries. Exploiting VarU(Î¦) =  {x|x âˆˆ Var(Î¦), x is universal}
such structures might lead to dramatically reducing the search                                 . A literal is
                                                      the occurrence of propositional variable in either positive (l)
  âˆ—                             o
   supported by ANR â€œPlanevoâ€ project n JC05 41940.   or negative form (Â¬l). Lit(Î¦) = iâˆˆ{1,...,k} Lit(Xi) the set

                                                IJCAI-07
                                                  2262of complete literals of Î¦,whereLit(Xi)={xi, Â¬xi|xi âˆˆ  from different quantiï¬er groups can not be mapped with each
Xi}. The set of literals are encoded using integer numbers others (see the second condition of the deï¬nition 1). Then,
i.e. the positive (resp. negative) literal l (resp. Â¬l) is associ- to detect such symmetries, NAUTY is applied on the graph
ated to a positive number Î± (resp. âˆ’Î±). Then, we deï¬ne |l| representation of the QBF.
as the absolute value of l.
  For a given variable x âˆˆ Var(Î¦) st. x âˆˆ Xk,wedeï¬ne  3   Breaking symmetries in QBFs
rank(x)=k. Variables appearing in the same quantiï¬er
                                                      Symmetry breaking has been extensively investigated in the
group are equally ranked.
                                                      context of constraint satisfaction and satisï¬ability problems.
2.2  Symmetries in Quantiï¬ed Boolean Formulae         The different approaches proposed to break symmetries can
                                                      be conveniently classiï¬ed as dynamic and static schemes.
Let Î¦=Q1X1,...,QmXmÎ¨       beaQBFandÏƒ      apermu-
                      Î¦      Ïƒ  : Lit(Î¦) â†’ Lit(Î¦)    Dynamic breaking generally search and break symmetries us-
tation over the literals of i.e.                  .                              [
              Ïƒ    Î¦                        Ïƒ(Î¦) =    ing breaking predicates or not Benhamou and Sais, 1994;
The permutation on   is then deï¬ned as follows:                         ]
Q Ïƒ(X  ),...,Q  Ïƒ(X  )Ïƒ(Î¨)                  Î¨         Gent and Smith, 2000 . Static breaking schemes refer to tech-
 1    1       m    m      .  For example, if  is in   niques that detect and break symmetries in a preprocessing
clausal form then Ïƒ(Î¨) = {Ïƒ(c)|c âˆˆ  Î¨} and Ïƒ(c)=
{Ïƒ(l)|l âˆˆ c}                                          step. For SAT, symmetries are generally broken by generat-
          .                                           ing additional constraints, called symmetry breaking predi-
Deï¬nition 1 Let Î¦=Q1X1,...,QmXmÎ¨      be a quantiï¬ed  cates (SBP) [Crawford, 1992; Aloul et al., 2002].SuchSBP
boolean formula and Ïƒ a permutation over the literals of Î¦. eliminates all models from each equivalence class of sym-
Ïƒ is a symmetry of Î¦ iff                              metric models, except one. However, in the general case, the
                                                      set of symmetry predicates might be of exponential size. In
 1. âˆ€x âˆˆ Lit(Î¦),Ïƒ(Â¬x)=Â¬Ïƒ(x)
                                                      [Aloul et al., 2002], Aloul et al extend the approach of Craw-
 2. Ïƒ(Î¦) = Î¦ i.e Ïƒ(Î¨) = Î¨ and âˆ€i âˆˆ{1,...,m} Ïƒ(Xi)=    ford [Crawford, 1992] by using group theory and the concept
    Xi.                                               of non-redundant generators, leading to a considerable reduc-
  Let us note that each symmetry Ïƒ of a QBF Î¦ is also a sym- tionintheSBPsize.
metry of the boolean formula Î¨. The converse is not true. So We brieï¬‚y recall the symmetry breaking technique intro-
                    Î¦                                 duced by Crawford in [Crawford et al., 1996].LetÎ¨ be a
the set of symmetries of is a subset of the set of symmetries         Ïƒ  {(x ,y ) ...(x ,y )}
of Î¨.                                                 CNF formula and  =    1  1      n  n   a symmetry of
                                                      Î¨.TheSBP    associated to Ïƒ is deï¬ned as follows:
  A symmetry Ïƒ can be seen as a list of cycles (c1 ...cn)
                                                      x1 â‰¤ y1
where each cycle ci is a list of literals (li1 ...lin ) st. âˆ€1 â‰¤
                                         i            (x1 = y1) â†’ x2 â‰¤ y2
k<ni,Ïƒi(li  )=li    and Ïƒi(li )=li .Wedeï¬ne|Ïƒ|   =
          k     k+1        ni    1                   ...
      |ci| where |ci| is the number of literals in ci.
  ciâˆˆÏƒ                                                (x1 = y1) ... (xnâˆ’1 = ynâˆ’1) â†’ xn â‰¤ yn
  It is well known that breaking all symmetries might lead in
the general case to an exponential number of clauses [Craw- The SBP deï¬ned above expresses that, when for all i âˆˆ
             ]
ford et al., 1996 . In this paper, for efï¬ciency and clarity rea- {1 ...k âˆ’ 1} xi and yi are equivalent (get the same truth
sons, we only consider symmetries with binary cycles. Our value) and xk is true,thenyk must be assigned to true.This
approach can be extended to symmetries with cycles of arbi- reasoning can be extended to QBF provided that the symme-
trary size.                                           try follows the preï¬x ordering.
  Detecting symmetries of a boolean formula is equiva-
lent to the graph isomorphism problem [Crawford, 1992; 3.1 Motivation
Crawford et al., 1996] (i.e. problem of ï¬nding a one to one
                         G    H                       In the following example, we show the main difï¬culty behind
mapping between two graphs and  ). This problem is not the extension of SAT symmetry breaking predicates (SBP) to
yet proved to be NP-Complete, and no polynomial algorithm QBFs.
is known. In our context, we deal with graph automorphism
                                                                    Î¦=âˆ€x    y âˆƒx y Î¨                 Î¨=
problem (i.e. ï¬nding a one to one mapping between G and G) Example 1 Let   1 1  2 2  1 be a QBF where
                                                      (x âˆ¨Â¬x  )âˆ§(y  âˆ¨Â¬y  )âˆ§(Â¬x  âˆ¨Â¬y   âˆ¨x  âˆ¨y )
which is a particular case of graph isomorphism. Many pro- 1 2     1    2      1    1   2   2 . The permu-
                                                            Ïƒ =  {(x ,y )(x ,y )}             Î¦
grams have been proposed to compute graph automorphism. tation 1    1 1   2  2  is a symmetry of .Breaking
                                                                  Ïƒ
Let us mention NAUTY [McKay, 1990], one of the most efï¬- the symmetry 1 using the traditional approach, induces the
                                                               SBP    (Â¬x  âˆ¨ y ) âˆ§ (Â¬x âˆ¨Â¬x   âˆ¨ y ) âˆ§ (y âˆ¨
cient in practice.                                    following     :    1    1      1     2    2     1
                                                      Â¬x  âˆ¨ y )            (Â¬x âˆ¨ y )
  Recently, Aloul et al. [Aloul et al., 2002] proposed an 2  2 . As the clause 1  1 is universally quantiï¬ed,
                                                                                       SBP
interesting technique that transforms CNF formula Î¨ into the new obtained QBF by adding the to the original
agraphGÎ¨   where vertices are labeled with colors. Such QBF leads to an invalid QBF formula.
colored vertices are considered when searching for automor- To overcome this main drawback, in addition to the classi-
phism on the graph (i.e. vertices with different colors can not cal SBP, new breaking predicates (called QSBP ) are gen-
be mapped with each others).                          erated for symmetries containing at least one universal cycle
  In [Audemard et al., 2004], a simple extension to QBFs (see deï¬nition 3). In such a case, some variables become ex-
formulae is given. Such extension is simply obtained by in- istentially quantiï¬ed. These variables will be associated to
troducing a different color for each set of vertices whose lit- new additional universally quantiï¬ed variables. There rela-
erals belong to the same quantiï¬er group. In this way, literals tionships are expressed in the generated QSBP . To safely

                                                IJCAI-07
                                                  2263add such QSBP  to the original QBF formula, a new preï¬x Deï¬nition 4 Let Ïƒ = {c1 ...ck ...cn} st. ck =(xk,yk),
ordering is computed.                                 1 â‰¤ k â‰¤ n be a universal symmetry. We deï¬ne QSBP (Ïƒ)=
  After a formal presentation of our approach for a single âˆª{qsbp(Ïƒ(yk)), 1 â‰¤ k â‰¤ nst.yk is universal} as the
symmetry, a generalization to arbitrary set of symmetries is QSBP associated to Ïƒ. QSBP (Ïƒ) is built using the two
then described.                                       following steps:
3.2  Breaking a single symmetry
                                                        1. Adding auxiliary variables : For each universal cycle
Now, we formally introduce our approach for breaking sym- ck =(xk,yk)  âˆˆ Ïƒ, we associate a new universal vari-
metries in QBF.                                                 
                                                          able yk to the out-literal yk and the universal quantiï¬er
                                                            y
Deï¬nition 2 Let Î¦=Q1X1    ...QiXi ...QmXm   Î¨ be a        of k is substituted with an existential quantiï¬er.
QBF and Ïƒ a symmetry of Î¦. We deï¬ne Ïƒ â†‘ Xi as the sub-  2. Generating new predicates :
sequence of the symmetry Ïƒ restricted to the cycles involving
                                                            â€¢ if (x1,y1) is a universal cycle st. |x1| = |y1| then
variables from Xi. Then, the symmetry Ïƒ can be rewriten                                  
                                                              qsb(Ïƒ(y1)) = {Â¬x1 â†’ (y1 â†” y1)}
following the preï¬x ordering as {Ïƒ1 ...Ïƒi ...Ïƒm} such that
                                                            â€¢âˆ€k>1          (x ,y )
Ïƒi = Ïƒ â†‘ Xi.WhenÏƒ  respect the preï¬x ordering, it is called            ,if   k  k is a universal cycle then
                                                              qsbp(Ïƒ(y ))
p-ordered.                                                            k  is made of the following constraints
                                                                               
                                                              â€“  Â¬xk â†’ (yk â†” yk) when |xk| = |yk|
  In the sequel, symmetries are considered to be p-ordered.                          
                                                              â€“  ((Â¬xj âˆ§ yj) â†’ (yk â†” yk)), âˆ€j st. 1 â‰¤ j<k
Example 2 Let Î¦=âˆƒx2y2âˆ€x1y1âˆƒx3y3   (Â¬x1 âˆ¨ y1 âˆ¨ x3) âˆ§
                                                      Example 3  Let us consider the QBF Î¦ given in example 1.
(x1 âˆ¨Â¬x2 âˆ¨y3)(x1 âˆ¨x2 âˆ¨x3)âˆ§(Â¬x3 âˆ¨Â¬y3)âˆ§(x1 âˆ¨x2)(x1 âˆ¨
                                                      The symmetry Ïƒ of Î¦ contains one universal cycle (x1,y1).
y2) âˆ§ (Â¬x1 âˆ¨Â¬y1 âˆ¨Â¬x2   âˆ¨Â¬y2)Î¦has a symmetry   Ïƒ  =                                    
                                                      Using deï¬nition 4, a new variable y1 is associated to the
{(x1,y1)(x2,y2)(x3,y3)}. Reordering Ïƒ with respect to the
                                                      variable y1 which becomes existentially quantiï¬ed. Then
preï¬x leads to Ïƒ = {Ïƒ1,Ïƒ2,Ïƒ3} st. Ïƒ1 = Ïƒ â†‘ X1 =(x2,y2),                                   
                                                      QSBP(Ïƒ)= qsbp(Ïƒ(y1))= (Â¬x1 â†’ (y1 â†” y1))
Ïƒ2 = Ïƒ â†‘ X2 =(x1,y1), Ïƒ3 = Ïƒ â†‘ X3 =(x3,y3).
                                                        As described above, to generate the QSBP new variables
Deï¬nition 3 Let Î¦ be a QBF, Ïƒ a symmetry of Î¦ and c =
(x, y) is a cycle of Ïƒ. We deï¬ne x (resp. y) as an in-literal are introduced. In the sequel, we describe how such variables
                                                      are integrated in the QBF preï¬x.
(resp. out-literal). A cycle c is called universal if x and y are
universally quantiï¬ed. A symmetry Ïƒ is called universal if it Deï¬nition 5 Let Î¦=Q1X1 ...QmXm Î¨ be a QBF, and
contains at least one universal cycle, otherwise it is called Ïƒ = {Ïƒ1 ...Ïƒj ...Ïƒm} be a universal symmetry. Let j st.
existential.                                          Qj  =  âˆ€ and Ïƒj  =  Ïƒ â†‘  Xj  =  {(x1,y1) ...(xn,yn)}
                                                          Y  = {y ...y }
For existential symmetries of a QBF, classical SBP [Craw- and     1    n  the set of new variables associated
                                                      to {y1 ...yn} respectively. We deï¬ne the new ordering of
ford et al., 1996] can be translated linearly to a CNF for-                                        
                                                      Var(Ïƒj ) âˆª Y  as follows : rank(xk) <rank(y    ) <
mula thanks to new additional variables. The obtained set                                           k
                                                      rank(yk) st. 1 â‰¤ k â‰¤ n.
of clauses can be added to the QBF matrix while preserving        G  (V, A)
                                                        We deï¬ne   Ïƒj       as the precedence graph associ-
its validity. The main problem arises when breaking universal                               
                                                      ated to Ïƒj with V  =          {xk,yk,y } and  A  =
symmetries (see example 1). Indeed, to safely break universal                1â‰¤kâ‰¤n         k
                                                      {       {(x ,y ), (y ,y )}}
symmetries while keeping the classical SBP, we ï¬rst reorder 1â‰¤kâ‰¤n k k    k  k   .
the symmetry variables belonging to the same universal quan- To rewrite the quantiï¬er group QjXj of the QBF formula
tiï¬er group. This new ordering allows us to determine literals (see deï¬nition 6), a new ordering is derived by applying topo-
to be likely implied from the SBP. Secondly, as implied uni- logical sort algorithm on the precedence graph. Let us note
versal literals lead to the invalidity of the QBF, an original that such a graph is acyclic. In ï¬gure 1, the graph represen-
approach is then proposed to deal with such literals. In the tation of Ïƒj = Ïƒ â†‘ Xj is illustrated. The ordering x1 ...xn
                                                           
following, the problem behind universal implied literals is il- y1 ...yny1 ...yn is then considered.
lustrated and our approach is then motivated.
                                                                                    
   Ïƒ = {(x1,y1),...,(xk,yk),...}                                   -         -            -
Let                             be a universal symme-           y    y1    y     y2 ... y     yn
                                                               1       2        n   
try of a given QBF Î¦ where (xk,yk) is a universal cycle. As     6           6            6

mentioned above, Ïƒ is ordered according to the preï¬x of Î¦.                          
                                                                x          x            x
Suppose xi and yi for 1 â‰¤ i â‰¤ k âˆ’ 1 are assigned the same      1         2          n
truth value, if xk is assigned to true then the universal literal
yk is implied from the SBP. To avoid such a case, the univer-   Figure 1: Graph representation of Ïƒj
sal quantiï¬er of yk is substituted with an existential quanti-
ï¬er. However, when xi and yi are assigned to different truth
        x                   y                         Deï¬nition 6 Let Î¦=Q1X1   ...QmXm   Î¨  be a QBF, Ïƒ =
values or k is assigned to false, k must remain universally {Ïƒ ...Ïƒ }                       j âˆˆ{1  ...m}
quantiï¬ed. To manage these two cases, a new universal vari- 1 m  a universal symmetry and for
                                                     Ïƒj =  Ïƒ â†‘ Xj =  {(x1,y1),...(xn,yn)}. Every quantiï¬er
able yk is then introduced. This variable plays the same role
                                                            QjXj   Î¦
as yk in the second case whereas in the ï¬rst case it becomes group of is rewritten :
useless. The relation between the two variables is expressed â€¢ if Qj = âˆ€ and Ïƒ â†‘ Xj = âˆ… then
                                                            p  p                                
using new predicates (called qsbp(Ïƒ(yk))).                Qj Xj = âˆ€(Xj\Var(Ïƒj ))x1 ...xnâˆƒÎ±âˆ€y1 ...ynâˆƒy1 ...yn

                                                IJCAI-07
                                                  2264                    p              
    (see ï¬gure 1) st. X = Xj âˆª{y ...y } and Î± is a new
                    j         1    n                                               
    variable.                                              Î¨ âˆ§ (     SBP(Ïƒi)) âˆ§ (         qsbp(S[x]))
  â€¢          QpXp  = Q X
    otherwise j  j    j  j                                     1â‰¤iâ‰¤n             xâˆˆVarU(Î¦)
Î¦ is then rewritten as
 S     p  p    p  p     p  p
Î¦  = Q1X1  ...Qi Xi ...QmXm  Î¨ âˆ§ SBP  âˆ§ QSBP          Preï¬x ordering
                                                      Let us now show how a new QBF preï¬x is built when con-
Remark 1  In deï¬nition 6, a new variable Î± is introduced to
                        {x  ,...x }                   sidering a set of symmetries (for a single symmetry see deï¬-
constrain the set of variables 1 n to be assigned be- nition 6). For a set of symmetries {Ïƒ1,...,Ïƒn}, we consider
fore {y ,...,y }.
      1     n                                         for each universal quantiï¬er group QkXk, all the projections
                                                       i                         i
Property 1 Let Î¦ be a QBF and Ïƒ a symmetry of Î¦,thenÎ¦ Ïƒ  â†‘ Xk  for each symmetry Ïƒ . The new quantiï¬er group
          S                                             p  p
is valid iff Î¦ is valid.                              QkXk  is obtained from the precedence graph representation
                                                                                                       Ïƒi
To sketch the proof of property 1, we consider the QBF given of all these projections. Let us recall that each symmetry
                                     Î¦                is considered p-ordered. Additionally, to avoid cycles from
in the example 1. Applying our approach on , we obtain the                     i
                                                      the graph representation of {Ïƒ â†‘ Xk|1 â‰¤ i â‰¤ n}, each pro-
QBF :                                                         i
   s                                                 jection Ïƒ â†‘ Xk is considered lexicographically ordered.
  Î¦  = âˆ€x1âˆƒÎ±âˆ€y1âˆƒy1x2y2  Î¨1 âˆ§(Â¬x1 âˆ¨y1)âˆ§(Â¬x1  âˆ¨Â¬x2 âˆ¨
y ) âˆ§ (y âˆ¨Â¬x Â¬y  ) âˆ§ (x âˆ¨ y âˆ¨Â¬y ) âˆ§ (x âˆ¨Â¬y  âˆ¨ y )
 2     1    2   2     1   1     1     1    1    1     Deï¬nition 10 Let Ïƒ = {(x1,y1),...,(xn,yn)} be a set of
When  x1 is assigned to the value true, from the clause cycles. Ïƒ is called lexicographically ordered (lex-ordered in
Â¬x   âˆ¨ y               y    true   x
(  1   1) we deduce that 1 is   .If 1 is assigned the short), iff xi > 0, xi â‰¤|yi| 1 â‰¤ i â‰¤ n and xi <xi+1
value false, the original universal variable y1 is deduced by 1 â‰¤ i<n
            
substitution (y1 and y1 are equivalent) thanks to the added
                                                    Example 4  Let Î¦=Q1X1           ...QmXm   Î¨  be   a
constraint Â¬x1 â†’ (y1 â†” y1).Asrank(y1) <rank(y1),we                   
                                  y    y             QBF,  Ïƒ  and  Ïƒ  two  symmetries of Î¦   st.   Ïƒ   â†‘
only need to substitute all occurrences of 1 by 1.                                          
                                                      X1   =   {(x2,x1)(Â¬x3, Â¬x4)(x5,x6)}, Ïƒ   â†‘  X1   =
3.3  Breaking all symmetries                          {(x3,x1)(x2, Â¬x6)} and Q1 =  âˆ€.  With respect to lexi-
                                                      cographical order, Ïƒ â†‘ X1 = {(x1,x2)(x3,x4)(x5,x6)}
Generating QSBP                                             
                                                      and  Ïƒ    â†‘   X1   =    {(x1,x3)(x2, Â¬x6)} Figure 2
When considering several symmetries, we can not eliminate
                                                      shows  the  precedence graph  representation of both
them independently by processing each single symmetry us-             
                                                      Ïƒ  â†‘   X1 and  Ïƒ   â†‘  X1.   Applying topological sort
ing the single symmetry breaking approach described in sec-                     P  P
                                                      algorithm, the quantiï¬er Q1 X1  is then rewritten as
tion 3.2. One needs to consider the interactions between the QP XP = âˆ€x x âˆƒÎ±âˆ€x x âˆƒx x âˆ€x x âˆƒx x
different symmetries. Indeed, considering an universal out- 1 1   1 5    2  3  2 3  4 6   4 6
                                   
literal yk and its associated new variable yk,theqsbp(Ïƒ(yk))
                                          y     y                
express the conditions under which such literals k and k           x5
                                                                 
are equivalent. As only one variable yk is introduced for                        ?   
                                                                            -      -    -
                                                                        x2    x2      x6    x6
each universal out-literal yk,whenyk appears in several sym-          >            
                                                                 
                                                                    
                                                                  x1
metries, the different conditions leading to such equivalence    Z
                                                                     Z               
                                                                      Z~            -   -
need to be combined.                                                    x3    x3      x4    x4
                                                                                     
Deï¬nition 7 Let  Î¦   be   a   QBF,   and   Ïƒ     =
                                                                                              
{(x1,y1) ...(xi,y) ...}. Ïƒ = {(z1,w1) ...(zj,y) ...} two  Figure 2: Precedence graph of Ïƒ â†‘ X1 and Ïƒ â†‘ X1
symmetries of Î¦ with y an universal out-literal. The qsbpâ€™s
associated to y with respect to Ïƒ and Ïƒ can be written in the
                                                      Dealing with universal cycles of the form (y,x) and
following form (see deï¬nition 4) :                    (z,Â¬x)
  â€¢ qsbp(Ïƒ(y)) = {Î± â†’  (y â†” y)) ...Î± â†’ (y â†” y)}
                   1                N                 To preserve the equivalence (wrt. validity) between the orig-
                                            
  â€¢ qsbp(Ïƒ (y)) = {Î²1 â†’ (y â†” y ) ...Î²M â†’ (y â†” y )}.   inal QBF and the new generated one, let us now address the
We deï¬ne a binary correlation operator Î· between Ïƒ and Ïƒ last problem arising from the interactions between the differ-
as follows :                                          ent symmetries. As illustrated in the following example, the
                                 
Î·(Ïƒ(y), Ïƒ (y)) = {(Î±1 âˆ§ Î²1) â†’ (y â†” y ) ...(Î±1 âˆ§ Î²M ) â†’ problem arises for symmetries where a universally quantiï¬ed
                                                             x                     x               Â¬x
(y â†” y ) ...(Î±N âˆ§ Î²1) â†’ (y â†” y ) ...(Î±N âˆ§ Î²M ) â†’ (y â†” out-literal appears both positively ( ) and negatively ( ).
y)}
   .                                                  Example 5  Let Î¦=Q1X1  ...QiXi ...QmXmÎ¨    be a QBF,
                                                             
              S  = {Ïƒ1 ...Ïƒn}                         Ïƒ and Ïƒ two symmetries of Î¦ st. Ïƒ â†‘ Xi = {(x1,y2)} and
Deï¬nition 8 Let              be a set of symmetries of 
a given QBF and y is universal literal. We deï¬ne,     Ïƒ  â†‘ Xi = {(x2, Â¬y2)},Qi = âˆ€.
             j          j      1    |S[y]|
  â€¢S[y]={Ïƒ    |âˆƒ(x, y) âˆˆ Ïƒ } = {Ïƒ ...Ïƒ   }.             Using our approach the quantiï¬er group QiXi is rewritten
                                                                                 
                         1  2     |S[y]|           as âˆ€(Xi\Var(Ïƒ, Ïƒ ))âˆ€x1x2âˆƒÎ±âˆ€y2âˆƒy2. The generated SBP
  â€¢ qsbp(S[y]) = Î·(Î·...Î·(Ïƒ ,Ïƒ ) ...,Ïƒ    ) ...).                                                
                                                      for Ïƒ contains the clause c =(Â¬x1 âˆ¨ x4).ForÏƒ its corre-
                     1    n                                                           
Deï¬nition 9 Let S = {Ïƒ ...Ïƒ } be the set of symmetries of sponding SBP contains the clause c =(Â¬x2 âˆ¨Â¬y2).As
                                         S
a given QBF Î¦=QX   Î¨. The new QBF matrix Î¨ is deï¬ned  the universal variable x4 is substituted with an existential
as follows:                                           one, applying the Q-resolution rule [Kleine-BÂ¨uning et al.,

                                                IJCAI-07
                                                  22651995] on c and c leads to a universally quantiï¬ed resolvent from [Giunchiglia et al., 2001a]. This set of QBF in-
r =(Â¬x1  âˆ¨Â¬x2). Consequently, the new obtained QBF is stances contains different families like toilet, k *, FPGA,
invalid. Finding a new ordering which avoid this problem is qshifter. As a comparison, we run the state-of-the-art
a very challenging task. In example 5, such a problem can DPLL-like solver SEMPROP [Letz, 2002] on QBF instances
be avoided by considering the new ordering x1 <y2 <x2 with and without breaking symmetries. The time limit is ï¬xed
instead of the used lex-ordering. Another possible solution, to 900 seconds. Results are reported in seconds. The symme-
actually under investigation is to apply composition between try computation time (including detection and QSBP genera-
symmetries. More precisely, if we consider Ïƒ â—¦ Ïƒ â—¦ Ïƒ we tion) is not reported (less than one second in most cases).
                     
obtain a new symmetry Ïƒ =(x1, Â¬x2). If in addition to Ïƒ
and Ïƒ, we also consider Ïƒ, then the previous resolvent gen-
                                                             1000
erated using Q-resolution is now not universally quantiï¬ed.
Indeed, as x2 is an out-literal, its universal quantiï¬er is sub-
stituted with an existential one. Then the resolvent r contains  100
a literal Â¬x2 whose associated variable is existentially quan-
                                                              10
tiï¬ed. Finally, the quantiï¬er group QiXi can be rewritten as
 p  p                
Qi Xi = âˆ€x1âˆƒÎ±âˆ€x2âˆƒx2âˆ€y2âˆƒy2.
  The above discussion gives us an idea on how to solve in    1
the general case, the problem arising from symmetries with
universal cycles of the form (y,x) and (z,Â¬x). In this paper,  0.1
such a problem is simply avoided using the following restric-
tion :                                                       0.01

                                                                 0.01  0.1    1      10    100    1000
Deï¬nition 11 Let Î¦=Q1X1      ...QmXmÎ¨    be a QBF,
y âˆˆ  VarU(Î¦)       S                        Î¦
               and   the set of symmetries of .We                 Figure 3: SEMPROP comparison
deï¬ne S[y]  â†“  y   =  {Ïƒ   â†“  y|Ïƒ  âˆˆS[y]}.For
Ïƒ  =  {(x ,y ),...,(x ,y ) ...,(x ,y )}         Ïƒâ†“
         1  1       k  k       n  n  , we deï¬ne         The scatter plot (in log scale) given in ï¬gure 3 illustrate the
yk =  {(x1,y1),...,(xkâˆ’1,ykâˆ’1)}. The restriction of S
      y              rt(S, y)={Ïƒ|Ïƒ    âˆˆ  S, Ïƒ[y]=     comprative results of SEMPROP [Letz, 2002] on each QBF
wrt.    is deï¬ned as                                  instance Î¦ and Î¦S respectively. The x-axis (resp. y-axis)
âˆ…,Ïƒ[Â¬y]=âˆ…} âˆª S[y]     âˆªS[Â¬y]â†“{Â¬y}.    For the set of
                                                      corresponds to the cpu time tx (resp. ty) obtained by SEM-
variables VarU(Î¦)  =  {v1,...,v|VarU(Î¦)|}, we deï¬ne                     S
                                                      PROP on Î¦ (resp. Î¦ ). Each dot with (tx, ty) coordinates,
rt(S, V arU(Î¦)) = rt(...rt(S, v ),v ) ...v   ) ...)
                            1  2     |VarU(Î¦)|        corresponds to a QBF instance. Dots above (resp. below) the
                                                                                                     Î¦
Note that if S[y]=âˆ… or S[Â¬y]=âˆ…,thenrt(S, y)=S.Nat-    diagonal indicate instances where the original formula is
                                                                    tx < ty               tx > ty
urally, for a given set of symmetries S, the new QBF formula solved faster i.e. (resp. slower i.e. ) than the
                                                                  Î¦S
is generated using rt(S, V arU(Î¦)). In this way the obtained QBF formula .
formula is equivalent wrt. validity to the original one. Figure 3 clearly shows the computational gain obtained us-
                                                      ing symmetry breaking predicates (about 167 instances are
Complexity                                            solved more efï¬ciently). In some cases the gain is up to 2 or-
Let Ïƒ be a symmetry of a QBF and CNF(QSBP  (Ïƒ)) the   ders of magnitude. Of course, there exists some instances
CNF representation of QSBP (Ïƒ). The worst case spacial where breaking symmetries decreases the performances of
                                     2
complexity of CNF(QSBP  (Ïƒ)) is in O(|Ïƒ| ). Considering SEMPROP(about 50 instances). On the remaining instances,
Ïƒ = {Ïƒ1,...,Ïƒn} with Ïƒi =(xi,yi), 1 â‰¤ i â‰¤ n,theworst  the performance of the solver remains the same with or with-
case is reached when all cycles of Ïƒ are universal. In this out breaking symmetries.
     QSBP  (Ïƒ)=          qsbp(Ïƒ (y )) |QSBP (Ïƒ)| =
case,             1â‰¤iâ‰¤n       i i .                    Table 1 provides more detailed results on the different QBF
       |qsbp(Ïƒ(y ))| |qsbp(Ïƒ(y ))|       2(i âˆ’ 1) +                            NB
  1â‰¤iâ‰¤n         i  .        i   is equal to          families. The second column ( ) represents the number of
                                                                                            U
2=2i  (see deï¬nition 4). Then, |QSBP (Ïƒ)| = 1â‰¤iâ‰¤n 2i  instances in each family. The third column ( ) indicates if
                n(n +1)                               the instances contain universal symmetries (Y ) or not (N).
which is equal to       . More interestingly, using the              S     TT
same new variables introduced for CNF(SBP), the size of For each family, and   represents the total number of
QSBP  (Ïƒ) becomes linear. Unfortunately, because of the solved instances and the total run-time needed for solving all
correlations between different symmetries, the QSBP asso- the instances (900 seconds are added for each unsolved one)
ciated to a set of symmetries is exponential in the worst case. respectively.
In practice, on all the considered QBF instances, the num- As we can see, table 1 gives us more comprehensive re-
ber of applied correlations (deï¬nition 7) does not exceed 3. sults with respect to each family. First, breaking symmetries
Consequently, the QSBP is most often of reasonable size. signiï¬cantly improves SEMPROP performances on many QBF
                                                      families leading to more solved instances (18 instances). Sec-
                                                      ondly, the existence of universal symmetries seems to be an
4  Experiments                                        important factor for reducing the search time. Not surpris-
The experimental results reported in this section are ob- ingly, we have also noticed that symmetries between literals
tained on a Xeon 3.2 GHz (2 GB RAM) and performed     occurring in the innermost quantiï¬er group are useless. In-
on a large panel of symmetric instances (619) available deed, such symmetries does not lead to a great reduction in

                                                IJCAI-07
                                                  2266