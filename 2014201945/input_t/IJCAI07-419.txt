            Inside-Outside Probability Computation for Belief Propagation

                                             Taisuke Sato
                                     Tokyo Institute of Technology
                          2-12-1 OokayamaÀÜ  Meguro-ku Tokyo Japan 152-8552


                    Abstract                          BNs  [Sato and Kameya, 2001; McAllester et al., 2004;
                                                      Chavira and Darwiche, 2005]. By propositionalization we
    In this paper we prove that the well-known cor-   mean to represent a discrete random variable X having n val-
    respondence between the forward-backward algo-
                                                      ues {v1,...,vn} by a set {Xv1 ,...,Xvn } of mutually ex-
    rithm for hidden Markov models (HMMs) and be-
                                                      clusive binary random variables such that Xvi =1(true) iff
    lief propagation (BP) applied to HMMs can be gen- X  =  vi (1 ‚â§ i ‚â§ n). This propositionalization explodes
    eralized to one between BP for junction trees and the number of states in a BN. However the beneÔ¨Åt often out-
    the generalized inside-outside probability compu- weighs the explosion because it makes possible to share com-
    tation for probabilistic logic programs applied to putation with Ô¨Åner grain size value-dependently at runtime
    junction trees.                                   by dynamic programming and rule out 0 probability compu-
                                                      tation at compile time. It explains, though we omit details,
1  Introduction                                       why probability computation in polynomial time cannot be
                                                      expected of the direct application of BNs to PCFGs [Pyna-
Bayesian networks (BNs) and probabilistic context free dath and Wellman, 1996] while it is carried out in O(n3) time
grammars (PCFGs) are two basic probabilistic frameworks where n is the sentence length by PRISM and by case-factor
in uncertainty modeling (BNs) and in statistical natural lan- diagrams (CFDs) [McAllester et al., 2004].
guage processing respectively. Although they are indepen- In what follows, we Ô¨Årst review basic notions in Section 2.
dently developed, there is a strong indication of their close We then prove main theorems after a series of lemmas in Sec-
relationship. For example both include hidden Markov mod- tion 3. Due to space limitations, the description is sketchy
els (HMMs) as a common subclass. Furthermore belief prop- and the reader is assumed to be familiar with logic program-
agation (BP) applied to HMMs coincides with the forward- ming [Doets, 1994] and BP in junction trees [Jensen, 1996;
backward algorithm for HMMs [Smyth et al., 1997] which is Lauritzen and Spiegelhalter, 1988; Shafer and Shenoy, 1990].
a specialization of probability computation used in the Inside- PRISM, a probabilistic logic programming language used in
Outside (IO) algorithm for PCFGs [Baker, 1979]. Nonethe- this paper, is detailed in [Sato and Kameya, 2001].
less, however, no exact correspondence beyond this one is
known to our knowledge.                               2   Background
  In this paper1 we upgrade this correspondence. We prove
that the inside-outside probability computation in the IO algo- 2.1 Bayesian networks and junction trees
rithm, when generalized for probabilistic logic programs and
                                                      A Bayesian network BN is a directed acyclic graph deÔ¨Ån-
applied to junction trees, yields BP. In particular we prove
                                                      ing a joint distribution P (X1 = x1,...,XN = xN )=
that collecting evidence (resp. distributing evidence) in BP N
                                                      Œ†   P (Xi =  xi | Œ†i =  œÄi) such that nodes are random
coincides with the computation of inside probabilities (resp. i=1
                                                      variables X1,...,XN and if a node Xi has parent nodes
outside probabilities) in this generalized IO computation.
                                                      Œ†i = Xs  ,...,Xs  (k ‚â• 0), a conditional probability table
  To prove the computational correspondence between BNs       1       k
                                                      representing a conditional distribution P (Xi = xi | Œ†i = œÄi)
and PCFGs in a uniÔ¨Åed manner, we need a general language
                                                      is associated with Xi (1 ‚â§ i ‚â§ N). Here a lower case
that can describe BNs and PCFGs2. We choose PRISM [Sato
                                                      letter xi denotes a value of Xi and similarly for œÄi.We
and Kameya, 2001] as a Ô¨Årst-order probabilistic language
                                                      denote the range of Xi by R(Xi) and the direct product
for this purpose. We also need ‚Äúpropositionalization‚Äùof R(X )√ó¬∑¬∑¬∑√óR(X    )   R(Œ†  )        x  ‚àà R(X )
                                                          s1            sk by    i and write i      i and
  1                                                   œÄi ‚àà R(Œ†i). Hereafter we use P (x1,...,xN ) for P (X1 =
   We assume in this paper that BNs are discrete and BP is without x ,...,X = x )            P (x | œÄ )
normalization.                                         1       N     N  etc. When we consider   i    i as
                                                                  x ,œÄ         {x }‚à™œÄ
  2Note that BNs are a propositional framework that deal with a function of i i,theset i i is called the argu-
Ô¨Ånitely many random variables while PCFGs allow recursion and ments of P (xi | œÄi).LetŒ± = {s1,...,sk} be a set of
have to deal with inÔ¨Ånitely many random variables describing prob- variable indices (‚äÜ{1,...,N}). XŒ± stands for the set of
                                                              {X   ,...,X  }                Œ± =  {1, 2, 3}
abilistic choices in a sentence derivation.           variables  s1      sk . For example if            ,

                                                IJCAI-07
                                                  2605XŒ± = {X1,X2,X3}. This notation extends to vectors.    (v ‚àà R(V )), we introduce a ground term i as a name (iden-
  A junction (join) tree T =(V,E) for BN isatreesat-  tiÔ¨Åer) for V and a ground msw atom msw(i, n, v) which is
isfying the following conditions. First a node is a set XŒ± true iff the outcome of an n-th trial of V named i is v.Here
of variables in BN. In what follows we use XŒ± and its in- n is a natural number. V as iids are represented by the set
dex set Œ± interchangeably. An edge connecting Œ± and Œ≤ is {msw(i, n, v) | v ‚àà R(V ),n =0, 1,...} of msw atoms.
                                                                                               4
labeled by Œ± ‚à© Œ≤. Second P (x1,...,xN )=Œ†Œ±‚ààV œÜŒ±(xŒ±)   These msw atoms must satisfy certain conditions . The prob-
must hold where œÜŒ±(xŒ±),apotential (function), is a prod- ability of msw(i, n, v) being true is called a parameter.
uct of some (or no) conditional distributions such that their In PRISM a program DB = R ‚à™ F consists of a set R of
arguments are included in xŒ±. The third condition is the run- deÔ¨Ånite clauses whose head is not an msw atom and a set F
ning intersection property (RIP) which dictates that if nodes of msw atoms together with a base distribution PF deÔ¨Åning
Œ± and Œ≤ have a common variable, it must be contained in probabilities (parameters) of msw atoms in F . Simple distri-
every node on the path between Œ± and Œ≤. RIP ensures the butions are deÔ¨Ånable soley in terms of msw atoms but com-
conditional independence of the subtrees given variables in plex distributions are constructed by using deÔ¨Ånite clauses.
the node and is the key property for efÔ¨Åcient probability com- In our semantics, DB deÔ¨Ånes a probability measure PDB (¬∑)
putation by BP. Given a BN, a junction tree is constructed by over the set of Herbrand interpretations (distribution seman-
way of triangulation or variable elimination [Jensen, 1996; tics [Sato and Kameya, 2001]). Hereafter we consider PDB (¬∑)
Kask et al., 2001; Lauritzen and Spiegelhalter, 1988]. as a distribution on ground atoms as well.
2.2  PCFGs and inside-outside probabilities
                                                      2.4  Propositionalization through tabled search
A PCFG is a CFG with probabilities assigned to produc-
                                      A    N
tion rules in such way that if a nonterminal has rules, In our approach, PDB (G), the probability of an atom G de-
A  ‚Üí  Œ±1,...,A  ‚Üí  Œ±N , a probability pi is assigned to Ô¨Åned by a program DB , is computed in two steps. The Ô¨Årst
                          N
A ‚Üí  Œ±i for i (1 ‚â§ i ‚â§ N)and i=1 pi =1holds. pi is the step is propositionalization. We apply the SLD refutation pro-
probability of choosing A ‚Üí Œ±i to expand A in a probabilis- cedure [Doets, 1994] to DB and ‚áê G as a top-goal, we search
tic derivation. PCFGs are a basic tool for statistical natural for all SLD proofs of G and reduce G to a logically equiv-
language processing and include HMMs as a subclass.   alent but propositional DNF formula E1 ‚à®¬∑¬∑¬∑ ‚à® Ek where
  Let A(i, j) denote an event that a nonterminal A prob- Ei (1 ‚â§ i ‚â§ k),anexplanation of G, is a conjunction of
abilistically derives the substring wi,...,wj of a sentence ground msw atoms. They record probabilistic choices made
L = w1,...,wn (1 ‚â§ i ‚â§ j ‚â§ n). The probability of A(i, j) in the process of constructing an SLD proof of G and each
is called the inside probability of A(i, j) and deÔ¨Åned as the msw atom represents a probabilistic event V = v for some
sum of the products of probabilities associated with rules in a random variable V . Then in the second step, we compute the
derivation belonging to A(i, j). Similarly the outside proba- probability of G as PDB (G)=PDB (E1 ‚à®¬∑¬∑¬∑‚à®Ek).
bility of A(i, j) w.r.t. L is the sum of products of the probabil- In general since there are exponentially many proofs and
ities associated rules used in a derivation that starts from the so are explanations, the naive proof search would produce
start symbol and derives w1,...,wi‚àí1Awj+1,...,wn.The  an exponential size DNF. Fortunately however by introduc-
product of inside-outside probabilities of A(i, j) gives the ing tabling in the Ô¨Årst step, we can often produce an equiva-
probability of deriving L via A(i, j). Inside-outside probabil- lent but polynomial size boolean formula such that common
                                                3
ities are computed by dynamic programming in time O(|L| ). subexpressions in the Ei‚Äôs are factored out as tabled atoms.
We next generalize inside-outside probabilities in the context The factored formula, Expl(G), becomes a set (conjunction)
of probabilistic logic programming.                   of deÔ¨Ånitions of the form H ‚áî W  where a tabled atom
                                                      H  is deÔ¨Åned by W which is a conjunction of tabled atoms
2.3  Probabilistic logic programming language         and msw atoms. We assume the deÔ¨Åning relation of these
     PRISM                                            tabled atoms is acyclic. For convenience we sometimes think
We brieÔ¨Çy explain a probabilistic logic programming lan- of each deÔ¨Ånition as an AND-OR graph and conventionally
guage PRISM. In a nutshell, PRISM is Prolog extended with call Expl(G) an explanation graph as the collection of such
tabling3, a probabilistic built-in predicate called msw (multi- AND-OR graphs. Hereafter Expl(G) stands for the factored
ary random switch) and a generic parameter learning routine formulas and their graphical representation as well.
that learn parameters embedded in a program by computing
generalized inside-outside probabilities [Sato and Kameya, 2.5 Generalized inside-outside probabilities
2001].
  One of the basic ideas of PRISM is propositionalization To compute PDB (G), we convert each deÔ¨Ånition H ‚áî A1 ‚à®
                                                      ...‚à®A    Expl(G)       A =  B ‚àß¬∑¬∑¬∑‚àßB   ‚àß      ‚àß¬∑¬∑¬∑‚àß
of random variables using a special built-in predicate msw/3. L in     where  i    1       Mi  msw1
Let V be a discrete random variable with a set R(V ) of
ground terms as its range. To represent a proposition V = v 4                                   
                                                         We require that PF (msw(i, n, v) ‚àß msw(i, n, v )) = 0
                                                                                   W
                                                      for v =  v   ‚àà  R(V ) and PF (      msw(i, n, v)) =
  3Tabling here means to memoize goals whose predicate symbol P                      v‚ààR(V )
                                                              P  (   (i, n, v)) = 1       n         i = i
is declared as table predicate and to cache successful goals in a table v‚ààR(V ) F msw holds for any .Alsowhen
for later reuse [Zhou and Sato, 2003]. An atom containing a table or n = n, msw(i, n, v) and msw(i,n,v) must be independent and
predicate is called a tabled atom.                    msw(i, n, v) and msw(i, n,v) must be identically distributed.

                                                IJCAI-07
                                                  2606mswNi (1 ‚â§ i ‚â§ L) to a numerical sum-product equation.
                                                                                       T
    PDB (H)=PDB      (A1)+¬∑¬∑¬∑+   PDB (AL)

    PDB (Ai)=PDB     (B1) ¬∑¬∑¬∑PDB (BMi )¬∑        (1)

                   PDB (msw1) ¬∑¬∑¬∑PDB (mswNi )

Note that this conversion assumes the mutual exclusiveness of
                                                                             q  (x  )
disjuncts {A1,...,AL} and the independence of conjuncts     root
                                                                                      W
{B1,...,BMi , msw1,...,mswNi }. Although guaranteeing         node
these two conditions is basically the user‚Äôs responsibility,
they are automatically satisÔ¨Åed as far as the PRISM pro-
gram describing junction trees is concerned (see Section 3
                           Eq(G)
and Lemma 3.3). We denote by      the set of converted           Figure 1: Junction tree T = V,E
equations.
  For a ground atom A, we call PDB (A) a P-variable.
P-variables are just numerical variables named by ground 3 Belief propagation as the generalized IO
atoms. As we assume the deÔ¨Åning relation of tabled atoms  computation
is acyclic, P-variables in Eq(G) can be linearly ordered so
that Eq(G) is efÔ¨Åciently solved in a bottom-up manner by In this section, we prove that the generalized IO computation,
dynamic programming in time proportional to the size of i.e. the computation of generalized inside-outside probabili-
Eq(G). Also the acyclicity implies that a higher P-variable is ties, subsumes BP in junction trees.
a multivariate polynomial in the lower P-variables, and hence
we can take the derivative of a higher P-variable as a function 3.1 Program for BP messages
of the lower P-variables.                             Suppose we have a BN deÔ¨Åning a joint distribution P (X1 =
                                                                             N
  Suppose we are given a program DB . In an analogy to x1,...,XN =  xN )=Œ†i=1P   (xi = Xi  | Œ†i = œÄi) and
inside-outside probabilities in PCFGs, we deÔ¨Åne a gener- a junction tree T =(V,E) such that P (x1,...,xN )=
                                                                                         6
alized inside probability inside(A) of a ground atom A by Œ†Œ±‚ààV œÜŒ±(xŒ±).LetŒ¥ be the root node of T .
         def                                                                          DB     =  F   ‚à™ R
inside(A) =  P  (A)                                     We construct a PRISM  program     T      T     T
              DB    and extend the deÔ¨Ånition to a con-                   T           7
                                    def               that describes BP in  as follows . Introduce for each
junction W of ground atoms by inside(W ) = PDB (W ).  conditional probability P (xi | œÄi) a ground msw atom
  We  also  deÔ¨Åne  a  generalized outside probability msw(bn(i, œÄi), once,xi).IfXi has no parent put œÄi =[]
outside(G ; A) of A w.r.t. a top-goal G as follows. First (null list). DeÔ¨Åne a Ô¨Ånite set FT of msw atoms by
enumerate A‚Äôs occurrences in Expl(G) as
                                                               def
                                                          FT  =  { msw(bn(i, œÄi), once,xi) |
         H  ‚áî  (A ‚àß W   ) ‚à®¬∑¬∑¬∑‚à®(A ‚àß W    )
           1         1,1              1,i1                          1 ‚â§ i ‚â§ N,xi ‚àà R(Xi),œÄi ‚àà R(Œ†i) }
             ¬∑¬∑¬∑
                                                                      Œ∏
         HJ ‚áî  (A ‚àß WJ,1) ‚à®¬∑¬∑¬∑‚à®(A  ‚àß WJ,iJ ).         and set parameters bn(i,œÄi),xi by

                                             5         Œ∏         = PF (msw(bn(i, œÄi), once,xi)) = P (xi | œÄi).
Then outside(G ; A) is recursively computed by Eq. 2 .  bn(i,œÄi),xi
  outside(G ; G)=1                                    Then it is easy to see that every joint probability is represented
                                
                                  i1                  by a conjunction of these ground msw atoms, i.e. we have
  outside(G ; A)=outside(G ; H1)     inside(W1,j )
                                 j=1                                                              
        + ¬∑¬∑¬∑+ outside(G ; H ) iJ  inside(W  ).                              N
                           J   j=1         J,j          P (x1,...,xN )=PF    i=1 msw(bn(i, œÄi), once,xi) .
                                                (2)
Using Eq. 2, all outside probabilities are computed in time in Next introduce an atom msw(bn(i, Œ†i), once,Xi) con-
         Eq(G)
the size of     [Sato and Kameya, 2001]. We can prove taining variables Xi and Œ†i for each i (1 ‚â§ i ‚â§ N).
                   A           inside(A) ¬∑ outside(A)
that for a ground atom , the product                  msw(bn(i, Œ†i), once,Xi) represents the conditional distribu-
                                 A           G                               8
is the average number of occurrences of in a proof of and tion P (Xi = xi | Œ†i = œÄi) . For every node Œ± in the junction
that our deÔ¨Ånition is a generalization of the usual deÔ¨Ånition of tree T , deÔ¨Åne a conjunction WŒ±(XŒ±) representing the poten-
inside-outside probabilities in PCFGs [Lafferty, 1993]. tial œÜŒ±(xŒ±) of Œ± and introduce a clause CŒ± deÔ¨Åning a mes-
                                                      sage atom qŒ±Œ≥(XŒ±‚à©Œ≥ ) that describes a message in BP sent
  5
   As mentioned above, PDB (G), a P-variable, is a function
                                                         6
of other P-variables PDB (A) and the mathematical deÔ¨Ånition of In what follows, for simplicity we assume no evidence is given.
outside(G ; A) is                                     When some variables are observed however, all conclusions remain
                                                      valid, except that they are Ô¨Åxed to the observed values.
                                                         7
                          def ‚àÇPDB (G)                   Programming convention follows Prolog.
             outside(G ; A) =                            8
                            ‚àÇPDB  (A)                    Here we use intentionally Xi both as a logical variable and as a
                                                      random variable to make explicit the correspondence between gen-
which derives Eq. 2.                                  eral msw atoms and conditional distributions in BN.

                                                IJCAI-07
                                                  2607                Œ±                Œ≥                                    ‚éß
            from  to its parent node . They are respectively deÔ¨Åned as   q   ‚áê      (bn(1, once, []),X ) ‚àß
                                                                      ‚é™   Œ≥10   msw                1
                                                                     ‚é™
                       def                                            ‚é™          msw(bn(5, once, [X4,X1]),X5)‚àß
              WŒ±(XŒ±)   =              msw(bn(i, Œ†i), once,Xi),        ‚é™
                            P (xi|œÄi)‚ààœÜŒ±                              ‚é™          q    (X ,X  )
                  def                                                 ‚é®‚é™          Œ±1Œ≥1   1  4
              C   =  q  (X    ) ‚áê W  (X  )‚àß
               Œ±      Œ±Œ≥   Œ±‚à©Œ≥      Œ±   Œ±                                qŒ±1Œ≥1 (X1,X4) ‚áê
                                                                  RT
                          qŒ≤ Œ±(XŒ≤  ‚à©Œ±) ‚àß¬∑¬∑¬∑‚àßqŒ≤  Œ±(XŒ≤  ‚à©Œ±).           1          (bn(2, once, [X ]),X ) ‚àß q (X  ,X )
                            1     1            K     K                ‚é™     msw              1    2     Œ≤1Œ±1  2  4
                                                                      ‚é™  q    (X ,X  ) ‚áê
                                                                      ‚é™   Œ≤1Œ±1  2   4
            Here Œ≤1,...,Œ≤K (K  ‚â• 0) are the child nodes of Œ± in T .   ‚é™
                                                                      ‚é©‚é™    msw(bn(3, once, [X2]),X3) ‚àß
                                   WŒ±(XŒ±)
            The next lemma states that     correctly describes the          msw(bn(4, once, [X3]),X4)
            potential of node Œ±. The proof is straightforward and omitted.
            Lemma 3.1
                                                                     Figure 3: The deÔ¨Ånitions of message atoms for T1.
             PF (WŒ±(xŒ±))   =             P (xi | œÄi)=œÜŒ±(xŒ±).
                              i:P (x |œÄ )‚ààœÜ
                                  i i   Œ±                         deÔ¨Ånition of tabled atom qŒ±Œ≥ (xŒ±‚à©Œ≥ ) for every node Œ± in T as
                                                                 shown below.
                                                                                                              
                          Œ¥   T                                     q  (x   ) ‚áî         W  (x  ) ‚àß K   q  (x    )  .
            For the root node in , it has no parent but we add a special Œ±Œ≥ Œ±‚à©Œ≥    x      Œ±  Œ±     i=1 Œ≤iŒ±  Œ≤i‚à©Œ±
                      0   V          C                                              Œ±\Œ≥
            parent node to  and deÔ¨Åne Œ¥ as                                                                        (3)
                   def                                            Here xŒ±‚à©Œ≥ denotes an arbitrary ground instantiation of XŒ±‚à©Œ≥
               CŒ¥  =  qŒ¥0 ‚áê WŒ¥(XŒ¥)‚àß
                                                                  and qŒ±Œ≥ (xŒ±‚à©Œ≥ ) represents the message sent from Œ± to Œ≥, Œ±‚Äôs
                            qŒ≤ Œ¥(XŒ≤ ‚à©Œ¥) ‚àß¬∑¬∑¬∑‚àßqŒ≤ Œ¥(XŒ≤ ‚à©Œ¥)
                              1    1            K    K          parent node, after receiving messages from Œ±‚Äôs child nodes
                                                                Œ≤1,...,Œ≤K (see Figure 1).
            where Œ≤ ,...,Œ≤  are the child nodes of Œ¥. qŒ¥0 has no ar-
                   1     K                                          We next prove that the recursive equations Eq. 3 are
            guments but calls every message atom directly or indirectly.
                                                                  ‚Äúsolved‚Äù uniquely. Let TŒ± be the subtree of T rooted at XŒ±
            Finally put
                                                                  and XŒæŒ± be the set of variables appearing in TŒ±.WeÔ¨Årstin-
                                                                                  œÑŒ±(XŒæ )    Œ±
                          def                                     troduce a formula    Œ±  for  by Eq. 4 and rewrite it to
                      RT  =  {CŒ±  | Œ± ‚àà V,T =(V,E)}.              Eq. 5. It represents the potential of the subtree TŒ±.
              We illustrate a small example. Take a discrete Bayesian             def  
                                                                         œÑŒ±(XŒæ )   =         WœÅ(XœÅ)               (4)
            network BN1 on {X1,...,X5} on the left-hand side of Fig-          Œ±         œÅ‚ààTŒ±
                                  T                                                              K
            ure 2 and its junction tree 1 on the right-hand side with the          =   WŒ±(XŒ±)  ‚àß      œÑŒ≤ (XŒæ )
                                                                                                  i=1  i   Œ≤i     (5)
            root node Œ≥1. Dotted lines in BN1 indicate edges added by tri-
            angulation. Figure 3 shows the deÔ¨Ånitions of message atoms Lemma 3.2
            for T1.                                                                
                                                                       Œæ   =   Œ± ‚à™  K   Œæ
                                                                        Œ±           i=1  Œ≤i

                                                                    ŒæŒ≤i \ Œ≥ =(ŒæŒ≤i  \ Œ±) ‚à™ (Œ≤i ‚à© (Œ± \ Œ≥)) (from RIP of T )
                                                    P(x 1)
                                                 P(x | x , x )                          K
                                                    5  1 4          ŒæŒ± \ Œ≥ =(Œ±    \ Œ≥) ‚à™    (ŒæŒ≤ \ Œ±)
                                           X                                             i=1   i                  (6)
                            X                     X 1, X 4, X 5
                              1             1 ,X
                                             4                                                                     
                                                         1={1,4,5}
                     X 2                                                                    
                                     P(x | x )                    Proposition 3.1 qŒ±Œ≥ (xŒ±‚à©Œ≥ )=     œÑŒ±(xŒæŒ± )        
                                        2  1                                                  xŒæŒ±\Œ≥
                                     X , X , X  1={1,2,4}
             X                        1  2  4
               3                                                  (Proof) By well-founded induction on T .WhenŒ± is a leaf in
                                                                  T , the proposition is obviously true. Assume it is true w.r.t.
                                              4
                                             X
                     X 4                     ,                    the child nodes of Œ±.
                                            X 2    P(x | X )
                                                      3 2          
                                                   P(x | x )
                                                      4 3              œÑŒ±(xŒæ )
                            X 5                    X , X , X                Œ±
                                                    2  3 4        x
                                                                   ŒæŒ±\Œ≥            
                                                         1={2,3,4}
                                                                    =            ¬∑¬∑¬∑     œÑŒ±(xŒæŒ± ) by Eq. 6
                   BN 1                Junction tree T 1
                                                                        x   x      x
                                                                         Œ±\Œ≥ Œ≤1\Œ±   Œ≤K \Œ±
                                                                        ((Œ± \ Œ≥) and (Œ≤i \ Œ±)‚Äôs are mutually disjoint)
                      Figure 2: BN1 and a junction tree T1                  ‚éõ             ‚éõ              ‚éû‚éû
                                                                                      K    
                                                                            ‚éù             ‚éù              ‚é†‚é†
                                                                    =         WŒ±(xŒ±) ‚àß           œÑŒ≤ (xŒæ  )
                                                                                                   i   Œ≤i     by Eq. 5
            3.2  Explanation graphs for BP messages                     xŒ±\Œ≥           i=1  xŒæ \Œ±
                                                                                              Œ≤i
               DB   = F  ‚à™ R                                                                        
            Let   T     T    T be the program constructed in Subsec-                  K
            tion 3.1. After declaring every qŒ±Œ≥ predicate as a table predi-
                                                                    =         WŒ±(xŒ±) ‚àß    qŒ≤iŒ±(xŒ≤i‚à©Œ±)  by induction
            cate, we apply tabled search for all proofs to a top-goal ‚áê qŒ¥0
                                                                        xŒ±\Œ≥           i=1
            where Œ¥ is the root node of T . The search always terminates
                                                                    =   q  (x   )
            and yields an explanation graph Expl(qŒ¥0) which contains a   Œ±Œ≥  Œ±‚à©Œ≥  by Eq. 3               Q.E.D.

                                                            IJCAI-07
                                                              26083.3  BP and the generalized IO computation              (Proof)
    P                                  DB
Let  DB T be the distribution deÔ¨Åned by   T .The        inside(qŒ±Œ≥ (xŒ±‚à©Œ≥ ))
generalized inside probability of the  tabled atom        =  P    (q  (x    ))
                                                               DB T Œ±Œ≥  Œ±‚à©Œ≥
inside(qŒ±Œ≥ (xŒ±‚à©Œ≥ )) and the generalized outside proba-                         
     outside(q ; q (x    ))     q                         =  P             œÑ (x  )
bility       Œ¥0  Œ±Œ≥  Œ±‚à©Œ≥   w.r.t. Œ¥0 can be computed           DB T        Œ±   ŒæŒ±   by Proposition 3.1
                                                                      xŒæŒ±\Œ≥
using Eq. 3 by sum-product computation speciÔ¨Åed in Eq. 1 if  
                                                          =         P    (œÑ (x  ))
                                                                x    DB T  Œ±  ŒæŒ±  by Lemma 3.3
the independence of conjuncts and the mutual exclusiveness      ŒæŒ±\Œ≥       
of disjuncts on the right-hand side of Eq. 3 are guaranteed. =            ¬∑¬∑¬∑       P    (W  (x )) ¬∑
                                                                x    x         x      DB T  Œ±  Œ±
                                                                 Œ±\Œ≥  Œ≤1\Œ±      Œ≤K \Œ±
  Since each msw atom msw(bn(i, Œ†i), once,Xi) occurs           
                                                                 K  P    (œÑ  (x  ))
only once in some WŒ± reÔ¨Çecting the fact that a conditional            DB T Œ≤i  ŒæŒ≤    by Eq. 6
                                                                 i=1            i      ‚éõ             ‚éû
distribution function P (xi | œÄi) in the BN belongs exclu-
                                                                              K         
sively to one potential œÜŒ± in the junction tree, WŒ±(xŒ±) and                            ‚éù             ‚é†
                                                          =      PDB  (WŒ±(xŒ±))   PDB         œÑŒ≤ (xŒæ )
the qŒ≤ Œ±(xŒ≤ ‚à©Œ±)‚Äôs do not share any msw atoms. Hence the              T               T         i   Œ≤i
     i    i                                                  x                 i=1       x
Ô¨Årst condition, the independence condition, is satisÔ¨Åed au-   Œ±\Œ≥                         Œ≤i\Œ±
tomatically. On the other hand, proving the mutual exclu-            K
                                                          =      œÜ(xŒ±)   PDB  (qŒ≤ Œ±(xŒæ ‚à©Œ±))
siveness condition is not straightforward. Lemma 3.3 be-                     T   i   Œ≤i    by Lemma 3.1
low assures the exclusiveness condition when combined with   xŒ±\Œ≥     i=1
Proposition 3.1.                                                      K
          Œæ  ‚à© Œ≥ = Œ± ‚à© Œ≥                   T
  Note that Œ±           holds thanks to RIP of .Sowe      =      œÜ(xŒ±)    inside(qŒ≤ Œ±(xŒæ ‚à©Œ±))
                                                                                  i   Œ≤i        Q.E.D.
rewrite œÑŒ±(XŒæŒ± ) as
                                                             xŒ±\Œ≥      i=1
           œÑ (X  )=œÑ      (X    ,X     )
            Œ±  ŒæŒ±        Œ±  ŒæŒ±\Œ≥   ŒæŒ±‚à©Œ≥
                    =   œÑ (X    ,X    ).              Theorem 3.1 tells us that the generalized inside probabilities
                         Œ±  ŒæŒ±\Œ±   Œ±‚à©Œ≥                of tabled atoms satisfy exactly the same equations as mes-
                                                     sages in the collecting evidence phase of BP in T with the
Lemma 3.3  Let xŒæ \Œ≥  and  x      be  two  different
                 Œ±           ŒæŒ±\Œ≥                     root node Œ¥ [Jensen, 1996; Lauritzen and Spiegelhalter, 1988;
                       X
ground instantiations of ŒæŒ±\Œ≥ .  Then  for an arbi-   Shafer and Shenoy, 1990]. Hence, the bottom-up computa-
trary ground instantiation xŒ±‚à©Œ≥ of XŒ±‚à©Œ≥, we have    tion of generalized inside probabilities is identical to BP in
                       
¬¨  œÑŒ±(x    ,xŒ±‚à©Œ≥ ) ‚àß œÑŒ±(x  ,xŒ±‚à©Œ≥)                    the collecting evidence phase.
       ŒæŒ±\Œ≥            ŒæŒ±\Œ≥       .
                                                        Let P1 be the distribution deÔ¨Åned by BN1 in Figure 2. The
(Sketch of proof) Without loss of generality, we can  equations for generalized inside probabilities of tabled atoms
     X      =  X  ,...,X                       X
write  ŒæŒ±\Œ≥     i1      iM in such a way that if ij   for the junction tree T1 are:
                   X                       X
is a parent node of  ik in the original BN, ij pre-
     Xi                  x      =(xi  ,...,xi )  =
cedes   k in this list. As ŒæŒ±\Œ≥      1       M              inside(qŒ±1Œ≥1 (x1,x4))
x    =(x  ,...,x )                  X                          
 Œæ \Œ≥      i1     iM , there is a variable is such that       =       P     (    (bn(2, [x ]),x )) ¬∑
  Œ±                                                                 x   DB T msw        1    2
x  =  x ,...,x    =  x  ,x   = x  1 ‚â§ s ‚â§  M                     2     1
 i1    i1      is‚àí1    is‚àí1 is     is (          ).
                                                                      inside(qŒ≤1Œ±1 (x2,x4))
Then Ô¨Årst we note Œ†i  ‚äÜ  XŒæ  holds since Xi appears               
                   s       Œ±              s                   =       P  (x | x )inside(q  (x ,x ))
                                                                    x   1  2   1       Œ≤1Œ±1  2  4
only in TŒ± and the conditional distribution P (Xis | Œ†is )           2
must be contained in some potential in TŒ± by RIP. Second    inside(q   (x ,x ))
                                                                  Œ≤1Œ±1  2  4
        Œ†i ‚à© XŒæ  \Œ≥ ‚äÜ{Xi  ,...,Xi   }
we have   s     Œ±         1      s‚àí1 .Wealsohave              =       PDB   (    (bn(3, [x2]),x3)) ¬∑
                                                                    x3    T1 msw
Œ†i  ‚à© XŒæ ‚à©Œ≥  =Œ†i    ‚à© XŒ±‚à©Œ≥.   We can conclude from
  s     Œ±         s                                                   P     (    (bn(4, [x ]),x ))
             (x    ,x   )           P (X   | Œ† )                        DB T msw        3   4
these facts that ŒæŒ±\Œ≥ Œ±‚à©Œ≥ instantiates  is    is to                        1
                                                                 
P (xis | œÄis ) while (x ,xŒ±‚à©Œ≥) instantiates P (Xis | Œ†is )    =       P1(x3 | x2) ¬∑ P1(x4 | x3).
                  ŒæŒ±\Œ≥                                              x3
  P (x | œÄ )      x  = x
to    is  is where  is    is . The rest is immediate and
omitted.                                     Q.E.D.     We next compute generalized outside probabilities of
                                                      tabled atoms. Without loss of generality, we compute the
  We now prove main theorems by applying computation  outside probability of a tabled atom for Œ≤1. We apply
in Eq. 1 to the tabled atoms deÔ¨Åned by Eq. 3. Recall that the deÔ¨Ånition of generalized outside probability in Eq. 2 to
inside(A)=P      (A)                 A       P        Expl(q  )                            q   (x    )
             DB T    for a ground atom  where  DB T         Œ¥0 while noting that a tabled atom Œ≤1Œ± Œ≤1‚à©Œ± oc-
is the distribution deÔ¨Åned by DB T . We derive an equation curs in Expl(qŒ¥0) as in Eq. 3. We obtain recursive equations
satisÔ¨Åed by inside probabilities of tabled atoms.     about generalized outside probabilities as follows.

Theorem 3.1                                           Theorem 3.2
                              K                                                
                                                      outside(q   (x    )) =        œÜ (x )
                                                                 Œ≤1Œ±  Œ≤1‚à©Œ±       x     Œ±  Œ±
inside(qŒ±Œ≥ (xŒ±‚à©Œ≥ )) =  œÜŒ±(xŒ±)   inside(qŒ≤ Œ±(xŒ≤ ‚à©Œ±)).                             Œ±\Œ≤1
                                        i    i                 outside(q (x   ))  K  inside(q (x    )).
                   xŒ±\Œ≥      i=1                                       Œ±Œ≥  Œ±‚à©Œ≥    i=2       Œ≤iŒ± Œ≤i‚à©Œ±
                                                                                                      


                                                IJCAI-07
                                                  2609